<!DOCTYPE html>

<html
  xmlns:th="http://www.thymeleaf.org" 
  lang="en"
  class="light-style layout-navbar-fixed layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  th:data-assets-path="@{/assets/}"
  data-template="vertical-menu-template"
  
>
  <head>
	<meta name="_csrf" th:content="${_csrf.token}" />
	<!-- default header name is X-CSRF-TOKEN -->
	<meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Check Out</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/img/favicon/favicon.ico}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet" type="text/css"
    />

    <!-- Icons -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/boxicons.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/fontawesome.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/flag-icons.css}" />

    <!-- Core CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/css/rtl/core.css}" class="template-customizer-core-css" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/css/rtl/theme-default.css}" class="template-customizer-theme-css" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/demo.css}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/sweetalert2/sweetalert2.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/pickr/pickr-themes.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/tagify/tagify.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/bootstrap-select/bootstrap-select.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/select2/select2.css}" />
    <!-- Page CSS -->

    <!-- Helpers -->
    <script th:src="@{/assets/vendor/js/helpers.js}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
    <script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script th:src="@{/assets/js/config.js}"></script>
    </head>
    <body>
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
	<div th:insert="menu"></div>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

      <div th:insert="header"></div>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
				 <div class="container-xxl flex-grow-1 container-p-y">
              <h4 class="py-3 breadcrumb-wrapper mb-4"><span class="text-muted fw-light">Administration/Asset/ </span>Check Out</h4>
              
         <!-- DataTable with Buttons -->
<div class="card">

<div class="card-body">

<form id="form1" onsubmit="return false">

<div class="row g-4">

<div class="col-sm-3">
	  <label class="form-label">Branch</label>
      <select class="form-select" id="Branch" name="Branch" required>
		 <option value="">--Select--</option>
		
 <option value="1">Coimbatore</option>
		
 <option value="2">Pollachi</option>
		
 <option value="3">Madurai</option>
		
 <option value="4">Salem</option>
	</select>
	 </div>

	 <div class="col-sm-3">
	  <label class="form-label">Custodian</label>
      <select class="form-select" id="Custodian" name="Custodian" required>
		 <option value="">--Select--</option>
 
	</select>
	 </div>
	 
	 <div class="col-sm-3">
	  <label class="form-label">Check In Date</label>
	  <input type="text" class="form-control flatpickr" name="CheckInDate" id="CheckInDate" placeholder="Apr 3 2022" required>
	  </div>
	 
	  <div class="col-sm-3" id="vendordiv" style="display:none;">
	 <label for="form-label">Vendor </label>
	 <select class="form-select" name="vendor" id="vendorls">
	 <option value="">-</option>
	 <option value="1">INDUS INSTRUMENTS - Machinery</option>
	 </select>
	 </div>
	 
	 <div class="col-sm-3" id="locationdiv" style="display:none;">
	 <label for="form-label">Which Location/Department </label>
	 <input type="text" class="form-control" id="WhichLocation" name="WhichLocation">
	 </div>
	
	 
	 <div class="col-sm-3">
	  <label class="form-label">Status</label>
      <select class="form-select" id="Status" name="Status" required>
		 <option value="">--Select--</option>
		
 <option value="Checked Out">Checked Out</option>
		
 <option value="Out for repair">Out for repair</option>
		
 <option value="In office Use">In office Use</option>
		
 
	</select>
	 </div>
	  
	  
<div class="col-sm-12">
  <div class="card-datatable table-responsive pt-0">
    <table class="datatables-basic table table-bordered">
      <thead>
        <tr>
                        <th></th>
                        <th></th>
                        <th width="5%">S.No</th>
						<th>Asset Type</th>
						<th>Asset Name</th>
						<th>Condition</th>
						<th>Photo</th>
						<th>Comments</th>
						<th>Actions</th>
                      </tr>
      </thead>
    
    </table>
  </div>
    </div>
    
     <div class="col-sm-12 text-center">
            <label class="switch">
              <input type="checkbox" class="switch-input" name="receipt">
              <span class="switch-toggle-slider">
                <span class="switch-on">
                  <i class="bx bx-check"></i>
                </span>
                <span class="switch-off">
                  <i class="bx bx-x"></i>
                </span>
              </span>
              <span class="switch-label">SHOW RECEIPT AFTER CHECK OUT?</span>
            </label>
          </div>
          
          <div class="col-sm-12 text-center mt-4">
            <button type="submit" class="btn btn-primary me-sm-3 me-1">Check Out</button>
            
          </div>
         
    </div>
     </form>
</div>
</div>
<!-- Modal to add new record -->
<div class="offcanvas offcanvas-end" id="add-new-record">
  <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title" id="exampleModalLabel">New Item</h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body flex-grow-1">
    <form class="pt-0 row g-2" id="form2" onsubmit="return false">
    
<div class="col-sm-12">
	 <label for="form-label">Asset Type </label>
	 <select class="form-select" name="AssetType" id="AssetType" required>
	 <option value="">-</option>
	 <option value="Machinery">Machinery</option>
	 </select>
	 </div>
	 
	 <div class="col-sm-12">
	 <label for="form-label">Asset Name</label>
	 <input type="hidden"  id="idc" /> 
	 <input type="hidden"  name="ACondition" /> 
	 <select class="form-select" name="AssetName" id="AssetName" required>
	 <option value="">-</option>
	 <option value="Machinery">Machinery</option>
	 </select>
	 </div>
	 
	 <div class="col-sm-12">
	 <label class="form-label">Condition </label>
	 <select class="form-select" name="Condition">
	       <option value="">-</option>
	        <option value="Fair">Fair</option>
          	<option value="Good">Good</option>
          	<option value="New">New</option>
          	<option value="Poor">Poor</option>
          	<option value="Damaged">Damaged</option>
	 </select>
	 </div>
	 
	 
	 <div class="col-sm-12">
	 <label for="form-label">Photo Attach</label>
	 <input type="file" name="Photo_Attach" class="form-control Photo_Attach" multiple="" accept=".png,.jpg,.jpeg,.pdf" />
	 </div>
	 
	  <div class="col-sm-12">
	 <label for="form-label">Comments</label>
	 <input type="text" name="Comments" class="form-control" />
	 </div>
	 
	  <div class="col-sm-12">
	  <button type="submit" id="addcheckout" class="btn btn-primary mb-1" > Submit</button>
	 </div>
	 
    </form>

  </div>
</div>
<!--/ DataTable with Buttons -->
    
    </div>
    
    
            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
              <div class="container-fluid d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
                <div class="mb-2 mb-md-0">
                  Â©
                  <script>
                    document.write(new Date().getFullYear());
                  </script>
                  , made with â¤ï¸ by
                  <a href="https://pixinvent.com" target="_blank" class="footer-link fw-semibold">PIXINVENT</a>
                </div>
                <div>
                  <a href="https://themeforest.net/licenses/standard" class="footer-link me-4" target="_blank"
                    >License</a
                  >
                  <a href="https://1.envato.market/pixinvent_portfolio" target="_blank" class="footer-link me-4"
                    >More Themes</a
                  >

                  <a
                    href="https://pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/documentation-bs5/"
                    target="_blank"
                    class="footer-link me-4"
                    >Documentation</a
                  >

                  <a href="https://pixinvent.ticksy.com/" target="_blank" class="footer-link d-none d-sm-inline-block"
                    >Support</a
                  >
                </div>
              </div>
            </footer>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
            
    </div>
    </div>
    </div>
    </div>
        <!-- Core JS -->
    <script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
    <script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
    <script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
    <script th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

    <script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>

    <script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
    <script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>

    <script th:src="@{/assets/vendor/js/menu.js}"></script>
    <!-- endbuild -->

     <!-- Vendors JS -->
     <script th:src="@{/assets/vendor/libs/select2/select2.js}"></script>
    <script th:src="@{/assets/vendor/libs/bootstrap-select/bootstrap-select.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-responsive/datatables.responsive.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons/datatables-buttons.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/jszip/jszip.js}"></script>
    <script th:src="@{/assets/vendor/libs/pdfmake/pdfmake.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons/buttons.html5.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons/buttons.print.js}"></script>
    <!-- Flat Picker -->
    <script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
    <script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>
     <script th:src="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js}"></script>
    <script th:src="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js}"></script>
    <script th:src="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.js}"></script>
    <script th:src="@{/assets/vendor/libs/pickr/pickr.js}"></script>
    
    <!-- Row Group JS -->
    <script th:src="@{/assets/vendor/libs/datatables-rowgroup/datatables.rowgroup.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/sweetalert2/sweetalert2.js}"></script>
    <script th:src="@{/assets/vendor/libs/tagify/tagify.js}"></script>
    <!-- Form Validation -->
    <script th:src="@{/assets/vendor/libs/formvalidation/dist/js/FormValidation.min.js}"></script>
    <script th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js}"></script>
    <script th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js}"></script>

 

  <!-- Main JS -->
  <script th:src="@{/assets/js/main.js}"></script>
  
 
  <script>
  
  var token = $("meta[name='_csrf']").attr("content");
  var header = $("meta[name='_csrf_header']").attr("content");
  
	$(document).ajaxSend(function(e, xhr, options) {
		xhr.setRequestHeader(header, token);
	});
	
  $(".flatpickr").each(function(index) {
	  $(this).flatpickr({
	    	altInput: true,
		    altFormat: 'F j, Y',
		    dateFormat: 'Y-m-d',
	    });
  })
  
  
  
  const radio = $(`[name="Status"]`);
  const WhichLocation = $(`[name="WhichLocation"]`);
  const vendor = $(`[name="vendor"]`);
  const vendordiv = $(`#vendordiv`);
  const locationdiv = $(`#locationdiv`); 
  const form2 = $(`#form2`);
  const AssetType = $(`[name="AssetType"]`);
  const AssetName = $(`[name="AssetName"]`);
  const Photo_Attach = document.querySelector(`[name="Photo_Attach"]`);
  const Comments = $(`[name="Comments"]`);
  const Condition = $(`[name='Condition']`);
  const receipt = $(`[name="receipt"]`);
  
  const dt_basic_table = $(`.datatables-basic`).DataTable({
	  
  columnDefs: [
    {
      // For Responsive
      className: 'control',
      orderable: false,
      responsivePriority: 2,
      searchable: false,
      targets: 0,
      render: function(data, type, full, meta) {
        return '';
      }
    },
    {
      // For Checkboxes
      targets: 1,
      orderable: false,
      responsivePriority: 3,
      searchable: false,
      checkboxes: true,
      render: function() {
        return '<input type="checkbox" class="dt-checkboxes form-check-input">';
      },
      checkboxes: {
        selectAllRender: '<input type="checkbox" class="form-check-input">'
      }
    },
  ],
  
  dom:
    '<"card-header"<"head-label text-center"><"dt-action-buttons text-end"B>><"d-flex justify-content-between align-items-center row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>t<"d-flex justify-content-between row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',
  displayLength: 10,
  lengthMenu: [10, 25, 50, 75, 100],
  buttons: [
    {
      extend: 'collection',
      className: 'btn btn-label-primary dropdown-toggle me-2',
      text: '<i class="bx bx-export me-2"></i>Export',
      buttons: [
        {
          extend: 'print',
          text: '<i class="bx bx-printer me-2" ></i>Print',
          className: 'dropdown-item',
          exportOptions: { columns: [3, 4, 5, 6, 7] }
        },
        {
          extend: 'csv',
          text: '<i class="bx bx-file me-2" ></i>Csv',
          className: 'dropdown-item',
          exportOptions: { columns: [3, 4, 5, 6, 7] }
        },
        {
          extend: 'excel',
          text: 'Excel',
          className: 'dropdown-item',
          exportOptions: { columns: [3, 4, 5, 6, 7] }
        },
        {
          extend: 'pdf',
          text: '<i class="bx bxs-file-pdf me-2"></i>Pdf',
          className: 'dropdown-item',
          exportOptions: { columns: [3, 4, 5, 6, 7] }
        },
        {
          extend: 'copy',
          text: '<i class="bx bx-copy me-2" ></i>Copy',
          className: 'dropdown-item',
          exportOptions: { columns: [3, 4, 5, 6, 7] }
        }
      ]
    },
    {
      text: '<i class="bx bx-plus me-2"></i> <span class="d-none d-lg-inline-block" >Add Item </span>',
      className: 'create-new btn btn-primary'
    }
  ],
  responsive: {
    details: {
      display: $.fn.dataTable.Responsive.display.modal({
        header: function(row) {
          var data = row.data();
          return 'Details of Item';
        }
      }),
      type: 'column',
      renderer: function(api, rowIdx, columns) {
        var data = $.map(columns, function(col, i) {
          return col.title !== '' // ? Do not show row in modal popup if title is blank (for check box)
            ? '<tr data-dt-row="' +
                col.rowIndex +
                '" data-dt-column="' +
                col.columnIndex +
                '">' +
                '<td>' +
                col.title +
                ':' +
                '</td> ' +
                '<td>' +
                col.data +
                '</td>' +
                '</tr>'
            : '';
        }).join('');

        return data ? $('<table class="table"/><tbody />').append(data) : false;
      }
    }
  }
});


console.log(dt_basic_table.row);




  const e = document.querySelector(".create-new")
          , t = document.querySelector("#add-new-record");
        e && e.addEventListener("click", function() {
            offCanvasEl = new bootstrap.Offcanvas(t),
            offCanvasEl.show();
        })
        
  $(radio).change(function(e){
		if(this.value == "Out for repair")
		{
			vendordiv.show();
			locationdiv.hide();
			WhichLocation.val('');
		}
		else if(this.value == "In office Use")
		{
			locationdiv.show();
			vendordiv.hide();
			vendor.val('');
		}
		else
	    {
			vendordiv.hide();
			locationdiv.hide();
			WhichLocation.val('');
			vendor.val('');
	    }
  })
  
  $(form2).submit(function(e){
	  var at = $(`[name="AssetType"] option:selected`).text();
	  var an = $(`[name="AssetName"] option:selected`).text();
	  var ac = $(`[name="Condition"] option:selected`).text();
	  //var i = $('.datatables-basic tbody>tr').length === 0 ? 1 : $('.datatables-basic tbody>tr').length+1;
	  
	  var rowCount = dt_basic_table.rows().count();
	  rowCount = rowCount+1;
	  
	  var com = Comments.val();
	  const FilesCount = Photo_Attach.files.length;
	  var url;
      if(FilesCount > 0)
	  {
    	  const file = Photo_Attach.files[0];
    	   url = URL.createObjectURL(file);
    	   url = `<a class="badge badge-center rounded-pill bg-label-info w-px-30 h-px-30 me-2" href="${url}" target="_blank"><i class="bx bx-download bx-xs"></i></a>`;
	  }
      else
      {
    	   url = '-';
      }
      var text=`<button class="btn btn-sm btn-icon delete-record" type="button"><i class="bx bx-trash"></i></button>`;
      
	  dt_basic_table.row.add([
		  '',
          '',
          rowCount,
          at,
          an,
          ac,
          url,
          com,
          text,
      ] ).draw( false );
	  
	      e.target.reset();
	      offCanvasEl.hide();
  })
  
  
$(document).on('click','.delete-record' , function(e){
	var tr = $(this).closest('tr');
	 Swal.fire({
         title: 'Are you sure?',
         text: "You won't be able to revert this!",
         icon: 'warning',
         showCancelButton: true,
         confirmButtonText: 'Yes,  Delete Check Out Entry it!',
         customClass: {
             confirmButton: 'btn btn-primary me-3',
             cancelButton: 'btn btn-label-secondary'
         },
         buttonsStyling: false
     }).then(function(result) {
    	 if (result.value) {
    		 dt_basic_table.row(tr)
    	        .remove()
    	        .draw();
    	 }
     })
})

  </script>
    </body>
    </html>