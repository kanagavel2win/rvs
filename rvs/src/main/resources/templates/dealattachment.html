<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="en"
	class="light-style layout-navbar-fixed layout-menu-fixed" dir="ltr"
	data-theme="theme-default" th:data-assets-path="@{/assets/}"
	data-template="vertical-menu-template">
<head>
<meta name="_csrf" th:content="${_csrf.token}" />
<!-- default header name is X-CSRF-TOKEN -->
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

<title>Deal Files</title>

<meta name="description" content="" />



<!-- Favicon -->
<link rel="icon" type="image/x-icon"
	th:href="@{/assets/img/favicon/favicon.ico}" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
	rel="stylesheet" />

<!-- Icons -->
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/boxicons.css}" />
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/fontawesome.css}" />
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/flag-icons.css}" />

<!-- Core CSS -->
<link rel="stylesheet" th:href="@{/assets/vendor/css/rtl/core.css}"
	class="template-customizer-core-css" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/css/rtl/theme-default.css}"
	class="template-customizer-theme-css" />
<link rel="stylesheet" th:href="@{/assets/css/demo.css}" />

<!-- Vendors CSS -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/animate-css/animate.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/sweetalert2/sweetalert2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/select2/select2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/tagify/tagify.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/formvalidation/dist/css/formValidation.min.css}" />
<link rel="stylesheet" th:href="@{/assets/vendor/libs/quill/editor.css}" />
<!-- Page CSS -->

<link rel="stylesheet"
	th:href="@{/assets/vendor/css/pages/page-user-view.css}" />
<!-- Helpers -->
<script th:src="@{/assets/vendor/js/helpers.js}"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
<script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script th:src="@{/assets/js/config.js}"></script>

<style type="text/css">

.filecreateddate {
	float: right;
}

.contacteditbtn {
	cursor: pointer;
}

.activitytypeicon {
	position: relative;
	margin-left: -10px;
}

.guestdetailslist, .followerdetailslist {
	top: 10px;
	font-size: 14px;
	left: -20px;
}

.tooltipx {
	position: relative;
	display: inline-block;
}

.tooltipx .tooltiptextx {
	visibility: hidden;
	font-size: 12px;
	min-width: 120px;
	background-color: black;
	color: #fff;
	text-align: center;
	border-radius: 6px;
	padding: 5px 1px;
	/* Position the tooltip */
	position: absolute;
	left: 50px;
	z-index: 1;
}

.tooltipx:hover .tooltiptextx {
	visibility: visible;
}

.btn-iconx {
	padding: 1px;
	display: inline-flex;
	margin-right: 2px;
	margin-top: -3px;
	width: 15px;
	height: 15px;
}

.editactivity {
	cursor: pointer;
}

.editnoteactivity {
	cursor: pointer;
}
</style>
<script th:inline="javascript">
	var emplanstat = 0;
	var emgstat = 0;
	var languagelist = "";
	var educationdegreelist = "";
	var Nomineerelationshiplist = "";
	
	function optionshandle(radio)
	{
		
		$(".ActivityTitle").attr('placeholder',radio.title +' details...');
		$(".activitytype").removeClass("active");
		$(".activitytype"+radio.title).addClass("active");
	}	
	
	
</script>
</head>

<body>
	<!-- Layout wrapper -->
	<div class="layout-wrapper layout-content-navbar">
		<div class="layout-container">
			<!-- Menu -->
			<div th:insert="menu"></div>
			<!-- / Menu -->

			<!-- Layout container -->
			<div class="layout-page">
				<!-- Navbar -->
				<div th:insert="header"></div>
				<!-- / Navbar -->

				<!-- Content wrapper -->
				<div class="content-wrapper">
					<!-- Content -->

					<div class="container-xxl flex-grow-1 container-p-y">
						<h4 class="py-3 breadcrumb-wrapper mb-4">
							<span class="text-muted fw-light">Works /<a
								href="deallist">Deal</a>/
							</span> View
						</h4>
						<div class="row gy-4">
							<!-- User Sidebar -->
							<div class="col-xl-4 col-lg-5 col-md-5 order-1 order-md-0">
								<!-- User Card -->
								<div class="card mb-4">
									<div class="card-body">
										<div class="user-avatar-section">
											<div class="d-flex align-items-center flex-column">
												<img class="img-fluid rounded my-4"
													th:src="@{/assets/img/logo/rvslogo1.png}" height="110"
													width="110" alt="User avatar" />
												<div class="user-info text-center">
													<h5 class="mb-2" th:text="${dealMaster.Title}"
														id="Lbl_Title"></h5>

												</div>
											</div>
										</div>
										<div class="d-flex justify-content-around flex-wrap my-4 py-3">
											<div class="d-flex align-items-start me-4 mt-3 gap-3">
												<span class="badge bg-label-primary p-2 rounded"><i
													class="bx bx-check bx-sm"></i></span>
												<div>
													<h5 class="mb-0">
														Rs.<span th:text="${dealMaster.dealvalue}"
															id="Lbl_dealvalue"></span>
													</h5>
													<span>Deal Value</span>
												</div>
											</div>

										</div>
										<h5 class="pb-2 border-bottom mb-4">Details</h5>
										<div class="info-container">
											<ul class="list-unstyled">
												<li class="mb-3"><span class="fw-bold me-2">Pipeline:</span>
													<span th:text="${dealMaster.pipeline}" id="Lbl_pipeline"></span></li>

												<li class="mb-3"><span class="fw-bold me-2">Organization:</span>
													<span th:text="${dealMaster.OrganizationName}"
													id="Lbl_organization"></span></li>
												<li class="mb-3"><span class="fw-bold me-2">Purpose:</span>
													<span th:text="${dealMaster.purpose}" id="Lbl_purpose"></span>
												</li>
												<li class="mb-3"><span class="fw-bold me-2">Branch:</span>
													<span th:text="${dealMaster.branchname}"
													id="Lbl_branchname"></span></li>
												<li class="mb-3"><span class="fw-bold me-2">Source:</span>
													<span th:text="${dealMaster.Source}" id="Lbl_Source"></span>
												</li>

												<li class="mb-3"><span class="fw-bold me-2">Reference:</span>
													<span th:text="${dealMaster.ReferenceName}"
													id="Lbl_Reference"></span></li>
												<li class="mb-3"><span class="fw-bold me-2">Notes:</span>
													<span th:text="${dealMaster.notes}" id="Lbl_notes"></span>
												</li>
												<li class="mb-3"><span class="fw-bold me-2">Closing
														Date:</span> <span
													th:text="${dealMaster.expectedclosingdateMMddYYY}"
													id="Lbl_expectedclosingdate"></span></li>
												<li class="mb-3"><span class="fw-bold me-2">Follower:</span>

													<span id="Lbl_follower"> <span
														th:each="obj : ${dealMaster.dealFollowers}"
														th:utext="${obj.Followername} + '<br/>'"> </span>
												</span></li>


											</ul>
											<div class="d-flex justify-content-center pt-3">
												<a href="javascript:;" class="btn btn-primary me-3"
													data-bs-target="#editdealMasterdetails"
													data-bs-toggle="modal"
													id="editOrganizationContactsdetailsbtn">Edit</a>

											</div>
										</div>
									</div>
								</div>
								<!-- /User Card -->
								<!-- Connected Accounts -->
								<div class="card mb-4">
									<h5 class="card-header">
										Connected People
										<div class="card-action-element" style="float: right">
											<button class="btn btn-primary btn-sm" type="button"
												data-bs-toggle="modal" data-bs-target="#addNewperson"
												alt="Add New Person">
												<i class="bx bx-plus bx-xs me-1"></i>
											</button>
											<button class="btn btn-primary btn-sm" type="button"
												data-bs-toggle="modal" data-bs-target="#linkperson"
												alt="Link Person">
												<i class="bx bx-link bx-xs me-1"></i>
											</button>
										</div>
									</h5>
									<div class="card-body">
										<div class="d-flex mb-3" th:each="obj : ${cplist}">
											<div class="flex-grow-1 row">
												<div class="col-9 mb-sm-0 mb-2">
													<a th:href="'contactpersonview?id='+ ${obj.id}"
														target="_blank">
														<h6 class="mb-0" th:text="${obj.peoplename}"></h6>
													</a> <small class="text-muted" th:text="${obj.primarymob}"></small>
												</div>
												<div class="col-3 text-end">
													<label class="switch me-0"> <input type="checkbox"
														class="switch-input" th:name="${obj.id}"
														th:onclick="'makeprimarycontactperson(this)'"
														th:checked="${obj.primaryperson}" /> <span
														class="switch-toggle-slider"> <span
															class="switch-on"> <i class="bx bx-check"></i>
														</span> <span class="switch-off"> <i class="bx bx-x"></i>
														</span>
													</span> <span class="switch-label"></span>
													</label>
												</div>
											</div>
										</div>

										<div id="contactpeopdealdidv"></div>

									</div>
								</div>
								<!-- /Connected Accounts -->

							</div>
							<!--/ User Sidebar -->

							<!-- User Content -->
							<div class="col-xl-8 col-lg-7 col-md-7 order-0 order-md-1">
								<!-- User Pills -->
								<ul class="nav nav-pills flex-column flex-md-row mb-3">
									<li class="nav-item"><a class="nav-link "
										th:href="'dealview?id='+${dealMaster.id}"><i
											class="bx bx-user me-1"></i>Activity</a></li>
									<li class="nav-item"><a class="nav-link"
										th:href="'dealprojectinfo?id='+${dealMaster.id}"><i
											class='bx bxl-ok-ru'></i>Projects</a></li>
									<li class="nav-item"><a class="nav-link active"
										href="javascript:void(0);"><i class="bx bx-link me-1"></i>Files</a></li>

								</ul>
								<!--/ User Pills -->



								<!-- Document   Card -->
								<div class="card  mb-4">
									<input type="hidden" id="mastercategoryid" />
									<div class="card-body1">
										<div class="card-header align-items-center">
											<h5 class="card-action-title mb-0">
												Documents
												<div class="card-action-element" style="float: right">
													<button class="btn btn-primary btn-sm" type="button"
														data-bs-toggle="modal" data-bs-target="#addNewDocument">
														<i class="bx bx-plus bx-xs me-1"></i>
													</button>
												</div>
											</h5>

										</div>
										<div class="card-body">
											<div class="added-cards">
												<th:block th:each="fileObj : ${dealMaster.dealFiles}">
													<div
														th:class="'cardMaster border p-3 rounded mb-3 filecard' + ${fileObj.fileid}">
														<div>
															<div class="card-information">
														 		<table style="width: 100%;">
														 			<tr>
														 				<td>
														 					<h6 class="mb-1" th:text="${fileObj.DocumentType}"></h6>
														 				</td>
														 				<td>
														 					<small class="text-muted filecreateddate" th:text="${fileObj.createddate}"  style="float:right"></small>
														 				</td>
														 			</tr>
														 			<tr>
														 				<td>
														 					<span class="card-number" th:text="${fileObj.DocumentNo}"></span>
														 				</td>
														 				<td rowspan="2"> 
													 						<div  style="float:right">
																				<button class="btn btn-label-secondary filedeletebtn"
																					th:name="${fileObj.fileid}">
																					<i class='bx bxs-trash-alt'></i>
																				</button>
																			</div>
														 				</td>
														 			</tr>
														 			<tr>
														 				<td>
														 					<th:block th:if="${fileObj.FilePath != ''}">
																				<a th:href="${fileObj.FilePath}" target="_blank"> <th:block
																						th:if="${#strings.arraySplit(fileObj.FilePath,'.')[1]} == 'pdf'">
																						<img th:src="@{/assets/img/icons/misc/pdf.png}"
																							alt="PDF image" width="20" class="me-2">
																					</th:block> <th:block
																						th:unless="${#strings.arraySplit(fileObj.FilePath,'.')[1]} == 'pdf'">
																						<img th:src="@{/assets/img/icons/misc/jpg.png}"
																							alt="PDF image" width="20" class="me-2">
																					</th:block> <small class="text-body"
																					th:text="${#strings.substring(#strings.arraySplit(fileObj.FilePath,'/')[1],15)}">
																				</small>
																				</a>
																			</th:block>
														 				</td>
														 			</tr>
														 		</table>
														 	</div>
															
														</div>
													</div>

												</th:block>
												<span id="fidealdidv"></span>
											</div>
										</div>
									</div>
								</div>

								<!-- /Document   Card -->
							</div>
							<!-- User Content -->

							<!-- Add Document -->
							<div class="modal fade" id="addNewDocument" tabindex="-1"
								aria-hidden="true">
								<div
									class="modal-dialog modal-dialog-centered1 modal-simple modal-add-new-cc">
									<div class="modal-content p-3 p-md-5">
										<div class="modal-body">
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
											<div class="text-center mb-4">
												<h3>Add Document</h3>
												<p>Attach Files / Documents / Image</p>
											</div>
											<form id="addNewdocument" class="row g-3"
												onsubmit="return false">
												<div class="col-12">
													<label class="form-label w-100" for="modalAddCard">Document
														Type <label class="emptitle additem"
														name="addmodaldocumenttype"> <i
															class="bx bxs-plus-circle ownstyle1"></i></label>

													</label>
													<div class="input-group input-group-merge">
														<select id="modalDocumenttype"
															class="form-select modalDocumenttype">
															<option value="">Default select</option>
															<th:block th:each="str :${Documenttype}">
																<option th:value="${str}" th:text="${str}"></option>
															</th:block>

														</select>

													</div>
												</div>
												<div class="col-12">
													<label class="form-label" for="modalAddCardName">Document
														No </label> <input type="text" id="modalDocNo"
														class="form-control" />
												</div>
												<div class="col-12">
													<label class="form-label" for="modalAddCardExpiryDate">Upload
														File (Max File Size : 20MB) </label> <input type="file"
														id="modalFile" class="form-control"
														accept="image/jpeg,image/png,image/jpg,application/pdf" />
												</div>
												<div class="col-12 text-center mt-4">
													<button type="submit"
														class="btn btn-primary me-sm-3 me-1 documentsave">ADD</button>
													<button type="reset"
														class="btn btn-label-secondary btn-reset documentclose"
														data-bs-dismiss="modal" aria-label="Close">
														Cancel</button>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							<!--/ Add Document -->

							<!-- Edit User Modal -->
							<div class="modal fade" id="editdealMasterdetails" tabindex="-1"
								aria-hidden="true">
								<div class="modal-dialog modal-lg modal-simple modal-edit-user">
									<div class="modal-content p-3 p-md-5">

										<div class="modal-body">
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
											<div class="text-center mb-4">
												<h3>Edit Deal Information</h3>
												<p>Update Deal Basic Information</p>
											</div>
											<form id="editdealMasterdetailsForm"
												th:object="${dealMaster}" class="row g-3 needs-validation"
												onsubmit="return false">
												<input type="hidden" th:value="${dealMaster['id']}"
													id="dealMasterID" name="dealMasterID" />


												<div class="col-12 col-md-6">
													<label class="form-label" for="Title">TITLE</label>
													<div>
														<input type="text" id="Title" th:field="*{Title}"
															class="form-control  capitalize"
															th:value="${dealMaster['Title']}" required>

													</div>

												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="organization">ORAGNIZATION</label>
													<div>
														<select class="form-select followers form-control "
															id="organization" th:field="*{Organization}"
															th:value="${dealMaster['Organization']}">
															<option value="">-</option>
															<th:block th:each="str :${organizationlist}">
																<option th:value="${str.id}" th:text="${str.orgname}"></option>
															</th:block>
														</select>

														<div class="invalid-feedback">Please select
															follower.</div>
													</div>
												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="Source">SOURCE <label
														class="emptitle additem" name="addsourcedata"><i
															class="bx bxs-plus-circle ownstyle1"></i></label></label>
													<div>
														<select class="form-control  addsourcedata" id="Source"
															th:field="*{Source}" th:value="${dealMaster['Source']}">
															<th:block th:each="str :${SOURCE}">
																<option th:value="${str}" th:text="${str}"></option>
															</th:block>
														</select>
													</div>

												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="purpose">PURPOSE <label
														class="emptitle additem" name="addpurposedata"><i
															class="bx bxs-plus-circle ownstyle1"></i></label></label>
													<div>
														<select class="form-control  addpurposedata" id="purpose"
															th:field="*{purpose}" th:value="${dealMaster['purpose']}">
															<th:block th:each="str :${PURPOSE}">
																<option th:value="${str}" th:text="${str}"></option>
															</th:block>
														</select>
													</div>

												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="Source">VALUE</label>
													<div>
														<input type="number" id="dealvalue"
															th:field="*{dealvalue}" class="form-control  capitalize"
															th:value="${dealMaster['dealvalue']}">
													</div>

												</div>
												<div class="col-12 col-md-6 Referencediv">
													<label class="form-label" for="Reference">REFERENCE</label>
													<div>

														<select class="form-control " id="Reference"
															th:field="*{Reference}"
															th:value="${dealMaster['Reference']}">
															<option value="">-</option>
															<th:block th:each="str :${personlist}">
																<option th:value="${str.id}" th:text="${str.peoplename}"></option>
															</th:block>
														</select>
													</div>

												</div>

												<div class="col-12 col-md-6">
													<label class="form-label" for="pipeline">PIPELINE </label>
													<div>
														<select class="form-control" id="pipeline"
															th:field="*{pipeline}"
															th:value="${dealMaster['pipeline']}">
															<option value="Deal In">Deal In</option>
															<option value="Contact made">Contact made</option>
															<option value="Site Visit Scheduled">Site Visit
																Scheduled</option>
															<option value="Project Evaluvated">Project
																Evoluvated</option>
															<option value="Proposal made">Proposal made</option>
															<option value="Negotiations started">Negotiations
																started</option>
														</select>
													</div>
												</div>

												<div class="col-12 col-md-6">
													<label class="form-label" for="phonenumber">BRANCH</label>
													<div>
														<select class="form-select  form-control " id="branch"
															th:field="*{branch}" th:value="${dealMaster['branch']}"
															required>
															<th:block th:each="str :${branchlist}">
																<option th:value="${str.id}"
																	th:text="${str.BRANCH_NAME}"></option>
															</th:block>
														</select>

													</div>
												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="followers">FOLLOWER</label>
													<div>
														<select
															class="select2  form-select followers form-control "
															id="followers" name="follower" multiple="multiple"
															required>
															<th:block th:each="str :${employeelist}">
																<option th:value="${str.empMasterid}"
																	th:text="${str.StaffName}"></option>
															</th:block>
														</select>

														<div class="invalid-feedback">Please select
															follower.</div>
													</div>
												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="notes">NOTES</label>
													<div>

														<input type="text" id="notes" th:field="*{notes}"
															th:value="${dealMaster['notes']}"
															class="form-control  capitalize">
													</div>
												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="expectedclosingdate">Expected
														Closing Date</label>
													<div>

														<input type="text" id="expectedclosingdate"
															th:field="*{expectedclosingdate}"
															th:value="${dealMaster['expectedclosingdate']}"
															class="form-control  capitalize">
													</div>
												</div>


												<div class="col-12 text-center mt-4">
													<button type="submit"
														class="btn btn-primary editorganizationdatasubmit me-sm-3 me-1">Update</button>
													<button type="button"
														class="btn btn-label-secondary editorganizationdataclose"
														data-bs-dismiss="modal" aria-label="Close">Cancel</button>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							<!--/ Edit User Modal -->
							<!-- Edit People Modal -->
							<div class="modal fade" id="addNewperson" tabindex="-1"
								aria-hidden="true">
								<div
									class="modal-dialog modal-dialog-centered1 modal-simple modal-add-new-cc">
									<div class="modal-content p-3 p-md-5">

										<div class="modal-body">
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
											<div class="text-center mb-4">
												<h3>Create People Information</h3>
												<p>Update People Basic Information</p>
											</div>
											<form id="editPeopledetailsForm"
												class="row g-3 needs-validation" onsubmit="return false">

												<div class="col-12 ">


													<label class="form-label" for="Model_peoplename">Name</label>
													<input type="text" class="form-control"
														id="Model_peoplename" required />
													<div class="invalid-feedback">Please enter Person
														Name.</div>
												</div>

												<div class="col-12">
													<label class="form-label" for="Model_peoplecontact">Contact
														Number </label> <input type="text"
														class="form-control phone-number-otp-mask" pattern=".{12}"
														id="Model_peoplecontact" required />
													<div class="invalid-feedback">Please enter Contact.</div>
												</div>

												<div class="col-12 text-center mt-4">
													<button type="submit"
														class="btn btn-primary editpeopledatasubmit me-sm-3 me-1">ADD</button>
													<button type="reset"
														class="btn btn-label-secondary editpeopledataclose"
														data-bs-dismiss="modal" aria-label="Close">
														Cancel</button>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							<!--/ Edit People Modal -->
							<!-- Edit People Modal -->
							<div class="modal fade" id="linkperson" tabindex="-1"
								aria-hidden="true">
								<div
									class="modal-dialog modal-dialog-centered1 modal-simple modal-add-new-cc">
									<div class="modal-content p-3 p-md-5">

										<div class="modal-body">
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
											<div class="text-center mb-4">
												<h3>Link People Information</h3>
												<p>Update People Basic Information</p>
											</div>
											<form id="linkPeopledetailsForm" class="row g-3"
												onsubmit="return false">

												<div class="col-12 ">


													<label class="form-label" for="Model_linkpeoplename">People
														Name</label> <select class="form-select"
														aria-label="Default select example"
														id="Model_linkpeoplename" required>

														<option th:each="obj : ${contactPeopleList}"
															th:value="${obj.id}" th:text="${obj.peoplename}"></option>

													</select>

												</div>


												<div class="col-12 text-center mt-4">
													<button type="submit"
														class="btn btn-primary linkpeopledatasubmit me-sm-3 me-1">ADD</button>
													<button type="reset"
														class="btn btn-label-secondary linkpeopledataclose"
														data-bs-dismiss="modal" aria-label="Close">
														Cancel</button>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>
							<!--/ Edit People Modal -->

							<!--scrolling content Modal -->
							<div class="modal fade" id="ItemStatusScrollable" tabindex="-1"
								role="dialog" aria-labelledby="ItemStatusScrollableTitle"
								aria-hidden="true">
								<div class="modal-dialog modal-dialog-scrollable"
									role="document">
									<div class="modal-content">
										<div class="modal-header">
											<h5 class="modal-title white" id="ItemStatusScrollableTitle"></h5>
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
										</div>
										<div class="modal-body">
											<div class="col-md-12">
												<div class="form-group">
													<label for="addmodel" id="additemalltxt"></label>
													<div class="position-relative">
														<fieldset class="form-group">
															<input type="text" id="additemall" name="addmodel"
																class="form-control capitalize">
														</fieldset>
													</div>
												</div>
											</div>

										</div>
										<div class="modal-footer">
											<button type="button" class="btn btn-light-secondary"
												data-bs-dismiss="modal">
												<i class="bx bx-x d-block d-sm-none"></i> <span
													class="d-none d-sm-block">Close</span>
											</button>
											<button type="button" class="btn btn-primary ml-1"
												id="additemallsavebtn">
												<i class="bx bx-check d-block d-sm-none"></i> <span
													class="d-none d-sm-block">ADD</span>
											</button>
										</div>
									</div>
								</div>
							</div>
							<!--scrolling content Modal -->

							<!-- /Modal -->
						</div>
						<!-- / Content -->

						<!-- Footer -->
						<footer class="content-footer footer bg-footer-theme">
							<div
								class="container-fluid d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
								<div class="mb-2 mb-md-0"></div>
								<div></div>
							</div>
						</footer>
						<!-- / Footer -->

						<div class="content-backdrop fade"></div>
					</div>
					<!-- Content wrapper -->
				</div>
				<!-- / Layout page -->
			</div>

			<!-- Overlay -->
			<div class="layout-overlay layout-menu-toggle"></div>

			<!-- Drag Target Area To SlideIn Menu On Small Screens -->
			<div class="drag-target"></div>
		</div>
		<!-- / Layout wrapper -->


		<!-- Core JS -->
		<!-- build:js assets/vendor/js/core.js -->
		<script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
		<script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
		<script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

		<script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>

		<script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
		<script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>

		<script th:src="@{/assets/vendor/js/menu.js}"></script>
		<!-- endbuild -->

		<!-- Vendors JS -->
		<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-responsive/datatables.responsive.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/datatables-buttons.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.js}"></script>
		<script th:src="@{/assets/vendor/libs/jszip/jszip.js}"></script>
		<script th:src="@{/assets/vendor/libs/pdfmake/pdfmake.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/buttons.html5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/buttons.print.js}"></script>
		<script th:src="@{/assets/vendor/libs/sweetalert2/sweetalert2.js}"></script>
		<script th:src="@{/assets/vendor/libs/cleavejs/cleave.js}"></script>
		<script th:src="@{/assets/vendor/libs/cleavejs/cleave-phone.js}"></script>
		<script th:src="@{/assets/vendor/libs/select2/select2.js}"></script>


		<script th:src="@{/assets/vendor/libs/quill/quill.js}"></script>

		<!-- Main JS -->
		<script th:src="@{/assets/js/main.js}"></script>

		<!-- Flat Picker -->
		<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
		<script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.js}"></script>
		<script th:src="@{/assets/vendor/libs/pickr/pickr.js}"></script>
		<script th:src="@{/assets/vendor/libs/tagify/tagify.js}"></script>
		<script th:src="@{/assets/js/forms-selects.js}"></script>
		<!-- Page JS -->
		<!-- <script th:src="@{/assets/js/modal-edit-user.js}"></script> -->
		<script th:src="@{/assets/js/app-user-view.js}"></script>
		<script th:src="@{/assets/js/app-user-view-account.js}"></script>
		<script th:src="@{/assets/js/forms-editors.js}"></script>


		<script>
			$(document)
					.ready(
							function() {
								//--------------------------------------------------------------------------------------------------------------------------------------
								var ids="[[${dealMaster['id']}]]";
								$("#mastercategoryid").val(ids);
								$("#mastercategoryidnote").val(ids);
								
								var dealfollowerids="[[${dealMaster['dealfollowerids']}]]";
								$("#followers").val(dealfollowerids.split(",")).change();
								
								
								//--------------------------------------------------------------------------------------------------------------------------------------		 		

								$(function() {
									var token = $("meta[name='_csrf']").attr(
											"content");
									var header = $("meta[name='_csrf_header']")
											.attr("content");
									$(document).ajaxSend(
											function(e, xhr, options) {
												xhr.setRequestHeader(header,
														token);
											});
								});
								// --------------------------------------------------------------------
								
								
								
								//--------------------------------------------------------------------------------------------------------------------------------------
								// Custom list & inline suggestion
								//------------------------------------------------------
								$.ajax({
											type : "GET",
											url : "dealcplist",
											data : "",
											success : function(result) {

												const ContactPersonTagifyEl = document
														.querySelector('#ContactPersonTagify');

												const whitelist = result;
												// Inline
												let ContactPersonTagify = new Tagify(
														ContactPersonTagifyEl,
														{
															whitelist : whitelist,
															maxTags : 1,
															dropdown : {
																maxItems : 20,
																classname : 'tags-inline',
																enabled : 0,
																closeOnSelect : false
															}
														});

											}
										});
								//--------------------------------------------------------------------------------------------------------------------------------------		
								$(".Referencediv").hide();
								if($("#Source").val()=='Referral')
								{
									$(".Referencediv").show();
								}else
								{
									$(".Referencediv").hide();
								}
								
								$('#Source').change(function(){
									
									if($(this).val()=='Referral')
									{
										$(".Referencediv").show();
									}else
									{
										$(".Referencediv").hide();
									}
								});
								//--------------------------------------------------------------------------------------  

								function validationformreset() {

									$('.editorganizationdataclose').click();
									$('.editorganizationdatasubmit').prop(
											"disabled", false);
									$('.editorganizationdatasubmit').html(
											"Submit");
								}
								function validationlinkformreset() {
									$('.linkpeopledataclose').click();
									$('.linkpeopledatasubmit').prop("disabled",
											false);
									$('.linkpeopledatasubmit').html("Submit");
								}
								function validationformfilereset()
								   {
							   				$('.documentclose').click();
							   				$('.documentsave').prop("disabled",false);
								   			$('.documentsave').html("Submit");
								   }
								
								//--------------------------------------------------------------------------------------------------------------------------------------
								$("#startdate").change(function() {
									if($('#enddate').val() ==''){
										$('#enddate').val($(this).val());
									}
								});
								$("#starttime").change(function() {
									if($('#endtime').val() ==''){
										$('#endtime').val($(this).val());
									}
								});
								//--------------------------------------------------------------------------------------------------------------------------------------
								
								//--------------------------------------------------------------------------------------------------------------------------------------
								$('#editdealMasterdetailsForm').on('submit',function(event) {

													if (event.target.checkValidity()) {
														$('.editorganizationdatasubmit').prop("disabled",true);
														$('.editorganizationdatasubmit').html('<span class="spinner-border" role="status" aria-hidden="true"></span> Loading...');
														const formData = new FormData(document.querySelector("#editdealMasterdetailsForm"));
														
														formData.append("followers",$("#followers").val());
														/* for (var pair of formData.entries()) {
														   console.log(pair); 
														} */
														$.ajax({
																	type : "POST",
																	url : "dealsavestage2",
																	processData : false,
																	contentType : false,
																	data : formData,
																	success : function(result) {
																		var bmobj = JSON.parse(JSON.stringify(result));
																		//console.log(bmobj);
																			$('#Lbl_Title').text(bmobj.title);
																			$('#Lbl_Source').text(bmobj.source);
																			$('#Lbl_pipeline').text(bmobj.pipeline);
																			$('#Lbl_notes').text(bmobj.notes);
																			$('#Lbl_Reference').text(bmobj.referencename);
																			$("#Lbl_organization").text(bmobj.organizationName);
																			$("#Lbl_dealvalue").text(bmobj.dealvalue);
																			$("#Lbl_purpose").text(bmobj.purpose);
																			$("#Lbl_branchname").text(bmobj.branchname);
																			$("#Lbl_expectedclosingdate").text(bmobj.expectedclosingdateMMddYYY);
																			
																			
																			
																			$name ="";
																			
																			bmobj.dealFollowers.forEach((element, index, array) =>
																           	{
																           	    $name += element.followername+ "<br>";
																            });
																           	$('#Lbl_follower').html($name);
																           	
																			$('.editorganizationdataclose').click();
																			$('.editorganizationdatasubmit').prop("disabled",false);
																			$('.editorganizationdatasubmit').html("Submit");
																		

																	},
																	error : function(
																			e) {
																		console
																				.log("Error"
																						+ e);
																	}
																});
													} else {
														$(
																'.editorganizationdatasubmit')
																.prop(
																		"disabled",
																		false);
													}

												});
								// --------------------------------------------------------------------
								// File uploading 		  
					  					 const addNewdocumentForm =document.getElementById("addNewdocument");
					  					 const modalFile =document.getElementById("modalFile");
					  					 addNewdocumentForm.addEventListener("submit", e =>{
					  						 
					  						 if($('#modalDocNo').val() == '' && modalFile.files[0] == null)
					  				    	 {
					  					    	  Swal.fire({
					  							        title: '',
					  							        text: 'Either Document No (or) Upload file is mandatory!',
					  							        confirmButtonText: 'Ok',
					  							        customClass: {
					  							          confirmButton: 'btn btn-primary'
					  							        },
					  							        buttonsStyling: false
					  							      });
					  				   		 }else
					  				   		 {	 
							  						$('.documentsave').prop("disabled",true);
							  						$('.documentsave').html('<span class="spinner-border" role="status" aria-hidden="true"></span> Loading...');
							  						const endpoint ="fileuploadjson";
							  						const formdata= new FormData();
							  						//console.log(modalFile.files);
							  						
							  						formdata.append("File_Attach",modalFile.files[0]);
							  						formdata.append("DealID",$("#mastercategoryid").val());
							  						formdata.append("Documenttype",$('#modalDocumenttype').val());
							  						formdata.append("DocNo",$('#modalDocNo').val());
							  						formdata.append("functiontype","Deal");
							  						
							  						  $.ajax({
							  			   					type : "POST",url : endpoint,
							  			   					data : formdata,
							  			   					contentType: false,
							  			   	              processData: false,
							  			   					success : function(result) {
							  			   						
							  			   					tempobj =JSON.parse(JSON.stringify(result));
							  			   						
							  			   					console.log(tempobj);
							  								
								  							let tempresult = '<div class="cardMaster border p-3 rounded mb-3 filecard'+ tempobj.fileid  +'"><div>';		                              
								  							tempresult += '<table style="width: 100%;"><tr><td><h6 class="mb-1">'+ tempobj.documentType +'</h6></td>';
								  							tempresult += '<td><small class="text-muted filecreateddate" style="float:right">'+ tempobj.createddate +'</small></td></tr>';
								  							tempresult += '<tr><td><span class="card-number">'+ tempobj.documentNo +'</span></td>';
								  							tempresult += '<td rowspan="2"><div  style="float:right"><button class="btn btn-label-secondary filedeletebtn" name="'+ tempobj.fileid +'"   onClick="filedeleteoperation('+ tempobj.fileid +')"><i class="bx bxs-trash-alt"></i></button></div></td></tr>';
								  							tempresult += '<tr><td>';
								  							if(tempobj.filePath != '')
								  							{
								  								tempresult += '<a href="'+ tempobj.filePath +'" target="_blank">';
								  								if(tempobj.filePath.split(".")[1] == 'pdf')
							  									{
								  									tempresult += '<img src="assets/img/icons/misc/pdf.png" alt="PDF image" width="20" class="me-2">';
							  									}else
							 									{
							  										tempresult += '<img src="assets/img/icons/misc/jpg.png" alt="jp image" width="20" class="me-2">';
							 									}
								  								tempresult += '<span class="text-body"> ' + tempobj.filePath.split("/")[1].substring(15) + '</span>';
								  								tempresult += '</a>';
								  							}
								  							
								  							tempresult += '</td></tr></div></div></div></div>';
								  								
								  							$('#fidealdidv').before(tempresult);
								  							
							  			   					validationformfilereset();
							  			   					},
							  			   					error : function(e) {
							  			   						console.log("Error" + e);
							  			   					}
							  			   				});
					  				   		 }
					  					 });
					  				
								// --------------------------------------------------------------------

								$(".additem").click(function() {
									var name = $(this).attr('name');
									var labeltext = "";
									if (name == "addmodalcontacttype") {
										labeltext = "New Contact Type";
									} else if (name == "addmodaldocumenttype") {
										labeltext = "New Document Type";
									} else if (name == "addModel_Source") {
										labeltext = "New Industry Type";
									}else if (name == "addpurposedata") {
										labeltext = "New Purpose";
									}
									
									

									$('#additemalltxt').text(labeltext);
									$('#ItemStatusScrollable').modal('toggle');

								});

								$("#additemallsavebtn")
										.click(
												function() {
													if ($("#additemall").val() != '') {
														var name = $(
																'#additemalltxt')
																.text();
														var labeltext = "";
														if (name == "New Contact Type") {
															labeltext = "modalcontacttype";
														} else if (name == "New Document Type") {
															labeltext = "modalDocumenttype";
														} else if (name == "New Industry Type") {
															labeltext = "addModel_Source";
														} else if (name == "New Purpose") {
															labeltext = "addpurposedata";
														}

														$('.' + labeltext)
																.append(
																		"<option value='"
																				+ $(
																						"#additemall")
																						.val()
																				+ "'>"
																				+ $(
																						"#additemall")
																						.val()
																				+ "</option>");
														//$('.' + labeltext).val($("#additemall").val());
														$("#additemall")
																.val('');
														$(
																'#ItemStatusScrollable')
																.modal('toggle');
													}
												});

								// --------------------------------------------------------------------

								function validationformreset() {
									$('.editpeopledataclose').click();
									$('.editpeopledatasubmit').prop("disabled",
											false);
									$('.editpeopledatasubmit').html("Submit");
								}
								// --------------------------------------------------------------------
								$('#editPeopledetailsForm')
										.on(
												'submit',
												function(event) {

													if (event.target
															.checkValidity()) {
														$(
																'.editpeopledatasubmit')
																.prop(
																		"disabled",
																		true);
														$(
																'.editpeopledatasubmit')
																.html(
																		'<span class="spinner-border" role="status" aria-hidden="true"></span> Loading...');

														var dealMasterID = $(
																'#dealMasterID')
																.val();
														var peoplename = $(
																'#Model_peoplename')
																.val();
														var phonenumber = $(
																'#Model_peoplecontact')
																.val();
														var branch = $(
																"#branch")
																.val();
														var followers = $(
																"followers")
																.val();
														var organization = $(
																"organization")
																.val();
														var formData = {
															id : dealMasterID,
															category : 'Deal',
															organization : organization,
															branch : branch,
															peoplename : peoplename,
															phonenumber : phonenumber,
															followers : followers

														}
														$
																.ajax({
																	type : "POST",
																	url : "workcontactpersonsavejson",
																	data : formData,
																	success : function(
																			result) {
																		validationformreset();
																		var bmobj = JSON
																				.parse(JSON
																						.stringify(result));

																		let temphtml = '<div class="d-flex mb-3"> <div class="flex-grow-1 row"> <div class="col-9 mb-sm-0 mb-2"> <a href="contactpersonview?id='
																				+ bmobj
																				+ '" target="_blank"> <h6 class="mb-0">'
																				+ peoplename
																				+ '</h6></a> <small class="text-muted">'
																				+ phonenumber
																				+ '</small> </div> <div class="col-3 text-end"> <label class="switch me-0"> <input type="checkbox" class="switch-input" name="'
																				+ result
																				+ '" onclick="makeprimarycontactperson(this)"/> <span class="switch-toggle-slider"> <span class="switch-on"> <i class="bx bx-check"></i> </span> <span class="switch-off"> <i class="bx bx-x"></i> </span> </span> <span class="switch-label"></span> </label> </div> </div> </div>';
																		$(
																				'#contactpeopdealdidv')
																				.before(
																						temphtml);

																	},
																	error : function(
																			e) {
																		console
																				.log("Error"
																						+ e);

																	}

																});

													} else {
														$(
																'.editpeopledatasubmit')
																.prop(
																		"disabled",
																		false);
													}

												});
								// --------------------------------------------------------------------
								$('#linkPeopledetailsForm')
										.on(
												'submit',
												function(event) {

													if (event.target
															.checkValidity()) {
														$(
																'.linkpeopledatasubmit')
																.prop(
																		"disabled",
																		true);
														$(
																'.linkpeopledatasubmit')
																.html(
																		'<span class="spinner-border" role="status" aria-hidden="true"></span> Loading...');
														var dealMasterID = $(
																'#dealMasterID')
																.val();
														var linkpeoplename = $(
																'#Model_linkpeoplename')
																.val();

														var formData = {
															id : dealMasterID,
															category : 'Deal',
															linkpeoplename : linkpeoplename,

														}
														$
																.ajax({
																	type : "POST",
																	url : "workcontactlinkpersonsavejson",
																	data : formData,
																	success : function(
																			result) {

																		var bmobj = JSON
																				.parse(JSON
																						.stringify(result));
																		let primarymob = ""
																		if (bmobj.primarymob != null) {
																			primarymob = bmobj.primarymob;
																		}

																		let temphtml = '<div class="d-flex mb-3"> <div class="flex-grow-1 row"> <div class="col-9 mb-sm-0 mb-2"> <a href="contactpersonview?id='
																				+ bmobj.id
																				+ '" target="_blank"> <h6 class="mb-0">'
																				+ bmobj.peoplename
																				+ '</h6></a> <small class="text-muted">'
																				+ primarymob
																				+ '</small> </div> <div class="col-3 text-end"> <label class="switch me-0"> <input type="checkbox" class="switch-input" name="'
																				+ bmobj.id
																				+ '" onclick="makeprimarycontactperson(this)"/> <span class="switch-toggle-slider"> <span class="switch-on"> <i class="bx bx-check"></i> </span> <span class="switch-off"> <i class="bx bx-x"></i> </span> </span> <span class="switch-label"></span> </label> </div> </div> </div>';
																		$(
																				'#contactpeopdealdidv')
																				.before(
																						temphtml);
																		validationlinkformreset();
																	},
																	error : function(
																			e) {
																		console
																				.log("Error"
																						+ e);

																	}

																});

													} else {
														$(
																'.linkpeopledatasubmit')
																.prop(
																		"disabled",
																		false);
													}

												});
								
								//-------------------------------------------
								
							}); // Jquery

			//------------------------------------------------------
			function makeprimarycontactperson(elem) {

				var formData = {
					personid : elem.getAttribute("name"),
					primarystatus : elem.checked
				}
				$.ajax({
					type : "POST",
					url : "makeprimarycontactperson",
					data : formData,
					success : function(result) {

					},
					error : function(e) {
						console.log("Error" + e);
					}
				});
			}

			//------------------------------------------------------    
			 // Date Format
			   const flatpickrFriendly = document.querySelector('#expectedclosingdate');
				 // Human Friendly
				  if (flatpickrFriendly) {
				    flatpickrFriendly.flatpickr({
				      altInput: true,
				      altFormat: 'F j, Y',
				      dateFormat: 'Y-m-d'
				    });
				  }
			// Phone
			const phoneMask = document.querySelector('.phone-number-otp-mask');

			// Phone Number Input Mask
			if (phoneMask) {
				new Cleave(phoneMask, {
					phone : true,
					phoneRegionCode : 'US'
				});
			}
			
			//------------------------------------------------------    
			   function filedeleteoperation(id){
			    	 Swal.fire({
			             title: 'Are you sure?',
			             text: "You won't be able to revert this!",
			             icon: 'warning',
			             showCancelButton: true,
			             confirmButtonText: 'Yes, delete it!',
			             customClass: {
			               confirmButton: 'btn btn-primary me-3',
			               cancelButton: 'btn btn-label-secondary'
			             },
			             buttonsStyling: false
			           }).then(function (result) {
			             if (result.value) {
			              var formData = {
			            		  fileid: id,
			            		  functiontype : 'Deal'
			           	 }
			   			 $.ajax({
			   					type : "POST",url : "Filedeletejson",
			   					data : formData, success : function(result) {
			   						$('.filecard'+id).remove();
			   						Swal.fire({
			   				              icon: 'success',
			   				              title: 'Deleted!',
			   				              text: 'File has been deleted.',
			   				              customClass: {
			   				                confirmButton: 'btn btn-success'
			   				              }
			   				            });
			   					},
			   					error : function(e) {
			   						console.log("Error" + e);
			   					}
			   				});
			               
			               }
			           });
			    }
			  
			  	//------------------------------------------------------    
			  	  $('.filedeletebtn').on('click', function(event){
			    	  let id=$(this).attr("name");
			    	  filedeleteoperation(id);
			      });
			//------------------------------------------------------
			
		
			
		</script>
</body>
</html>
