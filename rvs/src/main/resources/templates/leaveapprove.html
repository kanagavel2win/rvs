<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="en"
	class="light-style layout-navbar-fixed layout-menu-fixed" dir="ltr"
	data-theme="theme-default" th:data-assets-path="@{/assets/}"
	data-template="vertical-menu-template">
<head>
<meta name="_csrf" th:content="${_csrf.token}" />
<!-- default header name is X-CSRF-TOKEN -->
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

<title>Leave Approval</title>

<meta name="description" content="" />



<!-- Favicon -->
<link rel="icon" type="image/x-icon"
	th:href="@{/assets/img/favicon/favicon.ico}" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
	rel="stylesheet" />

<!-- Icons -->
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/boxicons.css}" />
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/fontawesome.css}" />
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/flag-icons.css}" />

<!-- Core CSS -->
<link rel="stylesheet" th:href="@{/assets/vendor/css/rtl/core.css}"
	class="template-customizer-core-css" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/css/rtl/theme-default.css}"
	class="template-customizer-theme-css" />
<link rel="stylesheet" th:href="@{/assets/css/demo.css}" />

<!-- Vendors CSS -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/animate-css/animate.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/sweetalert2/sweetalert2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/select2/select2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/formvalidation/dist/css/formValidation.min.css}" />

<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/fullcalendar/fullcalendar.css}" />

<!-- Page CSS -->

<link rel="stylesheet"
	th:href="@{/assets/vendor/css/pages/page-user-view.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/css/pages/app-calendar.css}" />
<!-- Helpers -->
<script th:src="@{/assets/vendor/js/helpers.js}"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
<script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script th:src="@{/assets/js/config.js}"></script>

<style type="text/css">
</style>
<!-- END: Head-->

<!-- BEGIN: Body-->
</head>
<body>
	<div class="layout-wrapper layout-content-navbar">
		<div class="layout-container">
			<!-- Menu -->
			<div th:insert="menu"></div>
			<!-- / Menu -->

			<!-- Layout container -->
			<div class="layout-page">
				<!-- Navbar -->
				<div th:insert="header"></div>
				<!-- / Navbar -->

				<!-- Content wrapper -->
				<div class="content-wrapper">
					<!-- Content -->

					<div class="container-xxl flex-grow-1 container-p-y">
					<h4 class="py-3 breadcrumb-wrapper mb-4"><span class="text-muted fw-light">Administration/HR Management/Attendance/</span>Leave Approval</h4>
					
						<div class="card app-calendar-wrapper">
							<div class="row g-0">
								<!-- Calendar Sidebar -->
								<div class="col app-calendar-sidebar" id="app-calendar-sidebar">
									
									<div class="p-4">
										<!-- inline calendar (flatpicker) -->
										<div class="ms-n2">
											<div class="inline-calendar"></div>
										</div>

										<hr class="container-m-nx my-4">

										<!-- Filter -->
										<div class="mb-4">
											<small
												class="text-small text-muted text-uppercase align-middle">Filter</small>
										</div>
 
										<div class="form-check mb-2">
											<input class="form-check-input select-all" type="checkbox"
												id="selectAll" data-value="all" checked> <label
												class="form-check-label" for="selectAll">View All</label>
										</div>

										<div class="app-calendar-events-filter">

											<div class="form-check form-check-success mb-2">
												<input class="form-check-input input-filter" type="checkbox"
													id="select-Approved" data-value="Approved" checked> <label
													class="form-check-label" for="select-Approved">Approved</label>
											</div>
											
											<div class="form-check form-check-warning mb-2">
												<input class="form-check-input input-filter" type="checkbox"
													id="select-Pending" data-value="Pending" checked> <label
													class="form-check-label" for="select-Pending">Pending</label>
											</div>
											
											
											<div class="form-check form-check-danger mb-2">
												<input class="form-check-input input-filter" type="checkbox"
													id="select-Rejected" data-value="Rejected" checked> <label
													class="form-check-label" for="select-Rejected">Rejected</label>
											</div>

										</div>
									</div>
								</div>
								

								<!-- Calendar & Modal -->
								<div class="col app-calendar-content">
									<div class="card shadow-none border-0">
										<div class="card-body pb-0">
											<!-- FullCalendar -->
											<div id="calendar"></div>
										</div>
									</div>
									<div class="app-overlay"></div>
									<!-- FullCalendar Offcanvas -->
									<div class="offcanvas offcanvas-end event-sidebar"
										tabindex="-1" id="addEventSidebar"
										aria-labelledby="addEventSidebarLabel">
										<div class="offcanvas-header border-bottom">
											<h6 class="offcanvas-title" id="addEventSidebarLabel">View
												Leave</h6>
											<button type="button" class="btn-close text-reset"
												data-bs-dismiss="offcanvas" aria-label="Close"></button>
										</div>
										<div class="offcanvas-body">
											<form class="event-form pt-0" id="eventForm"
												onsubmit="return false">

												<div class="mb-3">
													<label class="form-label" for="eventTitle">Title</label> <input
														type="text" class="form-control" id="eventTitle"
														name="eventTitle" placeholder="Event Title">
													<div class="fv-plugins-message-container invalid-feedback"></div>
												</div>

												<div class="mb-3">
													<label class="form-label" for="eventType">Type</label> <select
														class="select2 form-select" id="eventType" name="Type">

														<option value="">-</option>
														 <option value="Personal">Personal</option>
								                         <option value="Sick">Sick</option>
								                         <option value="Vacation">Vacation</option>
								                         <option value="Permission">Permission</option>

													</select>
												</div>
												 
												<div class="mb-3">
													<label class="form-label" for="eventStartDate">Start
														Date</label> <input type="text" class="form-control"
														id="eventStartDate" name="eventStartDate"
														placeholder="Start Date" />
												</div>
												<div class="mb-3">
													<label class="form-label" for="eventEndDate">End
														Date</label> <input type="text" class="form-control"
														id="eventEndDate" name="eventEndDate"
														placeholder="End Date" />
												</div>
		
			
												<div class="mb-3">
              <label class="switch">
                <input type="checkbox" class="switch-input allDay-switch">
                <span class="switch-toggle-slider">
                  <span class="switch-on"></span>
                  <span class="switch-off"></span>
                </span>
                <span class="switch-label">Half Day</span>
              </label>
            </div>
            
            <div class="mb-3">
													<input type="time" class="form-control d-none"
														id="start-time" name="start-time"
														placeholder="start time" />
												</div>
												
											
											   <div class="mb-3">
													 <input type="time" class="form-control d-none"
														id="end-time" name="end-time"
														placeholder="end time" />
												</div>
													
												
												 
            
												<div class="mb-3">
													<label class="form-label" for="eventDescription">Description</label>
													<textarea class="form-control" name="eventDescription"
														id="eventDescription"></textarea>
												</div>
												<div
													class="mb-3 d-flex justify-content-sm-between justify-content-start my-4">
													<div>
														<button type="submit"
															class="btn btn-primary btn-add-event me-sm-3 me-1">Add</button>
															
															<button
															class="btn btn-label-danger btn-delete-event d-none">Rejected</button>
															
														<button type="reset"
															class="btn btn-label-secondary btn-cancel me-sm-0 me-1"
															data-bs-dismiss="offcanvas">Cancel</button>
													</div>
													<div>
														
													</div>
												</div>
											</form>
										</div>
									</div>
								</div>
								<!-- /Calendar & Modal -->
							</div>
						</div>

					</div>

					<!-- Footer -->
					<footer class="content-footer footer bg-footer-theme">
						<div
							class="container-fluid d-flex flex-wrap justify-content-between py-2 flex-md-row flex-column">
							<div class="mb-2 mb-md-0">
								©
								<script>
                    document.write(new Date().getFullYear());
                  </script>
								, made with ❤️ by <a href="https://pixinvent.com"
									target="_blank" class="footer-link fw-semibold">PIXINVENT</a>
							</div>
							<div>
								<a href="https://themeforest.net/licenses/standard"
									class="footer-link me-4" target="_blank">License</a> <a
									href="https://1.envato.market/pixinvent_portfolio"
									target="_blank" class="footer-link me-4">More Themes</a> <a
									href="https://pixinvent.com/demo/frest-clean-bootstrap-admin-dashboard-template/documentation-bs5/"
									target="_blank" class="footer-link me-4">Documentation</a> <a
									href="https://pixinvent.ticksy.com/" target="_blank"
									class="footer-link d-none d-sm-inline-block">Support</a>
							</div>
						</div>
					</footer>
					<!-- / Footer -->

					<div class="content-backdrop fade"></div>
				</div>
				<!-- Content wrapper -->
			</div>
			<!-- / Layout page -->
		</div>

		<!-- Overlay -->
		<div class="layout-overlay layout-menu-toggle"></div>

		<!-- Drag Target Area To SlideIn Menu On Small Screens -->
		<div class="drag-target"></div>
	</div>
	<!-- / Layout wrapper -->


	<!-- END: Footer-->



	<!-- Core JS -->
	<!-- build:js assets/vendor/js/core.js -->
	<script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
	<script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
	<script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

	<script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>

	<script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
	<script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>

	<script th:src="@{/assets/vendor/js/menu.js}"></script>
	<!-- endbuild -->

	<!-- Vendors JS -->
	<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
	<script th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-responsive/datatables.responsive.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons/datatables-buttons.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.js}"></script>
	<script th:src="@{/assets/vendor/libs/jszip/jszip.js}"></script>
	<script th:src="@{/assets/vendor/libs/pdfmake/pdfmake.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons/buttons.html5.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons/buttons.print.js}"></script>
	<script th:src="@{/assets/vendor/libs/sweetalert2/sweetalert2.js}"></script>
	<script th:src="@{/assets/vendor/libs/cleavejs/cleave.js}"></script>
	<script th:src="@{/assets/vendor/libs/cleavejs/cleave-phone.js}"></script>
	<script th:src="@{/assets/vendor/libs/select2/select2.js}"></script>
	<!-- Form Validation -->
	<script
		th:src="@{/assets/vendor/libs/formvalidation/dist/js/FormValidation.min.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js}"></script>

	<script th:src="@{/assets/vendor/libs/fullcalendar/fullcalendar.js}"></script>

	<!-- Main JS -->
	<script th:src="@{/assets/js/main.js}"></script>

	<!-- Flat Picker -->
	<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
	<script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.js}"></script>
	<script th:src="@{/assets/vendor/libs/pickr/pickr.js}"></script>

	<!-- Page JS -->
	<!-- <script th:src="@{/assets/js/modal-edit-user.js}"></script> -->
	<script th:src="@{/assets/js/app-user-view.js}"></script>
	<script th:src="@{/assets/js/app-user-view-account.js}"></script>
	<script>
  //--------------------------------------------------------------------------------------------------------------------------------------		 		
$(document).ready(function() {  
	$(function() {
		var token = $("meta[name='_csrf']").attr("content");
		var header = $("meta[name='_csrf_header']").attr("content");
		$(document).ajaxSend(function(e, xhr, options) {
			xhr.setRequestHeader(header, token);
		});
	});
});
	//--------------------------------------------------------------------------------------------------------------------------------------		 
	
    </script>
	<script th:src="@{/assets/js/app-calendar-events.js}"></script>

	

	<!-- END: Page JS-->
</body>
<!-- END: Body-->
<script>

 
let direction = 'ltr';

if (isRtl) {
  direction = 'rtl';
}

document.addEventListener('DOMContentLoaded', function () {
  (function () {
    const calendarEl = document.getElementById('calendar'),
      appCalendarSidebar = document.querySelector('.app-calendar-sidebar'),
      addEventSidebar = document.getElementById('addEventSidebar'),
      appOverlay = document.querySelector('.app-overlay'),
      calendarsColor = {
    	Approved: 'success',
    	Rejected: 'danger',
        Pending: 'warning',
      },
      offcanvasTitle = document.querySelector('.offcanvas-title'),
      btnToggleSidebar = document.querySelector('.btn-toggle-sidebar'),
      btnSubmit = document.querySelector('button[type="submit"]'),
      btnDeleteEvent = document.querySelector('.btn-delete-event'),
      btnCancel = document.querySelector('.btn-cancel'),
      eventTitle = document.querySelector('#eventTitle'),
      eventStartDate = document.querySelector('#eventStartDate'),
      allDaySwitch = document.querySelector('.allDay-switch'),
      eventEndDate = document.querySelector('#eventEndDate'),
      eventLabel = $('#eventLabel'), // ! Using jquery vars due to select2 jQuery dependency
      Type = document.querySelector('#eventType'), // ! Using jquery vars due to select2 jQuery dependency
      Branch = document.querySelector('#Branch'),
      eventDescription = document.querySelector('#eventDescription'),
   
      selectAll = document.querySelector('.select-all'),
      startime = document.querySelector('#start-time'),
      endtime = document.querySelector('#end-time'),
      filterInput = [].slice.call(document.querySelectorAll('.input-filter')),
      inlineCalendar = document.querySelector('.inline-calendar');

    let eventToUpdate,
      currentEvents = events, // Assign app-calendar-events.js file events (assume events from API) to currentEvents (browser store/object) to manage and update calender events
      isFormValid = false,
      inlineCalInstance;
    
    
 
    const bsAddEventSidebar = new bootstrap.Offcanvas(addEventSidebar);

     
    if (eventLabel.length) {
      function renderBadges(option) {
        if (!option.id) {
          return option.text;
        }
        var $badge =
          "<span class='badge badge-dot bg-" + $(option.element).data('label') + " me-2'> " + '</span>' + option.text;

        return $badge;
      }
      eventLabel.wrap('<div class="position-relative"></div>').select2({
        placeholder: 'Select value',
        dropdownParent: eventLabel.parent(),
        templateResult: renderBadges,
        templateSelection: renderBadges,
        minimumResultsForSearch: -1,
        escapeMarkup: function (es) {
          return es;
        }
      });
    }

    

    // Event start (flatpicker)
    if (eventStartDate) {
      var start = eventStartDate.flatpickr({
    	  enableTime: !0,
    	  altFormat: 'F j, Y',
	      dateFormat: 'F j, Y',
        onReady: function (selectedDates, dateStr, instance) {
          if (instance.isMobile) {
            instance.mobileInput.setAttribute('step', null);
          }
        }
      });
    }

    // Event end (flatpicker)
    if (eventEndDate) {
      var end = eventEndDate.flatpickr({
    	  enableTime: !0,
    	  altFormat: 'F j, Y',
	      dateFormat: 'F j, Y',
        onReady: function (selectedDates, dateStr, instance) {
          if (instance.isMobile) {
            instance.mobileInput.setAttribute('step', null);
          }
        }
      });
    }

    // Inline sidebar calendar (flatpicker)
    if (inlineCalendar) {
      inlineCalInstance = inlineCalendar.flatpickr({
        monthSelectorType: 'static',
        inline: true
      });
    }

    // Event click function
    function eventClick(info) {
      eventToUpdate = info.event;
      console.log(eventToUpdate._def.extendedProps.calendar);
      var stat = eventToUpdate._def.extendedProps.calendar;
          if(stat != 'Pending')
    	  {
        	  eventTitle.value = eventToUpdate.title;
              start.setDate(eventToUpdate.start, true, 'F j, Y');
              eventToUpdate.allDay === true ? (allDaySwitch.checked = true) : (allDaySwitch.checked = false);
              eventToUpdate.end !== null
                ? end.setDate(eventToUpdate.end, true, 'F j, Y')
                : end.setDate(eventToUpdate.start, true, 'F j, Y');
              //eventLabel.val(eventToUpdate.extendedProps.calendar).trigger('change');
              
              
             
              eventToUpdate.extendedProps.leavetype !== undefined ? (Type.value = eventToUpdate.extendedProps.leavetype) : null;
              //eventToUpdate.extendedProps.branch !== undefined ? (Branch.value = eventToUpdate.extendedProps.branch) : null;
              eventToUpdate.extendedProps.notes !== undefined
                ? (eventDescription.value = eventToUpdate.extendedProps.notes)
                : null;
    	  bsAddEventSidebar.show();
    	  btnDeleteEvent.classList.add('d-none');
    	  btnSubmit.classList.add('d-none');
    	  }
          else
        {
      bsAddEventSidebar.show();
      // For update event set offcanvas title text: Update Event
      
      if (offcanvasTitle) {
        offcanvasTitle.innerHTML = 'Leave Approval';
      }
      
      btnSubmit.classList.remove('d-none');
      btnSubmit.innerHTML = 'Approve';
      btnSubmit.classList.add('btn-update-event');
      btnSubmit.classList.remove('btn-add-event');
      btnDeleteEvent.classList.remove('d-none');

      eventTitle.value = eventToUpdate.title;
      start.setDate(eventToUpdate.start, true, 'F j, Y');
      eventToUpdate.allDay === true ? (allDaySwitch.checked = true) : (allDaySwitch.checked = false);
      eventToUpdate.end !== null
        ? end.setDate(eventToUpdate.end, true, 'F j, Y')
        : end.setDate(eventToUpdate.start, true, 'F j, Y');
      //eventLabel.val(eventToUpdate.extendedProps.calendar).trigger('change');
      
      
     
      eventToUpdate.extendedProps.leavetype !== undefined ? (Type.value = eventToUpdate.extendedProps.leavetype) : null;
      //eventToUpdate.extendedProps.branch !== undefined ? (Branch.value = eventToUpdate.extendedProps.branch) : null;
      eventToUpdate.extendedProps.notes !== undefined
        ? (eventDescription.value = eventToUpdate.extendedProps.notes)
        : null;
        
        
        }
     
    }

    // Modify sidebar toggler
    function modifyToggler() {
      const fcSidebarToggleButton = document.querySelector('.fc-sidebarToggle-button');
      fcSidebarToggleButton.classList.remove('fc-button-primary');
      fcSidebarToggleButton.classList.add('d-lg-none', 'd-inline-block', 'ps-0');
      while (fcSidebarToggleButton.firstChild) {
        fcSidebarToggleButton.firstChild.remove();
      }
      fcSidebarToggleButton.setAttribute('data-bs-toggle', 'sidebar');
      fcSidebarToggleButton.setAttribute('data-overlay', '');
      fcSidebarToggleButton.setAttribute('data-target', '#app-calendar-sidebar');
      fcSidebarToggleButton.insertAdjacentHTML('beforeend', '<i class="bx bx-menu bx-sm"></i>');
    }

    // Filter events by calender
    function selectedCalendars() {
      let selected = [],
        filterInputChecked = [].slice.call(document.querySelectorAll('.input-filter:checked'));

      filterInputChecked.forEach(item => {
        selected.push(item.getAttribute('data-value'));
      });
       
      console.log(selected)
      return selected;
    }

    // --------------------------------------------------------------------------------------------------
    // AXIOS: fetchEvents
    // * This will be called by fullCalendar to fetch events. Also this can be used to refetch events.
    // --------------------------------------------------------------------------------------------------


    // Init FullCalendar
    // ------------------------------------------------
    let { dayGrid, interaction, timeGrid, list } = calendarPlugins;
    let calendar = new Calendar(calendarEl, {
      initialView: 'dayGridMonth',
      events: 'leavehistoryjson?startdate=2022-01-01&enddate=2024-01-01',
      plugins: [interaction, dayGrid, timeGrid, list],
      editable: true,
      dragScroll: true,
      dayMaxEvents: 2,
      eventResizableFromStart: true,
      customButtons: {
        sidebarToggle: {
          text: 'Sidebar'
        }
      },
      headerToolbar: {
        start: 'sidebarToggle, prev,next, title',
        end: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
      },
      direction: direction,
      initialDate: new Date(),
      navLinks: true, // can click day/week names to navigate views
      eventClassNames: function ({ event: calendarEvent }) {
        const colorName = calendarsColor[calendarEvent._def.extendedProps.calendar];
        // Background Color
       var ob = calendarEvent._def.extendedProps;
       console.log(calendarEvent._def.extendedProps);
        console.log(calendarEvent._def.extendedProps.notes);
        return ['fc-event-' + colorName];
      },
      dateClick: function (info) {
    	  console.log(info);
        let date = moment(info.date).format('MMMM D, YYYY');
        resetValues();
        //bsAddEventSidebar.show();

        // For new event set offcanvas title text: Add Event
        if (offcanvasTitle) {
          offcanvasTitle.innerHTML = 'Add Holiday';
        }
        btnSubmit.innerHTML = 'Add';
        btnSubmit.classList.remove('btn-update-event');
        btnSubmit.classList.add('btn-add-event');
        btnDeleteEvent.classList.add('d-none');
        eventStartDate.value = date;
        eventEndDate.value = date;
      },
      eventClick: function (info) {
        eventClick(info);
      },
      datesSet: function () {
        modifyToggler();
      },
      viewDidMount: function () {
        modifyToggler();
      }
    });

    // Render calendar
    calendar.render();
    // Modify sidebar toggler
    modifyToggler();

    const eventForm = document.getElementById('eventForm');
    const fv = FormValidation.formValidation(eventForm, {
      fields: {
        eventTitle: {
          validators: {
            notEmpty: {
              message: 'Please enter event title '
            }
          }
        },
        eventStartDate: {
          validators: {
            notEmpty: {
              message: 'Please enter start date '
            }
          }
        },
        eventEndDate: {
          validators: {
            notEmpty: {
              message: 'Please enter end date '
            }
          }
        },
        Type: {
            validators: {
              notEmpty: {
                message: 'Please enter  Type'
              }
            }
          },
        Branch: {
            validators: {
              notEmpty: {
                message: 'Please enter Branch'
              }
            }
          }
      },
      plugins: {
        trigger: new FormValidation.plugins.Trigger(),
        bootstrap5: new FormValidation.plugins.Bootstrap5({
          // Use this for enabling/changing valid/invalid class
          eleValidClass: '',
          rowSelector: function (field, ele) {
            // field is the field name & ele is the field element
            return '.mb-3';
          }
        }),
        submitButton: new FormValidation.plugins.SubmitButton(),
        // Submit the form when all fields are valid
        // defaultSubmit: new FormValidation.plugins.DefaultSubmit(),
        autoFocus: new FormValidation.plugins.AutoFocus()
      }
    })
      .on('core.form.valid', function () {
        // Jump to the next step when all fields in the current step are valid
        isFormValid = true;
      })
      .on('core.form.invalid', function () {
        // if fields are invalid
        isFormValid = false;
      });

    // Sidebar Toggle Btn
    if (btnToggleSidebar) {
      btnToggleSidebar.addEventListener('click', e => {
        btnCancel.classList.remove('d-none');
      });
    }

    // Add Event
    // ------------------------------------------------
    function addEvent(eventData) {
      // ? Add new event data to current events object and refetch it to display on calender
      // ? You can write below code to AJAX call success response

      currentEvents.push(eventData);
      calendar.refetchEvents();

      // ? To add event directly to calender (won't update currentEvents object)
      // calendar.addEvent(eventData);
    }

    // Update Event
    // ------------------------------------------------
    function updateEvent(eventData) {
    
      eventData.id = parseInt(eventData.id);
      currentEvents[currentEvents.findIndex(el => el.id === eventData.id)] = eventData; // Update event by id
      calendar.refetchEvents();

      
    }

    // Remove Event
    // ------------------------------------------------

    function removeEvent(eventId) {
      
      currentEvents = currentEvents.filter(function (event) {
        return event.id != eventId;
      });
      calendar.refetchEvents();

    
    }

    // (Update Event In Calendar (UI Only)
    // ------------------------------------------------
    const updateEventInCalendar = (updatedEventData, propsToUpdate, extendedPropsToUpdate) => {
      const existingEvent = calendar.getEventById(updatedEventData.id);

    
      for (var index = 0; index < propsToUpdate.length; index++) {
        var propName = propsToUpdate[index];
        existingEvent.setProp(propName, updatedEventData[propName]);
      }

    
      existingEvent.setDates(updatedEventData.start, updatedEventData.end, {
        allDay: updatedEventData.allDay
      });

      
      for (var index = 0; index < extendedPropsToUpdate.length; index++) {
        var propName = extendedPropsToUpdate[index];
        existingEvent.setExtendedProp(propName, updatedEventData.extendedProps[propName]);
      }
    };

    // Remove Event In Calendar (UI Only)
    // ------------------------------------------------
    function removeEventInCalendar(eventId) {
      calendar.getEventById(eventId).remove();
    }

    // Add new event
    // ------------------------------------------------
    btnSubmit.addEventListener('click', e => {
      if (btnSubmit.classList.contains('btn-add-event')) {
        if (isFormValid) {
          let newEvent = {
            id: calendar.getEvents().length + 1,
            title: eventTitle.value,
            start: moment(eventStartDate.value).format('YYYY-MM-DD h:mm:ss'),
            end: moment(eventEndDate.value).format('YYYY-MM-DD h:mm:ss'),
            startStr: eventStartDate.value,
            endStr: eventEndDate.value,
            display: 'block',
            extendedProps: {
              type :Type.value,
              branch :Branch.value,
              calendar: eventLabel.val(),
              description: eventDescription.value
            }
          };
          
          var formData = {
				   calid : null,
				   fromdate : moment(eventStartDate.value).format('YYYY-MM-DD h:mm:ss'),
				   todate : moment(eventEndDate.value).format('YYYY-MM-DD h:mm:ss'),
				   title : eventTitle.value,
				   allDay : false,
				   type :Type.value,
				   branch :Branch.value,
				   calendar: eventLabel.val(),
				   description: eventDescription.value,	
			}
          
			$.ajax({
				type : "POST",
				url : "holidaysave",
				data : formData,
				success : function(result) {
					//console.log(result);
					calendar.refetchEvents();
				},
				error : function(e) {
					alert("Error" + e);
				}
			});
          
          
          //addEvent(newEvent);
          bsAddEventSidebar.hide();
          console.log(currentEvents);
        }
      } else {
        // Update event
        // ------------------------------------------------
        if (isFormValid) {
          let eventData = {
            id: eventToUpdate.id,
            title: eventTitle.value,
            start: moment(eventStartDate.value).format('YYYY-MM-DD h:mm:ss'),
            end: moment(eventEndDate.value).format('YYYY-MM-DD h:mm:ss'),
           
            extendedProps: {
            	type :Type.value,
                branch :Branch.value,
                calendar: eventLabel.val(),
                description: eventDescription.value
            },
            display: 'block',
      
          };
          
          var formData = {
				   calid : eventToUpdate.id,
				   fromdate : moment(eventStartDate.value).format('YYYY-MM-DD h:mm:ss'),
				   todate : moment(eventEndDate.value).format('YYYY-MM-DD h:mm:ss'),
				   title : eventTitle.value,
				   allDay : false,
				   type :Type.value,
				   branch :Branch.value,
				   calendar: eventLabel.val(),
				   description: eventDescription.value,	
			}
         
			$.ajax({
				type : "POST",
				url : "holidaysave",
				data : formData,
				success : function(result) {
					console.log(result);
					calendar.refetchEvents();
				},
				error : function(e) {
					alert("Error" + e);
				}
			});
          
          console.log(currentEvents);
          
          bsAddEventSidebar.hide();
        }
      }
    });

    // Call removeEvent function
    btnDeleteEvent.addEventListener('click', e => {
     // removeEvent(parseInt(eventToUpdate.id));
      // eventToUpdate.remove()
      
      
      var formData = {
			   calid : eventToUpdate.id
		}
    	$.ajax({
			type : "POST",
			url : "holidaydelete",
			data : formData,
			success : function(result) {
				console.log(result);
				calendar.refetchEvents();
			},
			error : function(e) {
				alert("Error" + e);
			}
		});
      
      bsAddEventSidebar.hide();
    });

    // Reset event form inputs values
    // ------------------------------------------------
    function resetValues() {
      eventTitle.value='';
      eventEndDate.value = '';
      eventStartDate.value = '';
      Type.value='';
      eventDescription.value='';
      //Branch.value='';
    }

    // When modal hides reset input values
    addEventSidebar.addEventListener('hidden.bs.offcanvas', function () {
      resetValues();
    });

    /* 
    btnToggleSidebar.addEventListener('click', e => {
      if (offcanvasTitle) {
        offcanvasTitle.innerHTML = 'Add Event';
      }
      btnSubmit.innerHTML = 'Add';
      btnSubmit.classList.remove('btn-update-event');
      btnSubmit.classList.add('btn-add-event');
      btnDeleteEvent.classList.add('d-none');
      appCalendarSidebar.classList.remove('show');
      appOverlay.classList.remove('show');
    });*/

    // Calender filter functionality
    // ------------------------------------------------
    if (selectAll) {
      selectAll.addEventListener('click', e => {
        if (e.currentTarget.checked) {
          document.querySelectorAll('.input-filter').forEach(c => (c.checked = 1));
        } else {
          document.querySelectorAll('.input-filter').forEach(c => (c.checked = 0));
        }
        console.log(selectAll);
        calendar.refetchEvents();
      });
    }

    if (filterInput) {
      filterInput.forEach(item => {
        item.addEventListener('click', () => {
          document.querySelectorAll('.input-filter:checked').length < document.querySelectorAll('.input-filter').length
            ? (selectAll.checked = false)
            : (selectAll.checked = true);
            console.log(filterInput);
          calendar.refetchEvents();
        });
      });
    }

    // Jump to date on sidebar(inline) calendar change
    inlineCalInstance.config.onChange.push(function (date) {
      calendar.changeView(calendar.view.type, moment(date[0]).format('YYYY-MM-DD'));
      modifyToggler();
      appCalendarSidebar.classList.remove('show');
      appOverlay.classList.remove('show');
    });
  })();
});

</script>



</html>