<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="en"
	class="light-style layout-navbar-fixed layout-menu-fixed" dir="ltr"
	data-theme="theme-default" th:data-assets-path="@{/assets/}"
	data-template="vertical-menu-template">
<head>
<meta name="_csrf" th:content="${_csrf.token}" />
<!-- default header name is X-CSRF-TOKEN -->
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

<title>Invoice Edit</title>

<meta name="description" content="" />

<!-- Favicon -->
<link rel="icon" type="image/x-icon"
	th:href="@{/assets/img/favicon/favicon.ico}" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
	rel="stylesheet" type="text/css" />

<!-- Icons -->
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/fonts/boxicons.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/fonts/fontawesome.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/fonts/flag-icons.css}" />

<!-- Core CSS -->
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/css/rtl/core.css}"
	class="template-customizer-core-css" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/css/rtl/theme-default.css}"
	class="template-customizer-theme-css" />
<link rel="stylesheet" type="text/css" th:href="@{/assets/css/demo.css}" />

<!-- Vendors CSS -->
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/sweetalert2/sweetalert2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/pickr/pickr-themes.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/tagify/tagify.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/select2/select2.css}" />

<!-- Row Group CSS -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.css}" />
<!-- Form Validation -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/formvalidation/dist/css/formValidation.min.css}" />


<!-- Page CSS -->

<!-- Helpers -->
<script th:src="@{/assets/vendor/js/helpers.js}"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
<script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script th:src="@{/assets/js/config.js}"></script>
<style>
#branchName, #branchemail, #branch_startdate {
	border-right: solid 1px #d4d8dd;
}

.tooltipx .tooltiptextx {
	visibility: hidden;
	font-size: 12px;
	min-width: 120px;
	background-color: black;
	color: #fff;
	text-align: center;
	border-radius: 6px;
	padding: 5px 0;
	/* Position the tooltip */
	position: absolute;
	z-index: 1;
}

.tooltipx:hover .tooltiptextx {
	visibility: visible;
}

.innertablefollowers td {
	border: none;
	padding-left: 0.1rem;
	padding-right: 0.1rem;
	margin: none;
}

.tooltipx {
	position: relative;
	display: inline-block;
}

.tooltipx .tooltiptextx {
	visibility: hidden;
	font-size: 12px;
	min-width: 120px;
	background-color: black;
	color: #fff;
	text-align: center;
	border-radius: 6px;
	padding: 5px 0;
	/* Position the tooltip */
	position: absolute;
	z-index: 1;
}

.tooltipx:hover .tooltiptextx {
	visibility: visible;
}

td {
	line-height: 20px;
}

.accordion-item
{

	border: 1px solid #ccc;
	padding-left: 10px;
}

.sameasInvoiceto {
	float: right;
	padding-left: 10px;
	font-weight: normal;
	font-size: 13px;
}


</style>
</head>

<body>
	<!-- Layout wrapper -->
	<div class="layout-wrapper layout-content-navbar">
		<div class="layout-container">
			<!-- Menu -->
			<div th:insert="menu"></div>
			<!-- / Menu -->

			<!-- Layout container -->
			<div class="layout-page">
				<!-- Navbar -->

				<div th:insert="header"></div>

				<!-- / Navbar -->

				
          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y">
              <div class="row invoice-edit">
               
                <!-- Invoice Edit-->
                <div class="col-lg-9 col-12 mb-lg-0 mb-4">
                 <form class="row g-3 needs-validation" id="editinvoiceformx"
												onsubmit="return false">
                  <div class="card invoice-preview-card">
                    <div class="card-body">
                      <div class="row p-sm-3 p-0">
                        <div class="col-md-6 mb-md-0 mb-4">
                          	<div class="d-flex svg-illustration mb-4 gap-2">
								<img th:src="@{/assets/img/logo/favicon.ico}" /> <span
									class="app-brand-text h3 mb-0 fw-bold">RVS
									Land Surveyors</span>
							</div>
							<p class="mb-1">29, Palani Illam, Sundaram Brothers
								Layout,</p>
							<p class="mb-1">Ramanathapuram, Coimbatore - 641045</p>
							<p class="mb-1">+ 91 96007 31477,
								accounts@rvsls.com.</p>
							<p class="mb-0">GSTIN/UIN: 33AASFR5322C1ZD</p>
                        </div>
                        <div class="col-md-6">
							<dl class="row mb-2">
								<dt class="col-sm-6 mb-2 mb-sm-0 text-md-end">
									<span class="text-capitalize mb-0 text-nowrap">Invoice No#</span>
								</dt>
								<dd class="col-sm-6 d-flex justify-content-md-end">
									<div class="w-px-150">
										<input type="text" class="form-control"
											id="invoiceNo" name="invoiceNo" placeholder="Will auto generate"  /> <input
											type="hidden" class="form-control" id="invoiceid"
											name="invoiceid" />
									</div>
								</dd>
								<dt class="col-sm-6 mb-2 mb-sm-0 text-md-end">
									<span class="fw-normal">Bill Type:</span>
								</dt>
								<dd class="col-sm-6 d-flex justify-content-md-end">
									<div class="w-px-150">
										<select id="invoiceType" name="invoiceType"
											class="form-select"
											aria-label="Default select example" required>
											<option value="">-</option>
											<option value="Tax Invoice">Tax Invoice</option>
											<option value="Proforma Invoice">Proforma
												Invoice</option>
											<option value="Bill">Bill</option>
										</select>
									</div>
								</dd>

								<dt class="col-sm-6 mb-2 mb-sm-0 text-md-end">
									<span class=" text-capitalize mb-0 text-nowrap">
										Date:</span>
								</dt>
								<dd class="col-sm-6 d-flex justify-content-md-end">
									<div class="w-px-150">
										<input type="date" class="form-control"
											id="invoiceDate" name="invoiceDate" required />
									</div>
								</dd>

								<dt class="col-sm-6 mb-2 mb-sm-0 text-md-end">
									<span class="fw-normal">Due Date:</span>
								</dt>
								<dd class="col-sm-6 d-flex justify-content-md-end">
									<div class="w-px-150">
										<input type="date" class="form-control date-picker"
											id="dueDate" name="dueDate" required />
									</div>
								</dd>

							</dl>
						</div>
					</div>
					
					<b>Project Name</b> 
					<select id="ProjectName" class="select2 form-select form-select-lg" data-allow-clear="true">
                          	<option>-</option>
                          <th:block th:each="obj :${projectls}">
                          		<option th:value="${obj.id}" th:text="${obj.Title} +'-('+${obj.projectID}+')'"></option>
                          </th:block>
                     </select>
                     
                      <hr class="my-4 mx-n4" />

                      <div class="row p-sm-3 p-0">
						<div class="col-md-6 col-sm-5 col-12 mb-sm-0 mb-4 "
							style="padding-right: 3%;">
							<h6 class="pb-2">Customer:</h6>
							<p class="row mb-1">
								<input type="text" class="col-12 form-control lxd"
									name="invoiceaddressline1" id="invoiceaddressline1"
									Placeholder="Address Line1" readonly />
							</p>
							<p class="row mb-1">
								<input type="text" class="col-12 form-control lxd"
									name="invoiceaddressline2" id="invoiceaddressline2"
									Placeholder="Address Line2" readonly/>
							</p>
							<p class="row mb-1">
								<input type="text" class="col-6 form-control lxd"
									name="invoiceaddresscity" id="invoiceaddresscity"
									Placeholder="City / District" style="width: 50%" readonly/>
								<input type="text" class="col-6 form-control lxd"
									name="invoiceaddresspincode"
									id="invoiceaddresspincode" Placeholder="Pincode"
									style="width: 50%" readonly/>
							</p>
							<p class="row mb-1">
								<input type="text" class="col-6 form-control lxd"
									name="invoiceaddressState" id="invoiceaddressState"
									Placeholder="State" style="width: 50%" readonly/> <input
									type="text" class="col-6 form-control lxd"
									name="invoiceGSTNo" id="invoiceGSTNo"
									Placeholder="GST" style="width: 50%" readonly/>
							</p>

						</div>
						<div class="col-md-6 col-sm-7">
							<h6 class="pb-2">
								Bill To: <label for="sameasInvoiceto"
									class="sameasInvoiceto">Same as Invoice to
									Address</label> <input type="checkbox"
									class="sameasInvoiceto" id="sameasInvoiceto"
									name="sameasInvoiceto" value="sameasInvoiceto">

							</h6>
							<p class="row mb-1">
								<input type="text" class="col-12 form-control lxd"
									name="billaddressline1" id="billaddressline1"
									Placeholder="Address Line1" readonly/>
							</p>
							<p class="row mb-1">
								<input type="text" class="col-12 form-control lxd"
									name="billaddressline2" id="billaddressline2"
									Placeholder="Address Line2" readonly/>
							</p>
							<p class="row mb-1">
								<input type="text" class="col-6 form-control lxd"
									name="billaddresscity" id="billaddresscity"
									Placeholder="City / District" style="width: 50%" readonly/>
								<input type="text" class="col-6 form-control lxd"
									name="billaddresspincode" id="billaddresspincode"
									Placeholder="Pincode" style="width: 50%" readonly/>
							</p>
							<p class="row mb-1">
								<input type="text" class="col-6 form-control lxd"
									name="billaddressState" id="billaddressState"
									Placeholder="State" style="width: 50%" readonly/> <input
									type="text" class="col-6 form-control lxd"
									name="billGSTNo" id="billGSTNo" Placeholder="GST"
									style="width: 50%" readonly/>
							</p>

						</div>
					</div>

                      <hr class="mx-n4" />

                     	<div class="mb-3" data-repeater-list="group-a">
							<div class="repeater-wrapper pt-0 pt-md-4"
								id="invoiceitemlist"></div>
						</div>
						<div class="row">
							<div class="col-12">
								<button type="button" class="btn btn-primary"
									id="addnewinvoiceitem">Add
									Item</button>
							</div>
						</div>
             

                      <hr class="my-4 mx-n4" />

                      <div class="row py-sm-3">
							<div class="col-6">
								<div class="mb-3">
									<label for="note" class="form-label fw-semibold">Note:</label>
									<textarea class="form-control" rows="2" id="note"
										name="note" placeholder="Invoice note"></textarea>
								</div>
							</div>
							<div class="col-md-6 d-flex justify-content-end">
								<div class="invoice-calculations">
									<div class="d-flex justify-content-between mb-2">
										<span class="w-px-100">Total:</span> <span
											class="fw-semibold" id="totalamtwithouttax">0.00</span>
									</div>
									<div
										class="d-flex justify-content-between mb-2 totaldiscountamountdiv">
										<span class="w-px-100">Discount:</span> <span
											class="fw-semibold" id=totaldiscountamount>0.00</span>
									</div>
									<div
										class="d-flex justify-content-between mb-2 totalCGSTdiv">
										<span class="w-px-100">CGST:</span> <span
											class="fw-semibold" id="totalCGST">0.00</span>
									</div>
									<div
										class="d-flex justify-content-between mb-2 totalSGSTdiv">
										<span class="w-px-100">SGST:</span> <span
											class="fw-semibold" id="totalSGST">0.00</span>
									</div>
									<div
										class="d-flex justify-content-between mb-2 totalIGSTdiv">
										<span class="w-px-100">IGST:</span> <span
											class="fw-semibold" id="totalIGST">0.00</span>
									</div>
									<hr />
									<div class="d-flex justify-content-between">
										<span class="w-px-100">Total Amount:</span> <span
											class="fw-semibold" id="totalamount">0.00</span>
										<input type="hidden" id="totalamount_hid" name="totalamount_hid" />
									</div>

								</div>
							</div>
						</div>

                      <hr class="my-4" />
						<div align="center">
								<button type="submit"
									class="btn btn-primary editInvoicesubmit me-sm-3 me-1">Save
								</button>

								<button type="reset"
									class="btn btn-label-secondary editInvoiceclose"
									data-bs-dismiss="modal" aria-label="Close">
									Cancel</button>

							</div>
                    </div>
                  </div>
                </form>
                </div>
                <!-- /Invoice Edit-->
				
                <!-- Invoice Actions -->
                <div class="col-lg-3 col-12 invoice-actions">
                  <div class="card mb-4">
                    <div class="card-body">
                      <button
                        class="btn btn-primary d-grid w-100"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#searchAddressOffcanvas" id="address_search"
                      >
                        <span class="d-flex align-items-center justify-content-center text-nowrap"
                          ><i class="bx bx-paper-plane bx-xs me-3"></i>Address</span
                        >
                      </button>
                      <div class="d-flex my-3">
                        <a th:href="'prjinvoiceprint?id='+ ${projectid} +'&inv='+ ${invoiceid}" target="_blank" class="btn btn-label-secondary w-100 me-6">Preview</a>
                        
                      </div>
                      <button
                        class="btn btn-primary d-grid w-100"
                        data-bs-toggle="offcanvas"
                        data-bs-target="#addPaymentOffcanvas"
                      >
                        <span class="d-flex align-items-center justify-content-center text-nowrap"
                          ><i class="bx bx-dollar bx-xs me-3"></i>Add Payment</span
                        >
                      </button>
                    </div>
                  </div>
                  <div>
                    <p class="mb-2">Accept payments via</p>
                    <select class="form-select mb-4">
                      <option value="Bank Account">Bank Account</option>
                      <option value="Paypal">Paypal</option>
                      <option value="Card">Credit/Debit Card</option>
                      <option value="UPI Transfer">UPI Transfer</option>
                    </select>
                  </div>
                </div>
                <!-- /Invoice Actions -->
              </div>

              <!-- Offcanvas -->
              <!-- Send Invoice Sidebar -->
              <div class="offcanvas offcanvas-end" id="searchAddressOffcanvas" aria-hidden="true">
                <div class="offcanvas-header border-bottom">
                  <h6 class="offcanvas-title">Available Address</h6>
                  <button
                    type="button"
                    class="btn-close text-reset"
                    data-bs-dismiss="offcanvas"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="offcanvas-body flex-grow-1 address_ls_div">
                 	
                </div>
              </div>
              <!-- /Send Invoice Sidebar -->
              <!-- Add Payment Sidebar -->
              <div class="offcanvas offcanvas-end" id="addPaymentOffcanvas" aria-hidden="true">
                <div class="offcanvas-header border-bottom">
                  <h6 class="offcanvas-title">Add Payment</h6>
                  <button
                    type="button"
                    class="btn-close text-reset"
                    data-bs-dismiss="offcanvas"
                    aria-label="Close"
                  ></button>
                </div>
                <div class="offcanvas-body flex-grow-1">
                  <div class="d-flex justify-content-between bg-lighter p-2 mb-3">
                    <p class="mb-0">Invoice Balance:</p>
                    <p class="fw-bold mb-0">$5000.00</p>
                  </div>
                  <form>
                    <div class="mb-3">
                      <label class="form-label" for="invoiceAmount">Payment Amount</label>
                      <div class="input-group">
                        <span class="input-group-text">$</span>
                        <input
                          type="text"
                          id="invoiceAmount"
                          name="invoiceAmount"
                          class="form-control invoice-amount"
                          placeholder="100"
                        />
                      </div>
                    </div>
                    <div class="mb-3">
                      <label class="form-label" for="payment-date">Payment Date</label>
                      <input id="payment-date" class="form-control invoice-date" type="text" />
                    </div>
                    <div class="mb-3">
                      <label class="form-label" for="payment-method">Payment Method</label>
                      <select class="form-select" id="payment-method">
                        <option value="" selected disabled>Select payment method</option>
                        <option value="Cash">Cash</option>
                        <option value="Bank Transfer">Bank Transfer</option>
                        <option value="Debit Card">Debit Card</option>
                        <option value="Credit Card">Credit Card</option>
                        <option value="Paypal">Paypal</option>
                      </select>
                    </div>
                    <div class="mb-4">
                      <label class="form-label" for="payment-note">Internal Payment Note</label>
                      <textarea class="form-control" id="payment-note" rows="2"></textarea>
                    </div>
                    <div class="mb-3 d-flex flex-wrap">
                      <button type="button" class="btn btn-primary me-3" data-bs-dismiss="offcanvas">Send</button>
                      <button type="button" class="btn btn-label-secondary" data-bs-dismiss="offcanvas">Cancel</button>
                    </div>
                  </form>
                </div>
              </div>
              <!-- /Add Payment Sidebar -->
              <!-- /Offcanvas -->
            </div>
            <!-- / Content -->
				</div>
				<!-- / Layout page -->
			</div>

			<!-- Overlay -->
			<div class="layout-overlay layout-menu-toggle"></div>

			<!-- Drag Target Area To SlideIn Menu On Small Screens -->
			<div class="drag-target"></div>
		</div>
	</div>
		<!-- / Layout wrapper -->

		<!-- Core JS -->
		<!-- build:js assets/vendor/js/core.js -->
		<script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
		<script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
		<script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

		<script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>

		<script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
		<script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>

		<script th:src="@{/assets/vendor/js/menu.js}"></script>
		<!-- endbuild -->

		<!-- Vendors JS -->
		<script
			th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-responsive/datatables.responsive.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/datatables-buttons.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.js}"></script>
		<script th:src="@{/assets/vendor/libs/jszip/jszip.js}"></script>
		<script th:src="@{/assets/vendor/libs/pdfmake/pdfmake.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/buttons.html5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/buttons.print.js}"></script>
		<!-- Flat Picker -->
		<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
		<script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.js}"></script>
		<script th:src="@{/assets/vendor/libs/pickr/pickr.js}"></script>

		<!-- Row Group JS -->
		<script
			th:src="@{/assets/vendor/libs/datatables-rowgroup/datatables.rowgroup.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.js}"></script>
		<script th:src="@{/assets/vendor/libs/sweetalert2/sweetalert2.js}"></script>
		<script th:src="@{/assets/vendor/libs/tagify/tagify.js}"></script>
		<script th:src="@{/assets/vendor/libs/cleavejs/cleave.js}"></script>
		<script th:src="@{/assets/vendor/libs/cleavejs/cleave-phone.js}"></script>
		<script th:src="@{/assets/vendor/libs/select2/select2.js}"></script>
		<!-- Form Validation -->
		<script
			th:src="@{/assets/vendor/libs/formvalidation/dist/js/FormValidation.min.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js}"></script>

		<!-- Main JS -->
		<script th:src="@{/assets/js/main.js}"></script>

		<!-- Page JS -->
		<!-- <script th:src="@{/assets/js/tables-datatables-basic.js}"></script> -->
		<script th:src="@{/assets/js/form-validation.js}"></script>
		
		<script th:src="@{/assets/js/forms-selects.js}"></script>
	    <script th:src="@{/assets/js/forms-tagify.js}"></script>
	    <script th:src="@{/assets/js/forms-typeahead.js}"></script>
		
		<script>
    $(document).ready(function() {  
    	
    	
    	//--------------------------------------------------------------------------------------------------------------------------------------		 		

		$(function() {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			$(document).ajaxSend(function(e, xhr, options) {
				xhr.setRequestHeader(header, token);
			});
		});
		
		//--------------------------------------------------------------------------------------------------------------------------------------		 
		var ids="[[${projectid}]]";
		var NATUREOFWORK="[[${NATUREOFWORK}]]";
		var UNITS="[[${UNITS}]]";
		
		$("#ProjectName").val(ids).change();
		NATUREOFWORK_temp="";
		
		var array = NATUREOFWORK.replace("[","").replace("]","").split(",");
		for(i=0;i<array.length;i++){
			NATUREOFWORK_temp += "<option value='" +array[i] + "'>"+array[i] + "</option>";
		}
		
		UNITS_temp="";
		var array = UNITS.replace("[","").replace("]","").split(",");
		for(i=0;i<array.length;i++){
			UNITS_temp += "<option value='" +array[i] + "'>"+array[i] + "</option>";
		}
		
		
		function validationinvoiceformreset()
		   {
	   				$('.editInvoiceclose').click();
	   				$('.editInvoicesubmit').prop("disabled",false);
	   				
	   				invoiceIncre=1;
	   				html='<div class="paddingTop d-flex border rounded position-relative pe-0 m-1 incontact'+ invoiceIncre + '"> <div class="row w-100 m-0 p-3"> 	<div class="col-md-4 col-12 mb-md-0 mb-3 ps-md-0"> <p class="mb-2 repeater-title">Item Description</p> <input type="hidden" id="InvoiceItemid'+ invoiceIncre +'" name="InvoiceItemid'+ invoiceIncre +'" /> <select class="form-select item-details mb-2" id="InvoiceItem'+ invoiceIncre +'" name="InvoiceItem'+ invoiceIncre +'" required> <option value="">-</option> ' + NATUREOFWORK_temp + '</select> <textarea class="form-control" rows="2" id="Description'+ invoiceIncre +'" name="Description'+ invoiceIncre +'" placeholder="Item Information"></textarea> 	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Qty</p> <input type="number"  step="any" class="form-control invoice-item-qty"  min="1" max="500" id="Quantity'+ invoiceIncre +'" name="Quantity'+ invoiceIncre +'" onchange="invoiceamountCalculator()" required /> <input type="text" class="form-control" value="998344" id="HSN'+ invoiceIncre +'" name="HSN'+ invoiceIncre +'" />	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Unit</p> <select class="form-select item-details mb-2" id="Unit'+ invoiceIncre +'" name="Unit'+ invoiceIncre +'" required> <option value="">-</option> '+ UNITS_temp +'  </select> 	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Price</p> <input type="number" class="form-control invoice-item-price mb-2" onchange="invoiceamountCalculator()" id="Price'+ invoiceIncre +'" name="Price'+ invoiceIncre +'" required/> <input type="hidden" id="Discountperip'+ invoiceIncre +'" value="0" name="Discountper'+ invoiceIncre +'" /> <input type="hidden" id="CGSTperip'+ invoiceIncre +'" value="0" name="CGSTper'+ invoiceIncre +'" /> <input type="hidden" id="IGSTperip'+ invoiceIncre +'" value="0" name="IGSTper'+ invoiceIncre +'" /> <input type="hidden" id="SGSTperip'+ invoiceIncre +'" value="0" name="SGSTper'+ invoiceIncre +'" /> 	 <div>  <span  data-bs-toggle="tooltip"  data-bs-offset="0,4" data-bs-placement="right" data-bs-html="true"	title="Discount %"	class="discount me-2" id="Discountpertxt'+  invoiceIncre +'">0%</span> <span class="tax-1 me-2" data-bs-toggle="tooltip" 	data-bs-placement="top" title="CGST %" 	id="CGSTpertxt'+  invoiceIncre +'">0%</span> <span class="tax-2" 	data-bs-toggle="tooltip" data-bs-placement="top" 	title="SGST %" id="SGSTpertxt'+  invoiceIncre +'">0%</span> <span 	class="tax-2" data-bs-toggle="tooltip" 	data-bs-placement="top" title="IGST %" 	id="IGSTpertxt'+  invoiceIncre +'">0%</span> </div> 	</div> 	<div class="col-md-2 col-12 pe-0"> <p class="mb-2 repeater-title">Taxable Amount</p> <p class="mb-0" id="taxableamount'+  invoiceIncre +'">0.00</p> 	</div> </div> <div 	class="d-flex flex-column align-items-center justify-content-between border-start p-2"> 	<i class="bx bx-x fs-4 text-muted cursor-pointer" onclick="deleteinvoiceItem('+ invoiceIncre +')"></i> 	<div class="dropdown"> <i class="bx bx-cog bx-xs text-muted cursor-pointer more-options-dropdown" role="button" id="dropdownMenuButton" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false"> </i> <div class="dropdown-menu dropdown-menu-end w-px-300 p-3" aria-labelledby="dropdownMenuButton"> <div class="row g-3"> 	<div class="col-12"> <label for="discountInput" class="form-label">Discount(%)</label> <input type="number" class="form-control" id="Discountper'+ invoiceIncre +'" min="0" max="100" /> 	</div> 	<div class="col-md-6"> <label for="taxInput1" class="form-label">CGST % 1</label> <select id="CGSTper'+ invoiceIncre +'" class="form-select tax-select CGST"> <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> 	<div class="col-md-6"> <label for="taxInput2" class="form-label">SGST % 2</label> <select id="SGSTper'+ invoiceIncre +'" class="form-select tax-select SGST"> <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> 	<div class="col-md-12"> <label for="taxInput2" class="form-label">IGST % 2</label> <select id="IGSTper'+ invoiceIncre +'" class="form-select tax-select IGST"  onchange="IGSTchange('+ invoiceIncre +')"> <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> </div> <div class="dropdown-divider my-3"></div> <button type="button" onclick="applydiscountandtax(this)" name="'+ invoiceIncre + '"	class="btn btn-label-primary btn-apply-changes">Apply</button> </div> 	</div> </div> </div>';
					$('#invoiceitemlist').html(html);
	   				
	   				invoiceamountCalculator();
		   			$('.editInvoicesubmit').html("Save");
		   			
		   }
		
		//--------------------------------------------------------------------------------------------------------------------------------------		 
		
		//--------------------------------------------------------------------------------------------------------------------------------------
		$('#editinvoiceformx').on('submit',function(event) {
			if (event.target.checkValidity()) {
				$('.editInvoicesubmit').prop("disabled",true);
				$('.editInvoicesubmit').html('<span class="spinner-border" role="status" aria-hidden="true"></span> Loading...');
				const formData = new FormData(document.querySelector("#editinvoiceformx"));
				formData.append("projectid","[[${projectid}]]");
				formData.append("invoiceitemcount", invoiceIncre);
				
				$.ajax({
					type : "POST",
					url : "projectinvoicesave",
					processData : false,
					contentType : false,
					data : formData,
					success : function(
							result) {
						
						validationinvoiceformreset();
						
						Swal.fire({
					        title: 'Invoice Saved Successfully!',
					        text: 'Share it to the customer',
					        imageUrl: assetsPath + 'img/bg_rvs/New Project Added.jpg',
					        imageWidth: 400,
					        imageAlt: 'Custom image',
					        confirmButtonText: 'Ok',
					        customClass: {
					          confirmButton: 'btn btn-primary'
					        },
					        buttonsStyling: false
					      });
						

					},
					error : function(e) {
						console.log("Error"+ e);
					}
				});
			} else {
				$('.editInvoicesubmit').prop("disabled",false);
			}
		});
		// --------------------------------------------------------------------
		
		$("#addnewinvoiceitem").click(function() {
			invoiceIncre = invoiceIncre+1;
			
			html='<div class="d-flex border rounded position-relative pe-0 m-1 incontact'+ invoiceIncre + '"> <div class="row w-100 m-0 p-3"> 	<div class="col-md-4 col-12 mb-md-0 mb-3 ps-md-0"> <p class="mb-2 repeater-title">Item Description</p> <input type="hidden" id="InvoiceItemid'+ invoiceIncre +'" name="InvoiceItemid'+ invoiceIncre +'" /> <select class="form-select item-details mb-2" id="InvoiceItem'+ invoiceIncre +'" name="InvoiceItem'+ invoiceIncre +'" required> <option value="">-</option> ' + NATUREOFWORK_temp + '</select> <textarea class="form-control" rows="2" id="Description'+ invoiceIncre +'" name="Description'+ invoiceIncre +'" placeholder="Item Information"></textarea> 	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Qty</p> <input type="number" step="any" class="form-control invoice-item-qty"  min="1" max="500" id="Quantity'+ invoiceIncre +'" name="Quantity'+ invoiceIncre +'" onchange="invoiceamountCalculator()" required />  <input type="text" class="form-control" value="998344" id="HSN'+ invoiceIncre +'" name="HSN'+ invoiceIncre +'" />	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Unit</p> <select class="form-select item-details mb-2" id="Unit'+ invoiceIncre +'" name="Unit'+ invoiceIncre +'" required> <option value="">-</option> '+ UNITS_temp +'  </select> 	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Price</p> <input type="number" class="form-control invoice-item-price mb-2" onchange="invoiceamountCalculator()" id="Price'+ invoiceIncre +'" name="Price'+ invoiceIncre +'" required/> <input type="hidden" id="Discountperip'+ invoiceIncre +'" value="0" name="Discountper'+ invoiceIncre +'" /> <input type="hidden" id="CGSTperip'+ invoiceIncre +'" value="0" name="CGSTper'+ invoiceIncre +'" /> <input type="hidden" id="IGSTperip'+ invoiceIncre +'" value="0" name="IGSTper'+ invoiceIncre +'" /> <input type="hidden" id="SGSTperip'+ invoiceIncre +'" value="0" name="SGSTper'+ invoiceIncre +'" /> 	 <div>  <span  data-bs-toggle="tooltip" data-bs-placement="top" 	title="Discount %"	class="discount me-2" id="Discountpertxt'+  invoiceIncre +'">0%</span> <span class="tax-1 me-2" data-bs-toggle="tooltip" 	data-bs-placement="top" title="CGST %" 	id="CGSTpertxt'+  invoiceIncre +'">0%</span> <span class="tax-2" 	data-bs-toggle="tooltip" data-bs-placement="top" 	title="SGST %" id="SGSTpertxt'+  invoiceIncre +'">0%</span> <span 	class="tax-2" data-bs-toggle="tooltip" 	data-bs-placement="top" title="IGST %" 	id="IGSTpertxt'+  invoiceIncre +'">0%</span> </div> 	</div> 	<div class="col-md-2 col-12 pe-0"> <p class="mb-2 repeater-title">Taxable Amount</p> <p class="mb-0" id="taxableamount'+  invoiceIncre +'">0.00</p> 	</div> </div> <div 	class="d-flex flex-column align-items-center justify-content-between border-start p-2"> 	<i class="bx bx-x fs-4 text-muted cursor-pointer" onclick="deleteinvoiceItem('+ invoiceIncre +')"></i> 	<div class="dropdown"> <i class="bx bx-cog bx-xs text-muted cursor-pointer more-options-dropdown" role="button" id="dropdownMenuButton" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false"> </i> <div class="dropdown-menu dropdown-menu-end w-px-300 p-3" aria-labelledby="dropdownMenuButton"> <div class="row g-3"> 	<div class="col-12"> <label for="discountInput" class="form-label">Discount(%)</label> <input type="number" class="form-control" id="Discountper'+ invoiceIncre +'" min="0" max="100" /> 	</div> 	<div class="col-md-6"> <label for="taxInput1" class="form-label">CGST % 1</label> <select id="CGSTper'+ invoiceIncre +'" class="form-select tax-select CGST"> <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> 	<div class="col-md-6"> <label for="taxInput2" class="form-label">SGST % 2</label> <select id="SGSTper'+ invoiceIncre +'" class="form-select tax-select SGST"> <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> 	<div class="col-md-12"> <label for="taxInput2" class="form-label">IGST % 2</label> <select id="IGSTper'+ invoiceIncre +'" class="form-select tax-select IGST" onchange="IGSTchange('+ invoiceIncre +')"> <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> </div> <div class="dropdown-divider my-3"></div> <button type="button" onclick="applydiscountandtax(this)" name="'+ invoiceIncre + '"	class="btn btn-label-primary btn-apply-changes">Apply</button> </div> 	</div> </div> </div>';
			$('#invoiceitemlist').append(html);
			$('#invoiceType').change();
		});
		
		//--------------------------------------------------------------------------------------------------------------------------------------
		$('#amount').on('change',function(event) {
			var amount = $('#amount').val();
			
			
			if(amount > parseFloat($('#invoiceBalancetxt').text()))
			{
				$('#amount').val($('#invoiceBalancetxt').text());
			}
			
		});
		//-------------------------------------------
		function calctotalamount(){
			let modalQuantity=	$("#modalQuantity").val();
			let modalPrice=	$("#modalPrice").val();
			
			if(modalPrice !='' && modalQuantity!=''){
				$("#modalTotalamount").val((modalPrice * modalQuantity));	
			}
			
		}
		
		$("#modalQuantity").change(function(){
			
			calctotalamount();
		});
	
		
		$("#modalPrice").change(function(){
			calctotalamount();
		});
		//-------------------------------------------
		$(document).ready(function(){
		    setTimeout(function(){
		    	
		    	
		    	editinvoiceinfo();
		    	
		     },20); // milliseconds
		     
		   
		});
		
		//-------------------------------------------
		$('#sameasInvoiceto').change(function() {
	        if(this.checked) {
	         $("#billaddressline1").val($("#invoiceaddressline1").val());
	         $("#billaddressline2").val($("#invoiceaddressline2").val());
	         $("#billaddresscity").val($("#invoiceaddresscity").val());
	         $("#billaddressState").val($("#invoiceaddressState").val());
	         $("#billaddresspincode").val($("#invoiceaddresspincode").val());
	         $("#billGSTNo").val($("#invoiceGSTNo").val());
	        }							              
	    });

		
		//-------------------------------------------
		
		
    });// End Jquery
    
  //------------------------------------------------------    
	 
	 function editinvoiceinfo(){
			var invoiceid= "[[${invoiceid}]]";
			
				var formData = {
					projectid : invoiceid,
					mastercategoryid: "[[${projectid}]]"
				}

				$.ajax({
					type : "POST",
					url : "getinvoiceitem",
					data : formData,
					success : function(result) {
						var bmobj = JSON.parse(JSON.stringify(result));
						//console.log(bmobj);
						
						$("#invoiceid").val(bmobj.invoiceid);
						$("#invoiceNo").val(bmobj.invoiceNo);
						$("#invoiceDate").val(bmobj.invoiceDate);
						$("#dueDate").val(bmobj.dueDate);
						$("#invoiceType").val(bmobj.invoiceType).change();
						$("#receivable").val(bmobj.receivable).change();
						$("#GSTCode").val(bmobj.gstcode).change();
						$("#invoiceaddressline1").val(bmobj.invoiceaddressline1);
						$("#invoiceaddressline2").val(bmobj.invoiceaddressline2);
						$("#invoiceaddresscity").val(bmobj.invoiceaddresscity);
						$("#invoiceaddressState").val(bmobj.invoiceaddressState);
						$("#invoiceaddresspincode").val(bmobj.invoiceaddresspincode);
						//$("#invoiceMobileno").val(bmobj.invoiceMobileno);
						//$("#invoiceEmail").val(bmobj.invoiceEmail);
						$("#invoiceGSTNo").val(bmobj.invoiceGSTNo);
						$("#billaddressline1").val(bmobj.billaddressline1);
						$("#billaddressline2").val(bmobj.billaddressline2);
						$("#billaddresscity").val(bmobj.billcity);
						$("#billaddressState").val(bmobj.billstate);
						$("#billaddresspincode").val(bmobj.billpincode);
						//$("#billMobileno").val(bmobj.billMobileno);
						//$("#billEmail").val(bmobj.billEmail);
						$("#billGSTNo").val(bmobj.billGSTNo);
						$("#note").val(bmobj.notes);

						invoiceIncre = 0 ;
						html="";
						bmobj.invoiceItemMasterlist.forEach((element, index, array) =>
			           	{
			           	 	invoiceIncre= invoiceIncre+1;
							html +='<div class="d-flex border rounded position-relative pe-0 m-1 incontact'+ invoiceIncre + '"> <div class="row w-100 m-0 p-3"> 	<div class="col-md-4 col-12 mb-md-0 mb-3 ps-md-0"> <p class="mb-2 repeater-title">Item Description</p> <input type="hidden" id="InvoiceItemid'+ invoiceIncre +'" name="InvoiceItemid'+ invoiceIncre +'" value="'+ element.invoiceitemid + '"/> <select class="form-select item-details mb-2" id="InvoiceItem'+ invoiceIncre +'" name="InvoiceItem'+ invoiceIncre +'" required> <option value="'+ element.invoiceItem + '">'+ element.invoiceItem + '</option> ' + NATUREOFWORK_temp + '</select> <textarea class="form-control" rows="2" id="Description'+ invoiceIncre +'" name="Description'+ invoiceIncre +'" placeholder="Item Information">'+ element.description + '</textarea> 	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Qty</p> <input type="number" step="any" class="form-control invoice-item-qty"  min="1" max="500" id="Quantity'+ invoiceIncre +'" value="'+ element.quantity + '" name="Quantity'+ invoiceIncre +'" onchange="invoiceamountCalculator()" required />  <input type="text" class="form-control" id="HSN'+ invoiceIncre +'" value="'+ element.hsn + '" name="HSN'+ invoiceIncre +'" /> 	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Unit</p> <select class="form-select item-details mb-2" id="Unit'+ invoiceIncre +'" name="Unit'+ invoiceIncre +'" required> <option value="'+ element.unit + '">'+ element.unit + '</option> '+ UNITS_temp +'  </select> 	</div> 	<div class="col-md-2 col-12 mb-md-0 mb-3"> <p class="mb-2 repeater-title">Price</p> <input type="number" class="form-control invoice-item-price mb-2" onchange="invoiceamountCalculator()" id="Price'+ invoiceIncre +'" name="Price'+ invoiceIncre +'"  value="'+ element.price + '" required/> <input type="hidden" id="Discountperip'+ invoiceIncre +'" value="'+ element.discountper + '" name="Discountper'+ invoiceIncre +'" /> <input type="hidden" id="CGSTperip'+ invoiceIncre +'" value="'+ element.cgstper + '" name="CGSTper'+ invoiceIncre +'" /> <input type="hidden" id="IGSTperip'+ invoiceIncre +'" value="'+ element.igstper + '" name="IGSTper'+ invoiceIncre +'" /> <input type="hidden" id="SGSTperip'+ invoiceIncre +'" value="'+ element.sgstper + '" name="SGSTper'+ invoiceIncre +'" /> 	 <div>  <span  data-bs-toggle="tooltip" data-bs-placement="top" 	title="Discount %"	class="discount me-2" id="Discountpertxt'+  invoiceIncre +'">'+ element.discountper + '%</span> <span class="tax-1 me-2" data-bs-toggle="tooltip" 	data-bs-placement="top" title="CGST %" 	id="CGSTpertxt'+  invoiceIncre +'">'+ element.cgstper + '%</span> <span class="tax-2" 	data-bs-toggle="tooltip" data-bs-placement="top" 	title="SGST %" id="SGSTpertxt'+  invoiceIncre +'">'+ element.sgstper + '%</span> <span 	class="tax-2" data-bs-toggle="tooltip" 	data-bs-placement="top" title="IGST %" 	id="IGSTpertxt'+  invoiceIncre +'">'+ element.igstper + '%</span> </div> 	</div> 	<div class="col-md-2 col-12 pe-0"> <p class="mb-2 repeater-title">Taxable Amount</p> <p class="mb-0" id="taxableamount'+  invoiceIncre +'">'+ element.taxableAmount.toFixed(2) +'</p> 	</div> </div> <div 	class="d-flex flex-column align-items-center justify-content-between border-start p-2"> 	<i class="bx bx-x fs-4 text-muted cursor-pointer" onclick="deleteinvoiceItem('+ invoiceIncre +')"></i> 	<div class="dropdown"> <i class="bx bx-cog bx-xs text-muted cursor-pointer more-options-dropdown" role="button" id="dropdownMenuButton" data-bs-toggle="dropdown" data-bs-auto-close="outside" aria-expanded="false"> </i> <div class="dropdown-menu dropdown-menu-end w-px-300 p-3" aria-labelledby="dropdownMenuButton"> <div class="row g-3"> 	<div class="col-12"> <label for="discountInput" class="form-label">Discount(%)</label> <input type="number" class="form-control" id="Discountper'+ invoiceIncre +'" min="0" max="100" value="'+ element.discountper+'" /> 	</div> 	<div class="col-md-6"> <label for="taxInput1" class="form-label">CGST % 1</label> <select id="CGSTper'+ invoiceIncre +'" class="form-select tax-select CGST"> <option value="'+ element.cgstper +'" >'+ element.cgstper +'%</option> <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> 	<div class="col-md-6"> <label for="taxInput2" class="form-label">SGST % 2</label> <select id="SGSTper'+ invoiceIncre +'" class="form-select tax-select SGST"><option value="'+ element.sgstper +'" >'+ element.sgstper +'%</option>  <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> 	<div class="col-md-12"> <label for="taxInput2" class="form-label">IGST % 2</label> <select id="IGSTper'+ invoiceIncre +'" class="form-select tax-select IGST"  onchange="IGSTchange('+ invoiceIncre +')"><option value="'+ element.igstper +'" >'+ element.igstper +'%</option>  <option value="0" >0%</option> <option value="1.5">1.5%</option> <option value="2.5">2.5%</option><option value="6">6%</option><option value="9">9%</option><option value="10">10%</option> <option value="14">14%</option> <option value="18">18%</option> </select> 	</div> </div> <div class="dropdown-divider my-3"></div> <button type="button" onclick="applydiscountandtax(this)" name="'+ invoiceIncre + '"	class="btn btn-label-primary btn-apply-changes">Apply</button> </div> 	</div> </div> </div>';
			           	});
			           	
						$('#invoiceitemlist').html(html);
						invoiceamountCalculator();
						//$('#invoicemodel').modal('show');
					},
					error : function(e) {
						console.log("Error" + e);
					}
				});
			
		}
	//------------------------------------------------------
 // Date Format
	   const flatpickrFriendly = document.querySelector('#expectedclosingdate');
		 // Human Friendly
		  if (flatpickrFriendly) {
		    flatpickrFriendly.flatpickr({
		      altInput: true,
		      altFormat: 'F j, Y',
		      dateFormat: 'Y-m-d'
		    });
		  }
		 
		  const expectedstartdateX1 = document.querySelector('#startdateX1');
			 // Human Friendly
			  if (expectedstartdateX1) {
				  expectedstartdateX1.flatpickr({
			      altInput: true,
			      altFormat: 'F j, Y',
			      dateFormat: 'Y-m-d'
			    });
			  }
			 
			 //
			 
			 const tdate = document.querySelector('#tdate');
			 // Human Friendly
			  if (tdate) {
				  tdate.flatpickr({
			      altInput: true,
			      altFormat: 'F j, Y',
			      dateFormat: 'Y-m-d'
			    });
			  }
			 
			 
		  const invoiceDate = document.querySelector('#invoiceDatex');
			 // Human Friendly
			  if (invoiceDate) {
				  invoiceDate.flatpickr({
			      altInput: true,
			      altFormat: 'F j, Y',
			      dateFormat: 'Y-m-d'
			    });
			  }
				 
		  const duedate = document.querySelector('#dueDatex');
			 // Human Friendly
			  if (duedate) {
				  duedate.flatpickr({
			      altInput: true,
			      altFormat: 'F j, Y',
			      dateFormat: 'Y-m-d'
			    });
			  }
	//----------------------------------------------------------
		
			//
			// 
			$('.invoice-item-qty').on('change',function(event) {
				invoiceamountCalculator();
				
			});
			$('.invoice-item-price').on('change',function(event) {
				invoiceamountCalculator();
				
			});
			
			//------------------------------------------------------------------------------------
			function IGSTchange(id){
				if($("#IGSTper"+ id).val()>0)
				{
					$("#CGSTper"+ id).val("0").change();
					$("#SGSTper"+ id).val("0").change();		
				}
		
			}
			//------------------------------------------------------------------------------------
			function applydiscountandtax(e){
				var rowid= e.getAttribute("name");
				
				Discountper =$("#Discountper"+ rowid).val();
				if(Discountper ==""){
					$("#Discountperip"+ rowid).val(0);
					$("#Discountpertxt"+ rowid).text("0%");
				}else{
					$("#Discountperip"+ rowid).val($("#Discountper"+ rowid).val());	
					$("#Discountpertxt"+ rowid).text($("#Discountper"+ rowid).val()+ "%");
				}
				$("#CGSTperip"+ rowid).val($("#CGSTper"+ rowid).val());
				$("#IGSTperip"+ rowid).val($("#IGSTper"+ rowid).val());
				$("#SGSTperip"+ rowid).val($("#SGSTper"+ rowid).val());
				
				
				$("#CGSTpertxt"+ rowid).text($("#CGSTper"+ rowid).val()+ "%");
				$("#IGSTpertxt"+ rowid).text($("#IGSTper"+ rowid).val()+ "%");
				$("#SGSTpertxt"+ rowid).text($("#SGSTper"+ rowid).val()+ "%");
				$('.more-options-dropdown').click();
				invoiceamountCalculator();
			}
			//------------------------------------------------------
			//------------------------------------------------------------------------------------
			function invoiceamountCalculator(){
				totalamtwithouttax =0.00;
				totalCGST =0.00;
				totalSGST =0.00;
				totalIGST =0.00;
				totalamount =0.00;
				totaldiscountamount =0.00;
				for( i =1; i<=invoiceIncre;i++)
				{
					 price = $("#Price"+i).val();
					 qty = $("#Quantity"+i).val();
					 taxableAmount =price *  qty ;
					 
					 CGSTper = $("#CGSTperip"+i).val();
					 IGSTper = $("#IGSTperip"+i).val();
					 SGSTper = $("#SGSTperip"+i).val();
					 Discountper = $("#Discountperip"+i).val();
					 
					 Discountamt =taxableAmount * (Discountper/100);
					 afetdiscountamount =  taxableAmount -Discountamt;
					$('#taxableamount'+i).text(afetdiscountamount.toFixed(2));
					
					IGSTamount =afetdiscountamount * (IGSTper/100);
					SGSTamount =afetdiscountamount * (SGSTper/100);
					CGSTamount=afetdiscountamount * (CGSTper/100);
					
					
					totalamtwithouttax = totalamtwithouttax+afetdiscountamount;
					totalCGST =totalCGST+CGSTamount;
					totalSGST = totalSGST+SGSTamount;
					totalIGST = totalIGST+IGSTamount;
					totaldiscountamount = totaldiscountamount+Discountamt;
					
				}
				//-------------------------------------------------
				if(totaldiscountamount.toFixed(2)>0)
				{
					$('.totaldiscountamountdiv').css("visibility","visible");
					$('#totaldiscountamount').text(totaldiscountamount.toFixed(2));
				}else
				{
					$('.totaldiscountamountdiv').css("visibility","hidden");
				}
				//-------------------------------------------------
				if(totalCGST.toFixed(2)>0)
				{
					$('.totalCGSTdiv').css("visibility","visible");
					$('#totalCGST').text(totalCGST.toFixed(2));
				}else
				{
					$('.totalCGSTdiv').css("visibility","hidden");
				}
				//-------------------------------------------------
				if(totalSGST.toFixed(2)>0)
				{
					$('.totalSGSTdiv').css("visibility","visible");
					$('#totalSGST').text(totalSGST.toFixed(2));
				}else
				{
					$('.totalSGSTdiv').css("visibility","hidden");
				}
				//-------------------------------------------------
				if(totalIGST.toFixed(2)>0)
				{
					$('.totalIGSTdiv').css("visibility","visible");
					$('#totalIGST').text(totalIGST.toFixed(2));
				}else
				{
					$('.totalIGSTdiv').css("visibility","hidden");
				}
				//-------------------------------------------------
				
			
				$('#totalamount').text((totalamtwithouttax+ totalCGST + totalSGST + totalIGST).toFixed(0));
				$("#totalamount_hid").val((totalamtwithouttax+ totalCGST + totalSGST + totalIGST).toFixed(0));
				$('#totalamtwithouttax').text((totalamtwithouttax+Discountamt).toFixed(0));
				
				
									
			}
			//------------------------------------------------------------------------------------
			function deleteinvoiceItem(id){
				
				 Swal.fire({
		             title: 'Are you sure?',
		             text: "You won't be able to revert this!",
		             icon: 'warning',
		             showCancelButton: true,
		             confirmButtonText: 'Yes, delete it!',
		             customClass: {
		               confirmButton: 'btn btn-primary me-3',
		               cancelButton: 'btn btn-label-secondary'
		             },
		             buttonsStyling: false
		           }).then(function (result) {
		             if (result.value) {
		            	 $(".incontact"+id).remove();
		            	 invoiceIncre=invoiceIncre-1;
		            	 invoiceamountCalculator();
				   			
		               }
		           });
				
			}
			
			//------------------------------------------------------------------------------------
			//------------------------------------------------------
			$('#invoiceType').on('change',function(event) {
				
				
				if($(this).val() == "Bill"){
					$(".CGST").val("0").change();
					$(".SGST").val("0").change();
					$(".IGST").val("0").change();
					$('.CGST').prop("disabled", true);
					$('.SGST').prop("disabled", true);
					$('.IGST').prop("disabled", true);
					
				}else
				{
					
					const elementsWithClassInv = document.querySelectorAll(".CGST");
					 const elementsArrayInv = Array.from(elementsWithClassInv);
					  elementsArrayInv.forEach((element) => {
					     let tempid = element.id.replace("CGSTper","");
					   
					     	if($("#CGSTper"+tempid).val() == 0 && $("#IGSTper"+tempid).val()== 0)
							{
					     		$("#CGSTper"+tempid).val("9").change();
					    	}
							if($("#SGSTper"+tempid).val() == 0 && $("#IGSTper"+tempid).val()== 0)
							{
								$("#SGSTper"+tempid).val("9").change();
							}
							if($("#SGSTper"+tempid).val() != 0 && $("#CGSTper"+tempid).val()!= 0)
							{
								$("#IGSTper"+tempid).val("0").change();
							}
					     
					  });
					$('.CGST').prop("disabled", false);
					$('.SGST').prop("disabled", false);
					$('.IGST').prop("disabled", false);
				}
				
				$(".btn-apply-changes").click();
				
			});
			//------------------------------------------------------
			var toastCount = 0;
			function showtoaster_rvs(title,msg,msgtype){
				    var shortCutFunction = msgtype,
				      isRtl = $('html').attr('dir') === 'rtl',
				      msg = msg,
				      title = title || '',
				      $showDuration = 300,
				      $hideDuration = 300,
				      $timeOut = 5000,
				      $extendedTimeOut =1000,
				      $showEasing = 'swing',
				      $hideEasing = 'linear',
				      $showMethod = 'fadeIn',
				      $hideMethod = 'fadeOut',
				      toastIndex = toastCount++,
				      addClear = true,
				      prePositionClass = 'toast-top-right';
				
				    prePositionClass =
				      typeof toastr.options.positionClass === 'undefined' ? 'toast-top-right' : toastr.options.positionClass;
				
				    toastr.options = {
				      maxOpened: 1,
				      autoDismiss: true,
				      closeButton: true,
				      debug: false,
				      newestOnTop:false,
				      progressBar:true,
				      positionClass: 'toast-top-right',
				      preventDuplicates:false,
				      onclick: null,
				      rtl: isRtl
				    };
				
				    
				
				  
				    if ($showDuration.length) {
				      toastr.options.showDuration = parseInt($showDuration);
				    }
				    if ($hideDuration.length) {
				      toastr.options.hideDuration = parseInt($hideDuration);
				    }
				    if ($timeOut.length) {
				      toastr.options.timeOut = addClear ? 0 : parseInt($timeOut);
				    }
				    if ($extendedTimeOut.length) {
				      toastr.options.extendedTimeOut = addClear ? 0 : parseInt($extendedTimeOut);
				    }
				    if ($showEasing.length) {
				      toastr.options.showEasing = $showEasing;
				    }
				    if ($hideEasing.length) {
				      toastr.options.hideEasing = $hideEasing;
				    }
				    if ($showMethod.length) {
				      toastr.options.showMethod = $showMethod;
				    }
				    if ($hideMethod.length) {
				      toastr.options.hideMethod = $hideMethod;
				    }
				    
				    var $toast = toastr[shortCutFunction](msg, title); // Wire up an event handler to a button in the toast, if it exists
				    $toastlast = $toast;
				    if (typeof $toast === 'undefined') {
				      return;
				    }
				    
				    if ($toast.find('.clear').length) {
				      $toast.delegate('.clear', 'click', function () {
				        toastr.clear($toast, {
				          force: true
				        });
				      });
				    }
				  }
			//------------------------------------------------------
			$("#address_search").on('click',function(event) {
				var ProjectName =$("#ProjectName").val();
				var addressIncre=0;
				html="";
				if(ProjectName !="")
				{
					$('.address_ls_div').html('<span class="spinner-border" role="status" aria-hidden="true"></span> Loading...');
					
					var formData = {
							projectid : ProjectName
						}

						$.ajax({
							type : "GET",
							url : "getprojectaddress",
							data : formData,
							success : function(result) {
								var bmobj = JSON.parse(JSON.stringify(result));
								bmobj.forEach((element, index, array) =>
					           	{
					           	 	addressIncre= addressIncre+1;
									html +='<div class="border p-3" id="section-block">'; 
									html +='<p id="addressline1'+addressIncre+'">  '+element.addressline1 +'</p>';
									html +='<p id="addressline2'+addressIncre+'">  '+element.addressline2 +'</p>';
									html +='<p id="district'+addressIncre+'">  '+element.district +'</p>';
									html +='<p id="state'+addressIncre+'">  '+element.state +'</p>';
									html +='<p id="pincode'+addressIncre+'">  '+element.pincode +'</p>';
									html +='<p id="gst'+addressIncre+'">  '+element.gst +'</p>';
									html +='<button type="button" onclick="movetocustomer('+addressIncre+')" class="btn btn-sm btn-primary"><< Customer</button>';
									html +='&nbsp;<button type="button" onclick="movetobilling('+addressIncre+')" class="btn btn-sm btn-primary"><< Billing</button></div>';
					           	});
					           	
								$('.address_ls_div').html(html);
								
							},
							error : function(e) {
								console.log("Error" + e);
							}
						});
					
					
				}				
			});
			//------------------------------------------------------
			function movetocustomer(id){
				$("#invoiceaddressline1").val($("#addressline1"+id).text());
				$("#invoiceaddressline2").val($("#addressline2"+id).text());
				$("#invoiceaddresscity").val($("#district"+id).text());
				$("#invoiceaddresspincode").val($("#pincode"+id).text());
				$("#invoiceaddressState").val($("#state"+id).text());
				$("#invoiceGSTNo").val($("#gst"+id).text());
				$('.offcanvas').offcanvas('hide');
			}
			function movetobilling(id){
				$("#billaddressline1").val($("#addressline1"+id).text());
				$("#billaddressline2").val($("#addressline2"+id).text());
				$("#billaddresscity").val($("#district"+id).text());
				$("#billaddresspincode").val($("#pincode"+id).text());
				$("#billaddressState").val($("#state"+id).text());
				$("#billGSTNo").val($("#gst"+id).text());
				$('.offcanvas').offcanvas('hide');
			}
    </script>
</body>
</html>