<!DOCTYPE html>

<html
  xmlns:th="http://www.thymeleaf.org" 
  lang="en"
  class="light-style layout-navbar-fixed layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  th:data-assets-path="@{/assets/}"
  data-template="vertical-menu-template"
  
>
  <head>
	<meta name="_csrf" th:content="${_csrf.token}" />
	<!-- default header name is X-CSRF-TOKEN -->
	<meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Asset List</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/img/favicon/favicon.ico}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet" type="text/css"
    />

    <!-- Icons -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/boxicons.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/fontawesome.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/flag-icons.css}" />

    <!-- Core CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/css/rtl/core.css}" class="template-customizer-core-css" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/css/rtl/theme-default.css}" class="template-customizer-theme-css" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/demo.css}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/sweetalert2/sweetalert2.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/pickr/pickr-themes.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/tagify/tagify.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/bootstrap-select/bootstrap-select.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/select2/select2.css}" />
     
    <!-- Row Group CSS -->
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.css}" />
    <!-- Form Validation -->
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/formvalidation/dist/css/formValidation.min.css}" />


    <!-- Page CSS -->

    <!-- Helpers -->
    <script th:src="@{/assets/vendor/js/helpers.js}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
    <script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script th:src="@{/assets/js/config.js}"></script>
<style>


</style>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
		  <div th:insert="menu"></div>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

       <div th:insert="header"></div>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
				 <div class="container-xxl flex-grow-1 container-p-y">
              <h4 class="py-3 breadcrumb-wrapper mb-4"><span class="text-muted fw-light">Asset/ </span>Audit</h4>


             
       <div class="row">
        <div class="col-12">
	                            <div class="card">
	                                <div class="card-content">
	                                    <div class="card-body">
	                                    <div th:if="${printstr}" class="form-group col-12">
												<button type="button" class="btn mb-1 btn-success btn-lg btn-block">Asset Audit details are saved successfully</button>
											
											</div>
											
											<div class="row">
												 <div class="col-lg-3 col-sm-12">
                                                       <div class="form-group">
                                                           <label class="form-label">Branch </label>
                                                         
                                                               
			                                                     <select class="select2 form-select" id="BranchID">
			                                                     	<option value="" >-</option>
			                                                        <th:block th:each="obj : ${branchls}">
			                                                        	<option th:value="${obj.id}" th:text="${obj.BRANCH_NAME}"></option>
																	</th:block>
			                                                    </select>
                                                
                                                              
                                                           
                                                       </div>
                                                   </div>
                                                   
                                                   <div class="col-lg-3 col-sm-12">
                                                       <div class="form-group">
                                                           <label class="form-label d-block my-1"> Type</label>
                                                           
                                                           <div class="form-check form-check-inline mt-3">
            <input class="form-check-input" type="radio" name="Status" id="radio1" value="InStock" checked="" required>
            <label class="form-check-label" for="radio1">InStock </label>
          </div>
           <div class="form-check form-check-inline mt-3">
           <input class="form-check-input" type="radio" name="Status" id="radio2" value="Custodian" required>
            <label class="form-check-label" for="radio2">Custodian </label>
            </div>
                                                           
                                                               
															 
                                                              
                                                           
                                                       </div>
                                                   </div>
                                                   <div class="col-lg-6 col-sm-12">
														<div class="form-group">
															<label >&nbsp;</label>
															 
																<button type="button" id="Search"
																	class="btn btn-primary mr-1 mt-4">Search</button>
	
															 
														</div>
													</div>
													
													<div class="col-12">
													<hr/>
												</div>
												
												 
												
												<div class="col-lg-4 col-sm-12 form-group mb-2 Custodiandiv">
												<label for="form-label">Custodian</label>
												<select class="select2 form-select" id="StaffID">
			                                                    
			                                         </select>
												</div>
												
												<div class="col-lg-4 col-sm-12 form-group mb-2">
												<label for="form-label">Asset</label>
												<select class="select2 form-select" id="AssetId">
			                                                    
			                                         </select>
												</div>
												
												<div class="col-lg-4 col-sm-12 form-group mb-2">
												<label for="form-label">Asset Audit Date</label>
												 <input type="text"  class="form-control flatpickr" id="AssetAuditDate" th:value="${today}" placeholder="Apr 3 2022"/>
												</div>
												
												
												<div class="col-lg-4 col-sm-12 form-group mb-2">
												<label for="form-label">Status</label>
												 <select class="form-select Statusv1" id="Status">
												  <option value="">-</option>
			                                                       
			                                                        <option value="Damaged">Damaged</option>
			                                                        <option value="Missing">Missing</option>
			                                                        <option value="Repair">Repair</option>			                                                        
			                                                  
			                                                        <option value="Scrap">Scrap</option>
																	
			                                  </select>
												</div>
												
												<div class="col-lg-4 col-sm-12 form-group mb-2">
												<label for="form-label">Condition</label>
												 <select class="form-select aConditionv2" id="aCondition">
												 <option value="">-</option>
			                                                        <option value="Fair">Fair</option>
																	<option value="Good">Good</option>
																	<option value="New">New</option>
																	<option value="Poor">Poor</option>
																	<option value="Damaged">Damaged</option>
																	
			                                  </select>
												</div>
												
												
												<div class="col-lg-4 col-sm-12 form-group mb-2">
												<label for="form-label">Comments</label>
												 <input type="text"  class="form-control" id="Comments" placeholder="eg. Comments">
												</div>
												
												
												
												 <div class="col-sm-12 text-center">
            <button type="button" id="save" class="btn btn-primary me-sm-3 my-2">Add </button>
            
          </div>
          <hr />
			<form th:action="@{/assetauditsave}" method="POST" class="wizard-horizontal "  enctype="multipart/form-data">
			 <div class="card-datatable table-responsive">
		 <table class="datatables-basic table table-bordered" style="overflow-x: scroll;">
		 <thead>
		 <tr>
		 	
	<th ></th>
	<th></th>
	
	<th>CUSTODIAN</th>
	<th>DATE</th>
	<th>ASSET</th>
	<th>Photo</th>
	<th>STATUS</th>
	<th>Condition</th>
	<th>COMMENTS</th>
	<th>Action</th>
 </tr>
 </thead>
		<tbody class="tblbody">
		
		</tbody>
		</table>
		</div>
		
		 <div class="col-sm-12 text-center">
            <label class="switch">
              <input type="checkbox" class="switch-input" name="receipt">
              <span class="switch-toggle-slider">
                <span class="switch-on">
                  <i class="bx bx-check"></i>
                </span>
                <span class="switch-off">
                  <i class="bx bx-x"></i>
                </span>
              </span>
              <span class="switch-label">SHOW RECEIPT AFTER ASSER AUDIT?</span>
            </label>
          </div>
          
          <div class="col-sm-12 text-center mt-4">
            <button type="submit" class="btn btn-primary me-sm-3 me-1">Asset Audit</button>
            
          </div>
          
	
			</form>									
                                                   
	                                     
	                                    
	                                    </div>
	                                    
	                                    </div>
	                                    </div>
	                                    </div>
       </div>
	
	        <!-- / Content -->

            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
             
            </footer>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>
    
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
    <script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
    <script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
    <script th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

    <script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>

    <script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
    <script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>

    <script th:src="@{/assets/vendor/js/menu.js}"></script>
    <!-- endbuild -->

     <!-- Vendors JS -->
     <script th:src="@{/assets/vendor/libs/select2/select2.js}"></script>
    <script th:src="@{/assets/vendor/libs/bootstrap-select/bootstrap-select.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-responsive/datatables.responsive.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons/datatables-buttons.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/jszip/jszip.js}"></script>
    <script th:src="@{/assets/vendor/libs/pdfmake/pdfmake.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons/buttons.html5.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-buttons/buttons.print.js}"></script>
    <!-- Flat Picker -->
    <script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
    <script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>
     <script th:src="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js}"></script>
    <script th:src="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js}"></script>
    <script th:src="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.js}"></script>
    <script th:src="@{/assets/vendor/libs/pickr/pickr.js}"></script>
    
    <!-- Row Group JS -->
    <script th:src="@{/assets/vendor/libs/datatables-rowgroup/datatables.rowgroup.js}"></script>
    <script th:src="@{/assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.js}"></script>
    <script th:src="@{/assets/vendor/libs/sweetalert2/sweetalert2.js}"></script>
    <script th:src="@{/assets/vendor/libs/tagify/tagify.js}"></script>
    <!-- Form Validation -->
    <script th:src="@{/assets/vendor/libs/formvalidation/dist/js/FormValidation.min.js}"></script>
    <script th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js}"></script>
    <script th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js}"></script>

    <!-- Main JS -->
    <script th:src="@{/assets/js/main.js}"></script>

    <!-- Page JS -->
    <!-- <script th:src="@{/assets/js/tables-datatables-basic.js}"></script> -->
    <script th:src="@{/assets/js/form-validation.js}"></script> 
    <script>
 
    	//--------------------------------------------------------------------------------------------------------------------------------------
    	let fv;
    	
    	//--------------------------------------------------------------------------------------------------------------------------------------
    	
    	$(document).on("click", ".create-new", function() {	
    		
    		$('.btnoffcanvas').click();
    	});
    	
    	//--------------------------------------------------------------------------------------------------------------------------------------		 		

		$(function() {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			$(document).ajaxSend(function(e, xhr, options) {
				xhr.setRequestHeader(header, token);
			});
		});
		//--------------------------------------------------------------------------------------------------------------------------------------		 
		
		 $(".flatpickr").each(function(index) {
	  $(this).flatpickr({
	    	altInput: true,
		    altFormat: 'F j, Y',
		    dateFormat: 'Y-m-d',
	    });
  });

		
		 const dt_basic_table = $(`.datatables-basic`).DataTable({
			  
			  columnDefs: [
				  {
			          className: 'control',
			          orderable: false,
			          targets: 0,
			          searchable: false,
			          render: function (data, type, full, meta) {
			            return '';
			          }
			        },
				        {
				          // For Checkboxes
				          targets: 1,
				          orderable: false,
				          responsivePriority: 3,
				          searchable: false,
				          checkboxes: true,
				          render: function() {
				            return '<input type="checkbox" class="dt-checkboxes form-check-input" name="checkbox">';
				          },
				          checkboxes: {
				            selectAllRender: '<input type="checkbox" class="form-check-input">'
				          }
				        },
				       {
				        	target:4,
				        	responsivePriority: 2,
				       },
			  ],
			  
			  
		      destroy: true,
		      dom: '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6 d-flex justify-content-center justify-content-md-end"f>>t<"row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',
		      responsive: {
		        details: {
		          display: $.fn.dataTable.Responsive.display.modal({
		            header: function (row) {
		              var data = row.data();
		              return 'Details of ' + data[''];
		            }
		          }),
		          type: 'column',
		          renderer: function (api, rowIdx, columns) {
		            var data = $.map(columns, function (col, i) {
		              return col.title !== '' // ? Do not show row in modal popup if title is blank (for check box)
		                ? '<tr data-dt-row="' +
		                    col.rowIndex +
		                    '" data-dt-column="' +
		                    col.columnIndex +
		                    '">' +
		                    '<td>' +
		                    col.title +
		                    ':' +
		                    '</td> ' +
		                    '<td>' +
		                    col.data +
		                    '</td>' +
		                    '</tr>'
		                : '';
		            }).join('');

		            return data ? $('<table class="table"/><tbody />').append(data) : false;
		          }
		        }
		      }
			});


			console.log(dt_basic_table.row);
			
			
			$("#Search").click(function(){
				var Statussr=$("input[name='Status']:checked").val();
				var branch = $("#BranchID").val();
				$('#StaffID').html("");
				$('#AssetId').html("");
				if(branch != "")
				{
					
					if(Statussr =='InStock')
					{
						$('.Custodiandiv').hide();
						$('#StaffID').html("");
						//--------------------------------------------------------
						// Asset Details
						 $('#AssetId').html("");
						var BranchIDid = $("#BranchID :Selected").val();
						var formData = {
								branchid : BranchIDid					
						}
						$.ajax({
							type : "POST",
							url : "getassetlistbasedonbranchallinstock",
							data : formData,
							success : function(result) {
								
								var curstr = result.split("~|~");
								var assetypeinstcokitem="<option value=''>-</option>";
								for(str in curstr)
								{
									tempsplit=curstr[str].split("|~|");
									if( tempsplit != '')
									{
										assetypeinstcokitem +="<option value='"+ tempsplit[0] +"'> "+  tempsplit[1] + "- "+  tempsplit[2] + "</option>";	
									}
								 	 
								} 
								$("#AssetId").append(assetypeinstcokitem);
								
							},
							error : function(e) {
								alert("Error" + e);
							}
						});	 
						//---------------------------------		
						
					}else
					{
						$('.Custodiandiv').show();
						//---------------------------------
						// BranchID Details
						var BranchIDname = $("#BranchID :Selected").text();
						$(".Custodianloding").css("visibility","visible");
						$('#StaffID').html("");
						var formData = {
								branchname : BranchIDname					
						}
						$.ajax({
							type : "POST",
							url : "getEmployeelistbasedonbranch",
							data : formData,
							success : function(result) {
								$('#StaffID').append(result);
								$(".Custodianloding").css("visibility","hidden");
								 $("#StaffID").change();
							},
							error : function(e) {
								alert("Error" + e);
								$(".Custodianloding").css("visibility","hidden");
							}
						});
						//---------------------------------
					}
					
							
				}
			});
			
			
			$(document).on("change", "#StaffID", function() {
				
				//--------------------------------------------------------
				// Asset Details
				 $('#AssetId').html("");
				var StaffID = $("#StaffID :Selected").val();
				var formData = {
						StaffID : StaffID					
				}
				$.ajax({
					type : "POST",url : "getassetlistbasedonbranchallstaff",
					data : formData,success : function(result) {
						
						var curstr = result.split("~|~");
						var assetypeinstcokitem="<option value=''>-</option>";
						for(str in curstr)
						{
							tempsplit=curstr[str].split("|~|");
							if( tempsplit != '')
							{
								assetypeinstcokitem +="<option value='"+ tempsplit[0] +"'> "+  tempsplit[1] + "- "+  tempsplit[2] + "</option>";	
							}
						 	 
						} 
						$("#AssetId").append(assetypeinstcokitem);
						
					},
					error : function(e) {
						alert("Error" + e);
					}
				});	 
				//---------------------------------	
			});
			//--------------------------------------------------------
			$(document).on("change", "#AssetId", function() {
				
				var assetname = $("#AssetId :Selected").text();
				tempsplit=assetname.split("-");
				var v1 =tempsplit[tempsplit.length-1].trim();
				var v2 =tempsplit[tempsplit.length-2].trim();
				
				$('#aCondition').val(v2);
				$('#Status').val(v1);
			});
			
			
			
			var sno=1;
			
			
			
			$("#save").click(function(){
				
				
				var StaffID= $('#StaffID').val();
				var StaffName= $('#StaffID  option:selected').text();
				var AssetAuditDate= $('#AssetAuditDate').val();
				var AssetId= $('#AssetId').val();
				var AssetName= $('#AssetId  option:selected').text();
				var Status= $('#Status').val();
				
				var aCondition=$('#aCondition').val();
				var Comments= $('#Comments').val();
				
				if( AssetAuditDate !="" && AssetId !="" && AssetName !="" && Status !="" )
				{
					tempstr="<input type='hidden' id='StaffID"+ sno +"' name='StaffID' value='"+ StaffID +"'  />";
					tempstr+="<input type='hidden' id='AssetAuditDate"+ sno +"'  name='AssetAuditDate' value='"+ AssetAuditDate +"'  />";
					tempstr+="<input type='hidden' id='AssetId"+ sno +"'  name='AssetId' value='"+ AssetId +"'  />";
					tempstr+="<input type='hidden' id='Status"+ sno +"'  name='Statusx' value='"+ Status +"'  />";
					tempstr+="<input type='hidden' id='aCondition"+ sno +"'  name='aCondition' value='"+ aCondition +"'  />";
					tempstr+="<input type='hidden' id='Comments"+ sno +"'  name='Comments' value='"+ Comments +"'  />";
					
					filestr="<input type='file' class='form-control fileimage' style='width:220px;'	name='Photo_Attach' accept='image/*' multiple/>";
					
					
					sno=dt_basic_table.rows().count()+1;
					
					dt_basic_table.row.add([
						'',
						'',
						StaffName,
						AssetAuditDate,
						AssetName,
						filestr,
						Status,
						aCondition,
						Comments,
						tempstr+`<span id='${sno}' class='cursor-pointer filedivdelete'>  <i class='bx bx-trash-alt'></i>   </span>`,
					]).draw();
				}else
				{
					alert("Please fill all mandatory fields");	
				}
			});
		
			
			$(document).on("click", ".filedivdelete", function() {
				id= $(this).attr("id");
				var AssetId=$('#AssetId'+id).val();
				var AssetName= $("#AssetName"+id).text();
				$('#AssetId').append("<option value='"+ AssetId +"'>"+ AssetName +"</option>");
				$(this).closest("tr").remove();
				
			});
		
		
    	
    </script>
  </body>
</html>