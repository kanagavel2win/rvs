<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="en"
	class="light-style layout-navbar-fixed layout-menu-fixed" dir="ltr"
	data-theme="theme-default" th:data-assets-path="@{/assets/}"
	data-template="vertical-menu-template">
<head>
<meta name="_csrf" th:content="${_csrf.token}" />
<!-- default header name is X-CSRF-TOKEN -->
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

<title th:text="${employeemaster.StaffName} + ' Advance'"></title>

<meta name="description" content="" />

<!-- Favicon -->
<link rel="icon" type="image/x-icon"
	th:href="@{/assets/img/favicon/favicon.ico}" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
	rel="stylesheet" />

<!-- Icons -->
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/boxicons.css}" />
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/fontawesome.css}" />
<link rel="stylesheet" th:href="@{/assets/vendor/fonts/flag-icons.css}" />

<!-- Core CSS -->
<link rel="stylesheet" th:href="@{/assets/vendor/css/rtl/core.css}"
	class="template-customizer-core-css" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/css/rtl/theme-default.css}"
	class="template-customizer-theme-css" />
<link rel="stylesheet" th:href="@{/assets/css/demo.css}" />

<!-- Vendors CSS -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/animate-css/animate.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/sweetalert2/sweetalert2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/select2/select2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/tagify/tagify.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/formvalidation/dist/css/formValidation.min.css}" />

<!-- Page CSS -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/css/pages/page-profile.css}" />
<!-- Helpers -->
<script th:src="@{/assets/vendor/js/helpers.js}"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
<script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script th:src="@{/assets/js/config.js}"></script>
<style>
.bxs-check-circle {
	color: green;
}

.bxs-trash-alt, .bxs-pencil {
	cursor: pointer;
	padding-left: 10px;
}

.empnewcredential {
	float: right;
}

.editempadvanceinfo{
	cursor: pointer;

}
</style>

<script type="text/javascript">

var tblemployeeadvanceid=0;
</script>
</head>


<body>
	<!-- Layout wrapper -->
	<div class="layout-wrapper layout-content-navbar">
		<div class="layout-container">
			<!-- Menu -->
			<div th:insert="menu"></div>
			<!-- / Menu -->

			<!-- Layout container -->
			<div class="layout-page">
				<!-- Navbar -->

				<div th:insert="header"></div>

				<!-- / Navbar -->

				<!-- Content wrapper -->
				<div class="content-wrapper">
					<!-- Content -->

					<div class="container-xxl flex-grow-1 container-p-y">
						<h4 class="py-3 breadcrumb-wrapper mb-4">
							<span class="text-muted fw-light">User Profile /</span> Profile
						</h4>

						<!-- Header -->
						<div class="row">
							<div class="col-12">
								<div class="card mb-4">
									<div class="user-profile-header-banner">
										<img th:src="@{/assets/img/pages/profile-banner.png}"
											alt="Banner image" class="rounded-top" />
									</div>
									<div
										class="user-profile-header d-flex flex-column flex-sm-row text-sm-start text-center mb-4">
										<div class="flex-shrink-0 mt-n2 mx-sm-0 mx-auto">
											<img th:src="${employeemaster.t_emp_img}" alt="user image"
												class="d-block h-auto ms-0 ms-sm-4 rounded-3 user-profile-img" />
										</div>
										<div class="flex-grow-1 mt-3 mt-sm-5">
											<div
												class="d-flex align-items-md-end align-items-sm-start align-items-center justify-content-md-between justify-content-start mx-4 flex-md-row flex-column gap-4">
												<div class="user-profile-info">
													<h4 th:text="${employeemaster.StaffName}"></h4>
													<ul
														class="list-inline mb-0 d-flex align-items-center flex-wrap justify-content-sm-start justify-content-center gap-2">
														<li class="list-inline-item fw-semibold"><i
															class="bx bx-pen"></i> <th:block
																th:text="${employeemaster.t_position}"></th:block></li>
														<li class="list-inline-item fw-semibold"><i
															class="bx bx-map"></i> <th:block
																th:text="${employeemaster.t_branch_name}"></th:block></li>
														<li class="list-inline-item fw-semibold"><i
															class="bx bx-calendar-alt"></i> <th:block
																th:text="'Experience  '+ ${employeemaster.t_joindatetimeline}"></th:block>
														</li>
														
													</ul>
												</div>
												<!--  <a href="javascript:void(0)" class="btn btn-primary text-nowrap">
                            <i class="bx bx-user-check"></i> Connected
                          </a> -->
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<!--/ Header -->

						<!-- Navbar pills -->
						<div class="row">
							<div class="col-md-12">
								<ul class="nav nav-pills flex-column flex-sm-row mb-4">
									<li class="nav-item"><a class="nav-link"
										th:href="'emp?id=' + ${employeemaster['empMasterid']}"><i
											class="bx bx-user"></i> Profile</a></li>
									<li class="nav-item"><a class="nav-link"><i
											class="bx bx-group"></i> Job Title</a></li>
									<li class="nav-item"><a class="nav-link"
										href="underMaintenance"><i class="bx bx-grid-alt"></i>
											Projects</a></li>
									<li class="nav-item"><a class="nav-link"
															th:href="'empbenefits?id=' + ${employeemaster['empMasterid']}"><i
																class="bx bx-grid-alt"></i> Benefits</a></li>
									<li class="nav-item"><a class="nav-link active"><i class='bx bx-money-withdraw'></i>  Advance</a></li>
								</ul>
							</div>
						</div>
						<!--/ Navbar pills -->
						<!-- User Profile Content -->
						<div class="row">
							<div class="col-xl-12 col-lg-12 col-md-12">
								<div class="card mb-4">
									<div class="card-header align-items-center">
										<h6 class="card-action-title mb-0">
											Salary Advance details
											<div class="card-action-element" style="float: right">
												<button
													class="btn btn-primary btn-sm newempadvancestatus"
													type="button" name="-" data-bs-toggle="modal"
													data-bs-target="#advanceScrollable">
													<i class="bx bx-plus bx-xs me-1"></i>
												</button>
											</div>
										</h6>

									</div>
									<div class="card-body">
										<div class="table-responsive mt-2">
											<table class="table table-hover table-bordered mb-0"
												id="tbl_advance_information">
												<thead>
													<tr>
														<th>Date</th>
														<th>Amount</th>
														<th>Purpose</th>
														<th>Paid Through</th>
														<th>Repay Months</th>
														<th colspan="2">Comments</th>
													</tr>
												</thead>
												<tbody id="advancelist">
												  
												</tbody>
											</table>
										</div>
									</div>
								</div>
								<!--/ About User -->
							
							</div>
						</div>
						<!--/ User Profile Content -->

						<!-- Modal -->
					
						<!-- Edit COMPENSATION Modal -->
						<div class="modal fade" id="advanceScrollable" tabindex="-1"
							aria-hidden="true">
							<div
								class="modal-dialog modal-dialog-centered1 modal-simple modal-add-new-cc">
								<div class="modal-content p-3 p-md-5">

									<div class="modal-body">
										<button type="button" class="btn-close"
											data-bs-dismiss="modal" aria-label="Close"></button>
										<div class="text-center mb-4">
											<h5>Advance Information</h5>
										</div>
										<form id="AdvanceInformation" onsubmit="return false">
											<div class="col-12">
												<label class="form-label" for="advancedate">Advance
													Date </label> <input type="hidden" class="form-control"
													id="employeeadvanceid" name="employeeadvanceid" />  <input
													type="date" class="form-control" id="advancedate" name="advancedate" required />
											</div>
											<div class="col-12">
												<label class="form-label" for="purpose">Purpose </label>
													 <input
													type="text" class="form-control"
													 id="purpose" name="purpose"  required/> 
											</div>
											<div class="col-12 ">
												<label for="amount">Pay Amount </label> 
												<input
													type="number" step="any" class="form-control"
													 id="amount" name="amount" required />
											</div>
											<div class="col-12">
												<label for="compayratetype">Pay from</label><br />  
													<select
													class="form-select"
													style="width: 50%; float: left" id="paidfrom" name="paidfrom" required>
													<option>-</option>
													<th:block th:each="obj1 : ${accountlist}">
															<option th:value="${obj1.accountheadid}"
															th:text="${obj1.category}"></option>
													</th:block>
												</select>
												
													<select
													class="form-select"
													style="width: 50%; float: right" id="modeofpayment" name="modeofpayment" required>
													<option>-</option>
													<th:block th:each="str :${ModeofPayment}">
														<option th:value="${str}" th:text="${str}"></option>
													</th:block>
												</select>
											</div>
											<div class="col-12 ">
												<label for="amount">Repayment months </label> 
												<input
													type="number" step="any" class="form-control"
													 id="repaymentmonths" name="repaymentmonths" />
											</div>
											<div class="col-12">
												<label for="repaymentcomments">Repayment Comments </label> 
												<input
													type="text" class="form-control"
													 id="repaymentcomments"  name="repaymentcomments"/>
											</div>
											<div class="col-12 text-center mt-4">
												<button type="submit" class="btn btn-primary  me-sm-3 me-1 editAdvancesubmit"
													>Submit</button>
												<button type="reset"
													class="btn btn-label-secondary tbl_jobadvance_close"
													data-bs-dismiss="modal" aria-label="Close">Cancel</button>
											</div>
										</form>
									</div>
								</div>
							</div>
						</div>
						<!--/ Edit COMPENSATION Modal -->

					</div>
					<!-- / Content -->

					<!-- Footer -->
					<!-- / Footer -->

					<div class="content-backdrop fade"></div>
				</div>
				<!-- Content wrapper -->
			</div>
			<!-- / Layout page -->
		</div>

		<!-- Overlay -->
		<div class="layout-overlay layout-menu-toggle"></div>

		<!-- Drag Target Area To SlideIn Menu On Small Screens -->
		<div class="drag-target"></div>
	</div>
	<!-- / Layout wrapper -->

	<!-- Core JS -->
	<script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
	<script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
	<script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

	<script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>

	<script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
	<script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>

	<script th:src="@{/assets/vendor/js/menu.js}"></script>
	<!-- endbuild -->

	<!-- Vendors JS -->
	<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
	<script th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-responsive/datatables.responsive.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons/datatables-buttons.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.js}"></script>
	<script th:src="@{/assets/vendor/libs/jszip/jszip.js}"></script>
	<script th:src="@{/assets/vendor/libs/pdfmake/pdfmake.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons/buttons.html5.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/datatables-buttons/buttons.print.js}"></script>
	<script th:src="@{/assets/vendor/libs/sweetalert2/sweetalert2.js}"></script>
	<script th:src="@{/assets/vendor/libs/cleavejs/cleave.js}"></script>
	<script th:src="@{/assets/vendor/libs/cleavejs/cleave-phone.js}"></script>
	<script th:src="@{/assets/vendor/libs/select2/select2.js}"></script>
	<script th:src="@{/assets/vendor/libs/toastr/toastr.js}"></script>
	<!-- Form Validation -->
	<script
		th:src="@{/assets/vendor/libs/formvalidation/dist/js/FormValidation.min.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js}"></script>

	<!-- Main JS -->
	<script th:src="@{/assets/js/main.js}"></script>

	<!-- Flat Picker -->
	<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
	<script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js}"></script>
	<script
		th:src="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.js}"></script>
	<script th:src="@{/assets/vendor/libs/pickr/pickr.js}"></script>
	<script th:src="@{/assets/vendor/libs/tagify/tagify.js}"></script>
	<script th:src="@{/assets/js/forms-selects.js}"></script>

	<!-- Page JS -->
	<!-- <script th:src="@{/assets/js/modal-edit-user.js}"></script> -->
	<script th:src="@{/assets/js/app-user-view.js}"></script>
	<script th:src="@{/assets/js/app-user-view-account.js}"></script>



	<script>
	
	 
	const flatpickrFriendlycomeffectivedate = flatpickr("#advancedate", {
		  altInput: true,
	      altFormat: 'F j, Y',
	      dateFormat: 'Y-m-d'
	     });
	

		 
	$(document)
			.ready(
					function() {
						
						var allowedbranchids="[[${allowedbranchids}]]";
						
						$("#tagallowedBranches").val(allowedbranchids.split(",")).change();
						
						var empid = $('#empid').val();


						//--------------------------------------------------------------------------------------------------------------------------------------		 		

						$(function() {
							var token = $("meta[name='_csrf']").attr("content");
							var header = $("meta[name='_csrf_header']").attr(
									"content");
							$(document).ajaxSend(function(e, xhr, options) {
								xhr.setRequestHeader(header, token);
							});
						});
						
						//--------------------------------------------------------------------------------------------------------------------------------------		 
						// ----------------------------------------------------------------------------------------------------------------------------------------
								function getadvancelist() {
									
									var formData = {
										mastercategoryid : "[[${employeemaster['empMasterid']}]]"
									}
	
									$.ajax({
										type : "POST",
										url : "getemployeeadvancelist",
										data : formData,
										success : function(result) {
											var htmlop="";
											var bmobj = JSON.parse(JSON.stringify(result));
											var total=0;
											console.log(bmobj);
											
											bmobj.forEach((element, index, array) =>
								           	{
								           		var sub_total=0;
								           	     htmlop +="<tr><td class='text-nowrap editempadvanceinfo' onclick='editempadvanceinfo(this)' id='"+element.employeeadvanceid +"'>"+element.advancedate_DDMMMYYYY+"</td>";
									           	 htmlop +="<td class='text-nowrap'>"+element.amount +"</td><td class='text-nowrap'>"+element.purpose +"</td><td class='text-nowrap'>"+element.modeofpayment +"</td><td>"+element.repaymentmonths +"</td>";
									           	 htmlop +="<td>"+element.repaymentcomments +"</td></tr>";
									           	 total +=parseFloat(element.amount);
								            });
											
											 htmlop += "<tr> <td colspan='4' class='align-top px-4 py-3'> </td> <td class='text-end px-4 py-3'> <p class='mb-0'>Total:</p> </td>  <td class='px-4 py-3'> <p class='fw-semibold mb-0'>Rs. "+ total.toFixed(2) +"</p> </td> </tr>";
												
											$('#advancelist').html(htmlop);
										},
										error : function(e) {
											console.log("Error" + e);
	
										}
	
									});
	
								}
						// ----------------------------------------------------------------------------------------------------------------------------------------
						//--------------------------------------------------------------------------------------------------------------------------------------		 		
						
						//-------------------------------------------
								$(document).ready(function(){
								    setTimeout(function(){
								    	getadvancelist();
								     },20); // milliseconds
								});
								
								//--------------------------------------------
								function validationreceiptformreset()
								   {
									$('.tbl_jobadvance_close').click();
					   				$('.editAdvancesubmit').prop("disabled",false);
						   			$('.editAdvancesubmit').html("Save");
								   			
								   }
								//--------------------------------------------------------------------------------------------------------------------------------------
								$('#AdvanceInformation').on('submit',function(event) {
									if (event.target.checkValidity()) {
										$('.editAdvancesubmit').prop("disabled",true);
										$('.editAdvancesubmit').html('<span class="spinner-border" role="status" aria-hidden="true"></span> Loading...');
										const formData = new FormData(document.querySelector("#AdvanceInformation"));
										formData.append("empid","[[${employeemaster['empMasterid']}]]");
										
										$.ajax({
											type : "POST",
											url : "employeeadvancesave",
											processData : false,
											contentType : false,
											data : formData,
											success : function(
													result) {
												
												validationreceiptformreset();
												
												getadvancelist();

											},
											error : function(e) {
												console.log("Error"+ e);
											}
										});
									} else {
										$('.editAdvancesubmit').prop("disabled",false);
									}
								});
								// --------------------------------------------------------------------
															
					});
	
	//------------------------------------------------------------------------------------
	
	 function editempadvanceinfo(e){
			var advanceid= e.getAttribute("id");
			
				var formData = {
					advanceid : advanceid,
					mastercategoryid:  "[[${employeemaster['empMasterid']}]]"
				}

				$.ajax({
					type : "POST",
					url : "getadvanceitem",
					data : formData,
					success : function(result) {
						var bmobj = JSON.parse(JSON.stringify(result));
						console.log(bmobj);
						
						$("#employeeadvanceid").val(bmobj.employeeadvanceid);
						//$("#advancedate").val(bmobj.advancedate);
						$("#purpose").val(bmobj.purpose);
						$("#amount").val(bmobj.amount);
						$("#paidfrom").val(bmobj.paidfrom).change();
						$("#modeofpayment").val(bmobj.modeofpayment).change();
						$("#repaymentmonths").val(bmobj.repaymentmonths);
						$("#repaymentcomments").val(bmobj.repaymentcomments);
						flatpickrFriendlycomeffectivedate.setDate(bmobj.advancedate);
					},
					error : function(e) {
						console.log("Error" + e);
					}
					
				});
				$("#advanceScrollable").modal('toggle');
			
		}
		//------------------------------------------------------
		


</script>
</body>
</html>