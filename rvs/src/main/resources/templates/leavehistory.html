<!DOCTYPE html>

<html
  xmlns:th="http://www.thymeleaf.org" 
  lang="en"
  class="light-style layout-navbar-fixed layout-menu-fixed"
  dir="ltr"
  data-theme="theme-default"
  th:data-assets-path="@{/assets/}"
  data-template="vertical-menu-template"
  
>
  <head>
	<meta name="_csrf" th:content="${_csrf.token}" />
	<!-- default header name is X-CSRF-TOKEN -->
	<meta name="_csrf_header" th:content="${_csrf.headerName}" />

    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />

    <title>Leave Approval</title>

    <meta name="description" content="" />

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" th:href="@{/assets/img/favicon/favicon.ico}" />

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet" type="text/css"
    />

    <!-- Icons -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/boxicons.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/fontawesome.css}" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/fonts/flag-icons.css}" />

    <!-- Core CSS -->
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/css/rtl/core.css}" class="template-customizer-core-css" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/vendor/css/rtl/theme-default.css}" class="template-customizer-theme-css" />
    <link rel="stylesheet" type="text/css" th:href="@{/assets/css/demo.css}" />

    <!-- Vendors CSS -->
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}">
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}">
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-select-bs5/select.bootstrap5.css}">
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css}">
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-fixedcolumns-bs5/fixedcolumns.bootstrap5.css}">
    <link rel="stylesheet" th:href="@{/assets/vendor/libs/datatables-fixedheader-bs5/fixedheader.bootstrap5.css}">
	
	 <link rel="stylesheet" th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}">
    <!-- Page CSS -->

    <!-- Helpers -->
    <script th:src="@{/assets/vendor/js/helpers.js}"></script>

    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
    <script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script th:src="@{/assets/js/config.js}"></script>
    <style>
    
    
    </style>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->
		<div th:insert="menu"></div>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

       <div th:insert="header"></div>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            <!-- Content -->
				 <div class="container-xxl flex-grow-1 container-p-y">
              <h4 class="py-3 breadcrumb-wrapper mb-4"><span class="text-muted fw-light">Administration/HR Management/Attendance/ </span>Leave History</h4>

 
<!-- Advanced Search -->
<div class="card">
  <h5 class="card-header">Leave History Report</h5>
  <!--Search Form -->
  <div class="card-body">
    <form class="dt_adv_search" method="POST">
      <div class="row">
        <div class="col-12">
          <div class="row g-3">
           
            <div class="col-12 col-sm-12 col-lg-6">
              <label class="form-label">Date:</label>
              <div class="mb-0">
                <input type="text" class="form-control dt-date flatpickr-range dt-input" data-column="3" placeholder="StartDate to EndDate" data-column-index="4" name="dt_date" />
                <input type="hidden" class="form-control dt-date start_date dt-input" data-column="2" data-column-index="4" name="value_from_start_date" />
                <input type="hidden" class="form-control dt-date end_date dt-input" name="value_from_end_date" data-column="3" data-column-index="4" />
              </div>
            </div>
           
          </div>
        </div>
      </div>
    </form>
  </div>
  <hr class="mt-0">
  <div class="card-datatable table-responsive">
    <table class="dt-advanced-search table table-bordered">
      <thead>
       <tr>
                                                    	<th>S.No</th>
                                                    	<th>Name</th>
                                                    	<th>FromDate</th>
                                                    	<th>To Date</th>
                                                    	<th>Leave Type</th>
                                                    	<th>Status</th>
                                                    	<th>Note</th>
                                                    	<th>P Starttime</th>
                                                    	<th>P Endtime</th>
                                                    	<th>Approver Name</th>
                                                    	<th>Approver Comments</th>
                                                    	
                                                    </tr>
      </thead>
   <tbody>
   </tbody>
    </table>
  </div>
</div>
<!--/ Advanced Search -->

             
             

            <!-- Footer -->
            <footer class="content-footer footer bg-footer-theme">
              >
            </footer>
            <!-- / Footer -->

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>

      <!-- Drag Target Area To SlideIn Menu On Small Screens -->
      <div class="drag-target"></div>
    </div>
    <!-- / Layout wrapper -->

    <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
  <script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
  <script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
  <script th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>
  
  <script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>
  

  <script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
  <script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>
  
  <script th:src="@{/assets/vendor/js/menu.js}"></script>
  <!-- endbuild -->
<script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>

<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
  <!-- Vendors JS -->
  <script th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
  <script th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
  <script th:src="@{/assets/vendor/libs/datatables-fixedcolumns/datatables.fixedcolumns.js}"></script>

  <!-- Main JS -->
  <script th:src="@{/assets/js/main.js}"></script>
  
  <!-- Page JS-->
  <script th:src="@{/assets/js/tables-datatables-advanced.js}"></script> 
 

  
    
    <script>
    
 
    const today = moment();
    const startOfMonth = today.startOf('month').format('YYYY-MM-DD');
    const endOfMonth = today.endOf('month').format('YYYY-MM-DD');
    
    var dt_adv_filter_table  = $('.dt-advanced-search');
    var startDateEle = $('.start_date'),endDateEle = $('.end_date');
      
    dt_adv_filter_table.DataTable({
          dom: "<'row'<'col-sm-12'tr>><'row'<'col-sm-12 col-md-6'i><'col-sm-12 col-md-6 dataTables_pager'p>>",
          ajax: {
	             "url": `leavehistoryjson?startdate=${startOfMonth}&enddate=${endOfMonth}`,
	             "type": "GET",
	             "dataSrc": "",
	         },
          
	         columnDefs: [
	        	 {
	        		 targets: 0,
	        		 data:"id",
	        		 
	        	 },  
	        	 
	        	 {
	        		 targets: 1,
	        		 data:"empname",
	        		 
	        	 }, 
	        	 
	        	 {
	        		 targets: 2,
	        		 render: function(data, type, full, meta) {
	        			 var fromadate = full.fromadate;
	        			var txt = '';
	        			 if(full.halfday)
	        				 {
	        				  txt+=`<br><span class="badge rounded-pill bg-label-danger">halfday</span>`;
	        				 }
	        			 else
	        				{
	        				 txt+='';
	        				}
	        			 return  `<span>${moment(fromadate).format('MM/DD/YYYY')}${txt}</span>`;
	        		 },
	        		 
	        		 
	        	 },
	        	 
	        	 {
	        		 targets: 3,
	        		 render: function(data, type, full, meta) {
	        			 var todate = full.todate;
	        			 return moment(todate).format('MM/DD/YYYY');
	        		 },
	        		 
	        	 },
	        	 
	        	 {
	        		 targets: 4,
	        		 data:"leavetype",
	        		 
	        	 },
	        	 {
	        		 targets: 5,
	        		  render: function(data, type, full, meta) {
	        			  var st = full.status;
	        			  var status = [];
	        			     status['Approved'] = ' bg-label-success';
				             status['Rejected'] = ' bg-label-danger';
				             status['Pending'] = ' bg-label-warning';
				            console.log(full);
				            console.log(st);
				            if (typeof status[st] === 'undefined') {
				              return data;
				            }
				            return (
				              '<span class="badge rounded-pill ' +
				              status[st]+
				              '">' +
				             st+
				              '</span>'
				            );
				          },
	        		 
	        	 },
	        	 {
	        		 targets: 6,
	        		 data:"notes",
	        		 
	        	 },
	        	 
	        	 {
	        		 targets: 7,
	        		 data:"permissionstarttime",
	        		 
	        	 },
	        	 {
	        		 targets: 8,
	        		 data:"permissionendtime",
	        		 
	        	 },
	        	 {
	        		 targets: 9,
	        		 data:"approvername",
	        		 
	        	 },
	        	 {
	        		 targets: 10,
	        		 data:"approvercomments",
	        		 
	        	 },
	        	
	        	 
	        	 
			  ],
			  orderCellsTop: true,
		      responsive: {
		        details: {
		        
		          type: 'column',
		          renderer: function (api, rowIdx, columns) {
		            var data = $.map(columns, function (col, i) {
		              return col.title !== '' // ? Do not show row in modal popup if title is blank (for check box)
		                ? '<tr data-dt-row="' +
		                    col.rowIndex +
		                    '" data-dt-column="' +
		                    col.columnIndex +
		                    '">' +
		                    '<td>' +
		                    col.title +
		                    ':' +
		                    '</td> ' +
		                    '<td>' +
		                    col.data +
		                    '</td>' +
		                    '</tr>'
		                : '';
		            }).join('');

		            return data ? $('<table class="table"/><tbody />').append(data) : false;
		          }
		        }
		      },
         
      })
      
 
    var rangePickr = $('.flatpickr-range'),
    dateFormat = 'MM/DD/YYYY';

  if (rangePickr.length) {
    rangePickr.flatpickr({
      mode: 'range',
      dateFormat: 'm/d/Y',
      orientation: isRtl ? 'auto right' : 'auto left',
      locale: {
        format: dateFormat
      },
      onClose: function (selectedDates, dateStr, instance) {
        var startDate = '',
          endDate = new Date();
        if (selectedDates[0] != undefined) {
          startDate = moment(selectedDates[0]).format('MM/DD/YYYY');
          startDateEle.val(startDate);
        }
        if (selectedDates[1] != undefined) {
          endDate = moment(selectedDates[1]).format('MM/DD/YYYY');
          endDateEle.val(endDate);
        }
        $(rangePickr).trigger('change').trigger('keyup');
      }
    });
  }

  // Filter column wise function
  function filterColumn(i, val) {
    if (i == 3) {
      var startDate = startDateEle.val(),
        endDate = endDateEle.val();
      if (startDate !== '' && endDate !== '') {
        $.fn.dataTableExt.afnFiltering.length = 0; // Reset datatable filter
        dt_adv_filter_table.dataTable().fnDraw(); // Draw table after filter
        filterByDate(i, startDate, endDate); // We call our filter function
        console.log(i, startDate, endDate);
      }
      dt_adv_filter_table.dataTable().fnDraw();
    } else {
      dt_adv_filter_table.DataTable().column(i).search(val, false, true).draw();
    }
  }
 
  
  var filterByDate = function (column, startDate, endDate) {
	    // Custom filter syntax requires pushing the new filter to the global filter array
	    $.fn.dataTableExt.afnFiltering.push(function (oSettings, aData, iDataIndex) {
	      var rowDate = normalizeDate(aData[column]),
	        start = normalizeDate(startDate),
	        end = normalizeDate(endDate);

	      // If our date from the row is between the start and end
	      if (start <= rowDate && rowDate <= end) {
	        return true;
	      } else if (rowDate >= start && end === '' && start !== '') {
	        return true;
	      } else if (rowDate <= end && start === '' && end !== '') {
	        return true;
	      } else {
	        return false;
	      }
	    });
	  };
	  
	  var normalizeDate = function (dateString) {
		    var date = new Date(dateString);
		    var normalized =
		      date.getFullYear() + '' + ('0' + (date.getMonth() + 1)).slice(-2) + '' + ('0' + date.getDate()).slice(-2);
		    return normalized;
		  };
	  
      $('input.dt-input').on('keyup', function () {
          filterColumn($(this).attr('data-column'), $(this).val());
        });
      
    </script>
  </body>
</html>