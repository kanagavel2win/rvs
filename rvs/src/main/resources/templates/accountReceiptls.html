<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="en"
	class="light-style layout-navbar-fixed layout-menu-fixed" dir="ltr"
	data-theme="theme-default" th:data-assets-path="@{/assets/}"
	data-template="vertical-menu-template">
<head>
<meta name="_csrf" th:content="${_csrf.token}" />
<!-- default header name is X-CSRF-TOKEN -->
<meta name="_csrf_header" th:content="${_csrf.headerName}" />

<meta charset="utf-8" />
<meta name="viewport"
	content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

<title>Receipt List</title>

<meta name="description" content="" />

<!-- Favicon -->
<link rel="icon" type="image/x-icon"
	th:href="@{/assets/img/favicon/favicon.ico}" />

<!-- Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
	href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Rubik:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap"
	rel="stylesheet" type="text/css" />

<!-- Icons -->
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/fonts/boxicons.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/fonts/fontawesome.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/fonts/flag-icons.css}" />

<!-- Core CSS -->
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/css/rtl/core.css}"
	class="template-customizer-core-css" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/css/rtl/theme-default.css}"
	class="template-customizer-theme-css" />
<link rel="stylesheet" type="text/css" th:href="@{/assets/css/demo.css}" />

<!-- Vendors CSS -->
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css}" />
<link rel="stylesheet" type="text/css"
	th:href="@{/assets/vendor/libs/typeahead-js/typeahead.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-bs5/datatables.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/sweetalert2/sweetalert2.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/flatpickr/flatpickr.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/pickr/pickr-themes.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/tagify/tagify.css}" />
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/select2/select2.css}" />

<!-- Row Group CSS -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.css}" />
<!-- Form Validation -->
<link rel="stylesheet"
	th:href="@{/assets/vendor/libs/formvalidation/dist/css/formValidation.min.css}" />


<!-- Page CSS -->

<!-- Helpers -->
<script th:src="@{/assets/vendor/js/helpers.js}"></script>

<!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
<!--? Template customizer: To hide customizer set displayCustomizer value false in config.js.  -->
<script th:src="@{/assets/vendor/js/template-customizer.js}"></script>
<!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
<script th:src="@{/assets/js/config.js}"></script>
<style>
#branchName, #branchemail, #branch_startdate {
	border-right: solid 1px #d4d8dd;
}

.tooltipx .tooltiptextx {
	visibility: hidden;
	font-size: 12px;
	min-width: 120px;
	background-color: black;
	color: #fff;
	text-align: center;
	border-radius: 6px;
	padding: 5px 0;
	/* Position the tooltip */
	position: absolute;
	z-index: 1;
}

.tooltipx:hover .tooltiptextx {
	visibility: visible;
}

.innertablefollowers td {
	border: none;
	padding-left: 0.1rem;
	padding-right: 0.1rem;
	margin: none;
}

.tooltipx {
	position: relative;
	display: inline-block;
}

.tooltipx .tooltiptextx {
	visibility: hidden;
	font-size: 12px;
	min-width: 120px;
	background-color: black;
	color: #fff;
	text-align: center;
	border-radius: 6px;
	padding: 5px 0;
	/* Position the tooltip */
	position: absolute;
	z-index: 1;
}

.tooltipx:hover .tooltiptextx {
	visibility: visible;
}

td {
	line-height: 20px;
}

.accordion-item
{

	border: 1px solid #ccc;
	padding-left: 10px;
}

.generatenewreceipt {
	cursor: pointer;
}
</style>
</head>

<body>
	<!-- Layout wrapper -->
	<div class="layout-wrapper layout-content-navbar">
				<div class="layout-container">
			<!-- Menu -->
			<div th:insert="menu"></div>
			<!-- / Menu -->

			<!-- Layout container -->
			<div class="layout-page">
				<!-- Navbar -->

				<div th:insert="header"></div>

				<!-- / Navbar -->

				<!-- Content wrapper -->
				<div class="content-wrapper">
					<!-- Content -->
					<div class="container-xxl flex-grow-1 container-p-y">
						<h4 class="py-3 breadcrumb-wrapper mb-4">
							<span class="text-muted fw-light">Accounts / </span>Project Invoice Receipt
						</h4>



						<!-- DataTable with Buttons -->
						<div class="card">
							
							<div class="card-datatable table-responsive pt-0">
								<table class="datatables-basic table table-bordered">
									<thead>
										<tr>
											<th></th>
											<th></th>
											<th>id</th>
											<th>Title</th>
											<th>Bill Type</th>
											<th>Status</th>
											<th>Branch</th>
											<th>Project Value</th>
											<th>Billed</th>
											<th>Received</th>
											<th>Balance</th>
											
										</tr>
									</thead>
								</table>
							</div>
						</div>
						<!-- / Content -->
							<!-- Edit Receipt Modal -->
							<div class="modal fade" id="projectmodel" tabindex="-1"
								aria-hidden="true">
								<div class="modal-dialog modal-xl modal-simple modal-edit-user">
									<div class="modal-content p-3 p-md-5">
										<div class="modal-body">
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
											<div class="text-center mb-4">
												<h5>Select the Project</h5>
											</div>
											<form class="row g-3 needs-validation" id="editexpenseformx"
												onsubmit="return false">

													<select id="ProjectName" name="ProjectName" class="select2 form-select form-select-lg" data-allow-clear="true">
								                          	
								                          <th:block th:each="obj :${projectls}">
								                          		<option th:value="${obj.id}" th:text="${obj.Title} +'-('+${obj.projectID}+')'"></option>
								                          </th:block>
								                     </select>
												<div class="col-12 text-center mt-4">
													<button type="submit"
														class="btn btn-primary editReceiptsubmit me-sm-3 me-1">Create Receipt</button>

													<button type="reset"
														class="btn btn-label-secondary editReceiptclose"
														data-bs-dismiss="modal" aria-label="Close">
														Cancel</button>
												</div>
											</form>
											<br/>
											<!-- Project   Card -->
											<div class="cardx  mb-4">
												<div class="card-body1">
													<div class="card-header align-items-center">
														<h5 class="card-action-title mb-0">
															Invoice List
															
														</h5>
													</div>
													<div class="table-responsive">
														<table class="table border-top m-0">
															<thead>
																<tr>
																	<th>Invoice #</th>
																	<th>Type</th>
																	<th>Date</th>
																	<th>Due Date</th>
																	<th>Amount</th>
																</tr>
															</thead>
															<tbody id="projectinvoicelist">
			
															</tbody>
														</table>
													</div>
												</div>
											</div>
											<!-- /Project   Card -->
			
											<!-- Receipts   Card -->
											<div class="cardx  mb-4">
												<div class="card-body1">
													<div class="card-header align-items-center">
														<h5 class="card-action-title mb-0">Receipts List</h5>
													</div>
													<div class="table-responsive">
														<table class="table border-top m-0">
															<thead>
																<tr>
																	<th>Ref #</th>
																	<th>Invoice #</th>
																	<th>Date</th>
																	<th>Account</th>
			
																	<th>Amount Paid</th>
																</tr>
															</thead>
															<tbody id="receiptslist">
			
															</tbody>
														</table>
													</div>
												</div>
											</div>
											<!-- /Receipts   Card -->
										</div>
									</div>
								</div>
							</div>




							<!--/ Edit User Modal -->
							<!-- Edit Receipt Modal -->
							<div class="modal fade" id="receiptmodel" tabindex="-1"
								aria-hidden="true">
								<div class="modal-dialog modal-lg modal-simple modal-edit-user">
									<div class="modal-content p-3 p-md-5">
										<div class="modal-body">
											<button type="button" class="btn-close"
												data-bs-dismiss="modal" aria-label="Close"></button>
											<div class="text-center mb-4">
												<h5>Payment Receipt</h5>
											</div>
											<form class="row g-3 needs-validation" id="editreceiptformx"
												onsubmit="return false">
												<div class="row p-sm-3 p-0">
													<div class="col-md-6 mb-md-0 mb-4">

														<p class="mb-1">
															<b>Invoice No# :</b> <span id="invoiceNotxt"></span> <input
																type="hidden" id="recepitid" name="recepitid" /> <input
																type="hidden" id="recinvoiceid" name="recinvoiceid"
																required />
														</p>
														<p class="mb-1">
															<b>Due Date :</b> <span id="duedatetxt"></span>
														</p>
														<p class="mb-0"></p>
													</div>
													<div class="col-md-6">
														<p class="mb-1" align="right">
															<b>Amount :</b> <span id="invoiceamounttxt"></span>
														</p>
														<p class="mb-1" align="right">
															<b>Total paid :</b> <span id="invoicetotalpaidNotxt"></span>
														</p>
														<p class="mb-0" align="right">
															<b>Balance Due :</b> <span id="invoiceBalancetxt"></span>
														</p>
													</div>

												</div>


												<div class="col-12 col-md-6">
													<label class="form-label" for="recepitNo">
														Receipt #</label> <input type="text" id="recepitNo"
														name="recepitNo" class="form-control" placeholder="Will auto generate" />
												</div>

												<div class="col-12 col-md-6">
													<label class="form-label" for="recepitDate">Date</label> <input
														type="date" id="recepitDate" name="recepitDate"
														class="form-control" required />
												</div>

												<div class="col-12 col-md-6">
													<label class="form-label" for="depositedto">Deposited
														To</label> <select id="depositedto" name="depositedto"
														class="form-select" aria-label="Default select example"
														required>
														<option value="">-</option>
														<th:block th:each="obj1 : ${accountlist}">
															<option th:value="${obj1.accountheadid}"
																th:text="${obj1.category}"></option>
														</th:block>

													</select>
												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="modeofPayment">Mode
														of Payment</label> <select id="modeofPayment" name="modeofPayment"
														class="form-select" aria-label="Default select example"
														required>
														<option value="">-</option>
														<th:block th:each="str :${ModeofPayment}">
															<option th:value="${str}" th:text="${str}"></option>
														</th:block>
													</select>
												</div>
												<div class="col-12 col-md-6">
													<label class="form-label" for="amount">Amount </label> <input
														type="number" id="amount" name="amount"
														class="form-control modal-edit-tax-id" required />
												</div>
												<div class="col-12 col-md-6">
													<br /> <label class="switch"> <input
														type="checkbox" class="switch-input" id="payfull" /> <span
														class="switch-toggle-slider"> <span
															class="switch-on"></span> <span class="switch-off"></span>
													</span> <span class="switch-label">Pay in Full</span>
													</label>
												</div>
												<div class="col-12">
													<label class="form-label" for="notes">Notes </label> <input
														type="text" id="notes" name="notes"
														class="form-control modal-edit-tax-id" />
												</div>

												<div class="col-12 text-center mt-4">
													<button type="submit"
														class="btn btn-primary editReceiptsubmit me-sm-3 me-1">Save
													</button>

													<button type="reset"
														class="btn btn-label-secondary editReceiptclose"
														data-bs-dismiss="modal" aria-label="Close">
														Cancel</button>
												</div>
											</form>
										</div>
									</div>
								</div>
							</div>


						<!-- Footer -->
						<footer class="content-footer footer bg-footer-theme"> </footer>
						<!-- / Footer -->

						<div class="content-backdrop fade"></div>
					</div>
					<!-- Content wrapper -->
				</div>
				<!-- / Layout page -->
			</div>

			<!-- Overlay -->
			<div class="layout-overlay layout-menu-toggle"></div>

			<!-- Drag Target Area To SlideIn Menu On Small Screens -->
			<div class="drag-target"></div>
		</div>
	
		<!-- / Layout wrapper -->

		<!-- Core JS -->
		<!-- build:js assets/vendor/js/core.js -->
		<script th:src="@{/assets/vendor/libs/jquery/jquery.js}"></script>
		<script th:src="@{/assets/vendor/libs/popper/popper.js}"></script>
		<script th:src="@{/assets/vendor/js/bootstrap.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js}"></script>

		<script th:src="@{/assets/vendor/libs/hammer/hammer.js}"></script>

		<script th:src="@{/assets/vendor/libs/i18n/i18n.js}"></script>
		<script th:src="@{/assets/vendor/libs/typeahead-js/typeahead.js}"></script>

		<script th:src="@{/assets/vendor/js/menu.js}"></script>
		<!-- endbuild -->

		<!-- Vendors JS -->
		<script
			th:src="@{/assets/vendor/libs/datatables/jquery.dataTables.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-responsive/datatables.responsive.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-responsive-bs5/responsive.bootstrap5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-checkboxes-jquery/datatables.checkboxes.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/datatables-buttons.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons-bs5/buttons.bootstrap5.js}"></script>
		<script th:src="@{/assets/vendor/libs/jszip/jszip.js}"></script>
		<script th:src="@{/assets/vendor/libs/pdfmake/pdfmake.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/buttons.html5.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-buttons/buttons.print.js}"></script>
		<!-- Flat Picker -->
		<script th:src="@{/assets/vendor/libs/moment/moment.js}"></script>
		<script th:src="@{/assets/vendor/libs/flatpickr/flatpickr.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/bootstrap-datepicker/bootstrap-datepicker.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/bootstrap-daterangepicker/bootstrap-daterangepicker.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/jquery-timepicker/jquery-timepicker.js}"></script>
		<script th:src="@{/assets/vendor/libs/pickr/pickr.js}"></script>

		<!-- Row Group JS -->
		<script
			th:src="@{/assets/vendor/libs/datatables-rowgroup/datatables.rowgroup.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/datatables-rowgroup-bs5/rowgroup.bootstrap5.js}"></script>
		<script th:src="@{/assets/vendor/libs/sweetalert2/sweetalert2.js}"></script>
		<script th:src="@{/assets/vendor/libs/tagify/tagify.js}"></script>
		<script th:src="@{/assets/vendor/libs/cleavejs/cleave.js}"></script>
		<script th:src="@{/assets/vendor/libs/cleavejs/cleave-phone.js}"></script>
		<script th:src="@{/assets/vendor/libs/select2/select2.js}"></script>
		
		<!-- Form Validation -->
		<script
			th:src="@{/assets/vendor/libs/formvalidation/dist/js/FormValidation.min.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/Bootstrap5.min.js}"></script>
		<script
			th:src="@{/assets/vendor/libs/formvalidation/dist/js/plugins/AutoFocus.min.js}"></script>

		<!-- Main JS -->
		<script th:src="@{/assets/js/main.js}"></script>

		<!-- Page JS -->
		<!-- <script th:src="@{/assets/js/tables-datatables-basic.js}"></script> -->
		<script th:src="@{/assets/js/forms-selects.js}"></script>
		<script th:src="@{/assets/js/form-validation.js}"></script>
		<script>
    $(document).ready(function() {  
    	
    	
    	//--------------------------------------------------------------------------------------------------------------------------------------		 		

		$(function() {
			var token = $("meta[name='_csrf']").attr("content");
			var header = $("meta[name='_csrf_header']").attr("content");
			$(document).ajaxSend(function(e, xhr, options) {
				xhr.setRequestHeader(header, token);
			});
		});
		//--------------------------------------------------------------------------------------------------------------------------------------		 

  	  var dt_basic_table = $('.datatables-basic');

  	  	// DataTable with buttons
  	  	// --------------------------------------------------------------------

  	  	// --------------------------------------------------------------------

			  if (dt_basic_table.length) {
			    var dt_basic = dt_basic_table.DataTable({
			    	 ajax: {
			             "url": "Accountsprojectinvlistjson",
			             "type": "GET",
			             "dataSrc": "",
			         },
			      columns: [
			        { data: '' },
			        { data: 'id' },
			        { data: 'id' },
			        { data: 'title' },
			        { data: '' },
			        { data: '' },
			        { data: 'branchname' },
			        { data: 'projecttotalvaluefromItem' },		
			        { data: 'projecttotalvaluebilled' },		
			        { data: 'projecttotalvaluereceipt' },	
			        { data: '' },	
			        
			      
			      ],
			      columnDefs: [
			        {
			          // For Responsive
			          className: 'control',
			          orderable: false,
			          responsivePriority: 2,
			          searchable: false,
			          targets: 0,
			          render: function(data, type, full, meta) {
			            return '';
			          }
			        },
			        {
			          // For Checkboxes
			          targets: 1,
			          orderable: false,
			          responsivePriority: 3,
			          searchable: false,
			          checkboxes: true,
			          render: function() {
			            return '<input type="checkbox" class="dt-checkboxes form-check-input">';
			          },
			          checkboxes: {
			            selectAllRender: '<input type="checkbox" class="form-check-input">'
			          }
			        },
			        {
			          targets: 2,
			          searchable: false,
			          visible: false
			        },
			        {
				           targets:3,
				           render: function(data, type, full, meta) {
				           	 if(full['projectID'] ==null)
				           		 {
				           		full['projectID']="";
				           		 }
				           	 return '<a href="projectaccounts?id='+ full['id'] +'" target="_blank">'+ full['title'] +'</a><br/><small class="emp_post text-truncate text-muted">'+ full['projectID'] +'</small>';
				           }
				     },
			         
			        
			          
			          
			        {
			          // Label
			          targets: -2,
			          render: function(data, type, full, meta) {
			            var $status_number = full['t_currentStatus'];
			            var $status = {
			              1: { title: 'Current', class: 'bg-label-primary' },
			              2: { title: 'Professional', class: ' bg-label-success' },
			              3: { title: 'Rejected', class: ' bg-label-danger' },
			              4: { title: 'Resigned', class: ' bg-label-warning' },
			              5: { title: 'Applied', class: ' bg-label-info' }
			            };
			            if (typeof $status[$status_number] === 'undefined') {
			              return data;
			            }
			            return (
			              '<span class="badge rounded-pill ' +
			              $status[$status_number].class +
			              '">' +
			              $status[$status_number].title +
			              '</span>'
			            );
			          }
			        },
			        {
				           targets:4,
				           render: function(data, type, full, meta) {
				        	   
				        	   var billtyps="";
				        	   
				        	   full["invoiceList"].forEach(function (item) {
				        		   billtyps += '<a href="invoiceedit?pid='+ full['id'] +'&&id='+ item.invoiceid +'"  target="_blank">'+ item.invoiceType +'</a>';
				        	   });
				        	   
				            return billtyps;
				            
				           }
				         },
				         {
					           targets:5,
					           render: function(data, type, full, meta) {
					           	 
					        	   if(full["status"] =="Completed")
					        		   {
					        		   return 	  " <span class='badge bg-label-success'>"+ full["status"] +'</span>';
					        		   }
					        	   else
					        		   {
					        		   return 	   full["status"] +'';	   
					        		   }
					           	  
					           }
					     },
					     {
					           targets:10,
					           render: function(data, type, full, meta) {
					           	 
					           	 return 	   Math.round(full['projecttotalvaluebilled'] - full["projecttotalvaluereceipt"]); 
					           }
					     }
					     
					   
				        
				         
			      ],
			      
			      dom:
			        '<"card-header"<"head-label text-center"><"dt-action-buttons text-end"B>><"d-flex justify-content-between align-items-center row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>t<"d-flex justify-content-between row"<"col-sm-12 col-md-6"i><"col-sm-12 col-md-6"p>>',
			      displayLength: 10,
			      lengthMenu: [10, 25, 50, 75, 100],
			      buttons: [
		    	 	 {
		              text: '<i class="bx bx-plus me-md-2"></i><span class="d-md-inline-block d-none" onclick="createReceipt()">Create Receipt</span>',
		              className: 'btn btn-primary',
		              action: function (e, dt, button, config) {
		                
		              }
		            },
			        {
			          extend: 'collection',
			          className: 'btn btn-label-primary dropdown-toggle me-2',
			          text: '<i class="bx bx-show me-2"></i>Export',
			          buttons: [
			            {
			              extend: 'print',
			              text: '<i class="bx bx-printer me-2" ></i>Print',
			              className: 'dropdown-item',
			              exportOptions: { columns: [3, 4, 5, 6, 7,8,9] }
			            },
			            {
			              extend: 'csv',
			              text: '<i class="bx bx-file me-2" ></i>Csv',
			              className: 'dropdown-item',
			              exportOptions: { columns: [3, 4, 5, 6, 7,8,9] }
			            },
			            {
			              extend: 'excel',
			              text: 'Excel',
			              className: 'dropdown-item',
			              exportOptions: { columns: [3, 4, 5, 6, 7,8,9] }
			            },
			            {
			              extend: 'pdf',
			              text: '<i class="bx bxs-file-pdf me-2"></i>Pdf',
			              className: 'dropdown-item',
			              exportOptions: { columns: [3, 4, 5, 6, 7] }
			            },
			            {
			              extend: 'copy',
			              text: '<i class="bx bx-copy me-2" ></i>Copy',
			              className: 'dropdown-item',
			              exportOptions: { columns: [3, 4, 5, 6, 7,8,9] }
			            }
			          ]
			        }
			      ],
			      responsive: {
			        details: {
			          display: $.fn.dataTable.Responsive.display.modal({
			            header: function(row) {
			              var data = row.data();
			              return 'Details of ' + data['staffName'];
			            }
			          }),
			          type: 'column',
			          renderer: function(api, rowIdx, columns) {
			            var data = $.map(columns, function(col, i) {
			              return col.title !== '' // ? Do not show row in modal popup if title is blank (for check box)
			                ? '<tr data-dt-row="' +
			                    col.rowIndex +
			                    '" data-dt-column="' +
			                    col.columnIndex +
			                    '">' +
			                    '<td>' +
			                    col.title +
			                    ':' +
			                    '</td> ' +
			                    '<td>' +
			                    col.data +
			                    '</td>' +
			                    '</tr>'
			                : '';
			            }).join('');
			
			            return data ? $('<table class="table"/><tbody />').append(data) : false;
			          }
			        }
			      }
			    });
			    $('div.head-label').html('<h5 class="card-title mb-0">Projects Invoice</h5>');
		}
 // --------------------------------------------------------------------
				
    });
    
    function createReceipt(){
    	$("#projectmodel").modal("show");
    }
    
    $('#editexpenseformx').on('submit',function(event) {
    	//window.open("accountInvoicecreate?id="+$("#ProjectName").val());
    	//$("#projectmodel").modal("hide");
    	getinvoicelist($("#ProjectName").val());
    	getreceiptlist($("#ProjectName").val());
    	
    });
    
    
 // ----------------------------------------------------------------------------------------------------------------------------------------
	function getinvoicelist(mastercategoryid) {
		
		var formData = {
			mastercategoryid : mastercategoryid
		}

		$.ajax({
			type : "POST",
			url : "getprojectinvoicelist",
			data : formData,
			success : function(result) {
				var htmlop="";
				var bmobj = JSON.parse(JSON.stringify(result));
				var total=0;
				//console.log(bmobj);
				
				bmobj.forEach((element, index, array) =>
	           	{
	           		var sub_total=0;
	           	  
	           		element.invoiceItemMasterlist.forEach((elementx, indexx, arrayx) =>
		           	  {
		           		sub_total +=elementx.taxableAmount + elementx.cgstamount + elementx.sgstamount+ elementx.igstamount; 
		           	  });
		           	  
		           	 htmlop +="<tr><td class='text-nowrap editprojectprj' onclick='editinvoiceinfo(this)' id='"+element.invoiceid +"'>"+element.invoiceNo+"</td>";
		           	 htmlop +="<td class='text-nowrap'>"+element.invoiceType +" <a href='prjinvoiceprint?id="+ mastercategoryid +"&inv="+ element.invoiceid + "' target='_blank'><i class='bx bx-printer'></i></a></td><td class='text-nowrap'>"+element.invoiceDateMMMddyyyy +"</td><td>"+element.dueDateMMMddyyyy +"</td>";
		           	 htmlop +="<td>"+sub_total.toFixed(0) +" <i class='bx bx-receipt  generatenewreceipt' onclick='generatereceipt("+element.invoiceid +","+ mastercategoryid +")'  ></i></td></tr>";
		           	 total +=parseFloat(sub_total);
	            });
				
				 htmlop += "<tr> <td colspan='3' class='align-top px-4 py-3'> </td> <td class='text-end px-4 py-3'> <p class='mb-0'>Total:</p> </td>  <td class='px-4 py-3'> <p class='fw-semibold mb-0'>Rs. "+ total.toFixed(0) +"</p> </td> </tr>";
					
				$('#projectinvoicelist').html(htmlop);
			},
			error : function(e) {
				console.log("Error" + e);

			}

		});

	}
	
	
	// ----------------------------------------------------------------------------------------------------------------------------------------
	function getreceiptlist( mastercategoryid ) {
		
		var formData = {
			mastercategoryid : mastercategoryid
		}

		$.ajax({
			type : "POST",
			url : "getprojectreceiptlist",
			data : formData,
			success : function(result) {
				var htmlop="";
				var bmobj = JSON.parse(JSON.stringify(result));
				var total=0;
				//console.log(bmobj);
				
				bmobj.forEach((element, index, array) =>
	           	{
	           		var sub_total=0;
	           	  
	           		
		           	 htmlop +="<tr><td class='text-nowrap editprojectprj' onclick='editreceiptinfo(this)' id='"+element.recepitid +"'>"+element.recepitNo+"</td>";
		           	 htmlop +="<td class='text-nowrap'>"+element.invoiceNo +"</td><td class='text-nowrap'>"+element.recepitDateMMMddyyyy +"</td><td>"+element.depositedto_txt +"</td>";
		           	 htmlop +="<td>"+element.amount.toFixed(2) +"</td></tr>";
		           	 total +=parseFloat(element.amount);
	            });
				
				 htmlop += "<tr> <td colspan='3' class='align-top px-4 py-3'> </td> <td class='text-end px-4 py-3'> <p class='mb-0'>Total:</p> </td>  <td class='px-4 py-3'> <p class='fw-semibold mb-0'>Rs. "+ total.toFixed(2) +"</p> </td> </tr>";
					
				$('#receiptslist').html(htmlop);
			},
			error : function(e) {
				console.log("Error" + e);

			}

		});

	}
	//------------------------------------------------------
	function generatereceipt(invoiceid,mastercategoryid)
	{
		
		$("#recepitid").val("");
		
		var formData = {
				invoiceid : invoiceid,
				mastercategoryid: mastercategoryid
			}

			$.ajax({
				type : "POST",
				url : "getinvoicereceiptitem",
				data : formData,
				success : function(result) {
					var bmobj = JSON.parse(JSON.stringify(result));
					//console.log(bmobj);
					
					$("#invoiceNotxt").text(bmobj.Invoiceno);
					$("#duedatetxt").text(bmobj.duedate);
					$("#invoiceamounttxt").text(bmobj.amount);
					$("#invoicetotalpaidNotxt").text(bmobj.totalpaidamount);
					$("#invoiceBalancetxt").text(parseInt(bmobj.balanceamount).toFixed(2));
					$("#recinvoiceid").val(bmobj.invoiceid);
					
					$('#receiptmodel').modal('show');
				},
				error : function(e) {
					console.log("Error" + e);
				}
			});
		
	}
	// --------------------------------------------------------------------
	$('#amount').on('change',function(event) {
		var amount = $('#amount').val();
		
		
		if(amount > parseFloat($('#invoiceBalancetxt').text()))
		{
			$('#amount').val($('#invoiceBalancetxt').text());
		}
		
	});
	//-------------------------------------------
	$('#payfull').change(function() {
        if(this.checked) {
        	$("#amount").val($('#invoiceBalancetxt').text());
        	
        }
	});
	//------------------------------------------------------------------------------------
	
	 function editreceiptinfo(e){
			var projectid= e.getAttribute("id");
			var temppid=$("#ProjectName").val();
				var formData = {
					projectid : projectid,
					mastercategoryid: temppid
				}

				$.ajax({
					type : "POST",
					url : "getreceiptitem",
					data : formData,
					success : function(result) {
						var bmobj = JSON.parse(JSON.stringify(result));
					//	console.log(bmobj);
						
						$("#recepitid").val(bmobj.recepitid);
						$("#recepitNo").val(bmobj.recepitNo);
						$("#recepitDate").val(bmobj.recepitDate);
						$("#recinvoiceid").val(bmobj.invoiceid);
						$("#depositedto").val(bmobj.depositedto).change();
						$("#modeofPayment").val(bmobj.modeofPayment).change();
						$("#amount").val(bmobj.amount);
						$("#notes").val(bmobj.notes);
						
					
						var formData = {
								invoiceid : bmobj.invoiceid,
								mastercategoryid: temppid
							}

							$.ajax({
								type : "POST",
								url : "getinvoicereceiptitem",
								data : formData,
								success : function(result) {
									var bmobj = JSON.parse(JSON.stringify(result));
									//console.log(bmobj);
									
									$("#invoiceNotxt").text(bmobj.Invoiceno);
									$("#duedatetxt").text(bmobj.duedate);
									$("#invoiceamounttxt").text(bmobj.amount);
									$("#invoicetotalpaidNotxt").text(bmobj.totalpaidamount);
									$("#invoiceBalancetxt").text(parseInt(bmobj.balanceamount).toFixed(2));
									$("#recinvoiceid").val(bmobj.invoiceid);
									
									$('#receiptmodel').modal('show');
								},
								error : function(e) {
									console.log("Error" + e);
								}
							});
						
					},
					error : function(e) {
						console.log("Error" + e);
					}
				});
			
		}
	
	// ----------------------------------------------------------------------------------------------------------------------------------------
	
    </script>
</body>
</html>